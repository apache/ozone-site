<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-core-concepts/replication/write-pipelines" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Write Pipelines | Apache Ozone</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ozone-site-v2.staged.apache.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://ozone-site-v2.staged.apache.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://ozone-site-v2.staged.apache.org/docs/core-concepts/replication/write-pipelines"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Write Pipelines | Apache Ozone"><meta data-rh="true" name="description" content="Write pipelines are a fundamental component of Apache Ozone&#x27;s storage architecture, enabling reliable data storage across distributed nodes. This document provides a comprehensive overview of write pipelines, covering both replication and erasure coding approaches, their architecture, implementation details, and usage patterns."><meta data-rh="true" property="og:description" content="Write pipelines are a fundamental component of Apache Ozone&#x27;s storage architecture, enabling reliable data storage across distributed nodes. This document provides a comprehensive overview of write pipelines, covering both replication and erasure coding approaches, their architecture, implementation details, and usage patterns."><link data-rh="true" rel="canonical" href="https://ozone-site-v2.staged.apache.org/docs/core-concepts/replication/write-pipelines"><link data-rh="true" rel="alternate" href="https://ozone-site-v2.staged.apache.org/docs/core-concepts/replication/write-pipelines" hreflang="en"><link data-rh="true" rel="alternate" href="https://ozone-site-v2.staged.apache.org/docs/core-concepts/replication/write-pipelines" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PLACEHOLDER-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Ozone RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Ozone Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Ozone" href="/opensearch.xml">
<link rel="manifest" href="/pwa/manifest.json">

<link rel="icon" href="favicon.ico" sizes="32x32">
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<script src="/script/matomo.js"></script><link rel="stylesheet" href="/assets/css/styles.27c88cdc.css">
<script src="/assets/js/runtime~main.ea5a0a6d.js" defer="defer"></script>
<script src="/assets/js/main.dbc338ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_wi3M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ozone-logo.svg" alt="Ozone Logo" class="themedComponent_Ka_G themedComponent--light_hIiB"><img src="/img/ozone-logo.svg" alt="Ozone Logo" class="themedComponent_Ka_G themedComponent--dark_GbLg"></div><b class="navbar__title text--truncate">Apache Ozone</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/communication-channels">Communication Channels</a></li><li><a class="dropdown__link" href="/community/who-uses-ozone">Who Uses Ozone?</a></li><li><a class="dropdown__link" href="/community/report-an-issue">Report An Issue</a></li><li><a class="dropdown__link" href="/community/ask-a-question">Ask a Question</a></li><li><a class="dropdown__link" href="/community/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/events-and-media">Events and Media</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_NU7Q"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/core-concepts/replication/write-pipelines" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/apache/ozone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub Repo"></a><div class="toggle_F0tt colorModeToggle_Cksm"><button class="clean-btn toggleButton_tFD4 toggleButtonDisabled_UmGx" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_gzz6"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_HsWo"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_SQAi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_HMzJ"><div class="docsWrapper_TA0s"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton__Euq" type="button"></button><div class="docRoot_VN1Z"><aside class="theme-doc-sidebar-container docSidebarContainer_jdpB"><div class="sidebarViewport_pKkV"><div class="scrollCustom_InGK"><div class="customSidebarVersion_kZiw"><div class="customSidebarInner_rBmt"><span style="display:inline-block">Version:</span> <a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/core-concepts/replication/write-pipelines">Next</a></div></div><div id="sidebarCssSelector_uq97"><div class="sidebar_W81o"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_KB1A"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/quick-start/">Quick Start</a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/core-concepts/">Core Concepts</a><button aria-label="Collapse sidebar category &#x27;Core Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/architecture/">Architecture</a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/core-concepts/replication/">Replication</a><button aria-label="Collapse sidebar category &#x27;Replication&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/replication/storage-containers">Storage Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/core-concepts/replication/write-pipelines">Write Pipelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/replication/ratis">Ratis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/replication/erasure-coding">Erasure Coding</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/namespace/">Namespace</a><button aria-label="Expand sidebar category &#x27;Namespace&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/security/">Security</a><button aria-label="Expand sidebar category &#x27;Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/high-availability/">High Availability</a><button aria-label="Expand sidebar category &#x27;High Availability&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/comparison">Comparison with Other Storage Technologies</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/user-guide/">User Guide</a><button aria-label="Expand sidebar category &#x27;User Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/administrator-guide/">Administrator Guide</a><button aria-label="Expand sidebar category &#x27;Administrator Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/troubleshooting/">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/system-internals/">System Internals</a><button aria-label="Expand sidebar category &#x27;System Internals&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/developer-guide/">Developer Guide</a><button aria-label="Expand sidebar category &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></div></div></aside><main class="docMainContainer_YnIx"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_oKcN"><div class="docItemContainer_EnqJ"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_JwNh" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_gcoS"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/core-concepts/"><span itemprop="name">Core Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/core-concepts/replication/"><span itemprop="name">Replication</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Write Pipelines</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_my_n theme-doc-toc-mobile tocMobile_mwTw"><button type="button" class="clean-btn tocCollapsibleButton_v3oV">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Write Pipelines</h1></header>
<p>Write pipelines are a fundamental component of Apache Ozone&#x27;s storage architecture, enabling reliable data storage across distributed nodes. This document provides a comprehensive overview of write pipelines, covering both replication and erasure coding approaches, their architecture, implementation details, and usage patterns.</p>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="what-are-write-pipelines">What are Write Pipelines?<a href="#what-are-write-pipelines" class="hash-link" aria-label="Direct link to What are Write Pipelines?" title="Direct link to What are Write Pipelines?">​</a></h2>
<p>Write pipelines are groups of Datanodes that work together as a unit to store and replicate data in Ozone. They serve as the foundation for Ozone&#x27;s data redundancy strategy, providing:</p>
<ul>
<li>A coordinated path for write operations across multiple nodes</li>
<li>Consistency guarantees for data replication</li>
<li>Efficient management of data distribution and storage</li>
</ul>
<p>The Storage Container Manager (SCM) is responsible for creating and managing write pipelines, selecting appropriate Datanodes based on factors like availability, capacity, and network topology.</p>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="pipeline-types">Pipeline Types<a href="#pipeline-types" class="hash-link" aria-label="Direct link to Pipeline Types" title="Direct link to Pipeline Types">​</a></h2>
<p>Ozone supports different types of write pipelines to accommodate various durability and storage efficiency requirements:</p>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="1-ratis-pipelines-replicated">1. Ratis Pipelines (Replicated)<a href="#1-ratis-pipelines-replicated" class="hash-link" aria-label="Direct link to 1. Ratis Pipelines (Replicated)" title="Direct link to 1. Ratis Pipelines (Replicated)">​</a></h3>
<p>Ratis pipelines use the <a href="https://ratis.apache.org/" target="_blank" rel="noopener noreferrer">Apache Ratis</a> implementation of the Raft consensus protocol for strongly consistent replication.</p>
<ul>
<li><strong>Structure</strong>: Typically consists of three Datanodes (one leader, multiple followers)</li>
<li><strong>Consistency</strong>: Provides strong consistency through synchronous replication</li>
<li><strong>Durability</strong>: Data is fully replicated on all nodes in the pipeline</li>
<li><strong>Use Case</strong>: Default replication strategy for most Ozone deployments</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Ratis Replication Pipeline" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgICAgICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgICAgICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgICAgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICAgICAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICAgICAgIGlkPSJzdmc0ODk5IgogICAgICAgIHZlcnNpb249IjEuMSIKICAgICAgICB2aWV3Qm94PSIwIDAgMzQgMzYiCiAgICAgICAgaGVpZ2h0PSIzNm1tIgogICAgICAgIHdpZHRoPSIzNG1tIgogICAgICAgIHNvZGlwb2RpOmRvY25hbWU9InJhdGlzLnN2ZyIKICAgICAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkyLjQgNWRhNjg5YzMxMywgMjAxOS0wMS0xNCI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgICAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgICAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgICAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICAgICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgICAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgICAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgICAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSI2MzYiCiAgICAgICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI1MDYiCiAgICAgICAgICBpZD0ibmFtZWR2aWV3MjEiCiAgICAgICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgICAgICBpbmtzY2FwZTp6b29tPSIwLjkwNTA5NjY4IgogICAgICAgICAgaW5rc2NhcGU6Y3g9IjgxLjM2NzYxMyIKICAgICAgICAgIGlua3NjYXBlOmN5PSIxMTkuOTY1MTIiCiAgICAgICAgICBpbmtzY2FwZTp3aW5kb3cteD0iNjQwIgogICAgICAgICAgaW5rc2NhcGU6d2luZG93LXk9IjU0MyIKICAgICAgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc0ODk5IiAvPgogIDxkZWZzCiAgICAgICAgICBpZD0iZGVmczQ4OTMiIC8+CiAgPG1ldGFkYXRhCiAgICAgICAgICBpZD0ibWV0YWRhdGE0ODk2Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICAgICAgIGlkPSJsYXllcjEiCiAgICAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMS45NzE3ODgsLTEuMjExNDEyMikiPgogICAgPGcKICAgICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMC4zNTI3Nzc3NywwLDAsLTAuMzUyNzc3NzcsNy45Mzc1MDE2LDExLjIzNzQwMSkiCiAgICAgICAgICAgIGlkPSJnNjQiPgogICAgICA8cGF0aAogICAgICAgICAgICAgIGlkPSJwYXRoNjYiCiAgICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzYyY2JkNTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6IzYyY2JkNTtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgICAgICBkPSJNIDAsMCAzNCwxNyIKICAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPC9nPgogICAgPGcKICAgICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMC4zNTI3Nzc3NywwLDAsLTAuMzUyNzc3NzcsMzEuMDQ0NDQ2LDI0LjExMzc5MSkiCiAgICAgICAgICAgIGlkPSJnNjgiPgogICAgICA8cGF0aAogICAgICAgICAgICAgIGlkPSJwYXRoNzAiCiAgICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzYyY2JkNTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6IzYyY2JkNTtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgICAgICBkPSJNIDAsMCAtNjYsMzciCiAgICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgIDwvZz4KICAgIDxnCiAgICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuMzUyNzc3NzcsMCwwLC0wLjM1Mjc3Nzc3LDE2LjU4MDU1NiwyMi43MDI2NzgpIgogICAgICAgICAgICBpZD0iZzcyIj4KICAgICAgPHBhdGgKICAgICAgICAgICAgICBpZD0icGF0aDc0IgogICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiM2MmNiZDU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOiM2MmNiZDU7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICAgICAgICAgZD0iTSAwLDAgLTI0LDMyIgogICAgICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8L2c+CiAgICA8cGF0aAogICAgICAgICAgICBpZD0icGF0aDc2IgogICAgICAgICAgICBzdHlsZT0iZmlsbDojNjJjYmQ1O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojNjJjYmQ1O3N0cm9rZS13aWR0aDowLjcwNTU1NTU7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICAgICAgIGQ9Ik0gMTIuMTcwODM2LDE1LjQ3MDczNSBIIDQuMDU2OTQ1NiBWIDcuMzU2ODQ1NyBoIDguMTEzODkwNCB6IgogICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgICAgICAgaWQ9InBhdGg3OCIKICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzYyY2JkNTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6IzYyY2JkNTtzdHJva2Utd2lkdGg6MC43MDU1NTU1O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICAgICBkPSJNIDEwLjQwNjk0NiwzNC44NzM1MTIgSCA2LjE3MzYxMTYgdiAtNC4yMzMzMzMgaCA0LjIzMzMzNDQgeiIKICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgIDxnCiAgICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuMzUyNzc3NzcsMCwwLC0wLjM1Mjc3Nzc3LDguMTEzOTU5NiwzMi40MDQwMzEpIgogICAgICAgICAgICBpZD0iZzgwIj4KICAgICAgPHBhdGgKICAgICAgICAgICAgICBpZD0icGF0aDgyIgogICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiM2MmNiZDU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgICAgICAgZD0iTSAwLDAgViA1NiBaIgogICAgICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8L2c+CiAgICA8ZwogICAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjM1Mjc3Nzc3LDAsMCwtMC4zNTI3Nzc3Nyw4LjExMzg4ODYsMzIuNDA0MDY4KSIKICAgICAgICAgICAgaWQ9Imc4NCI+CiAgICAgIDxwYXRoCiAgICAgICAgICAgICAgaWQ9InBhdGg4NiIKICAgICAgICAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojNjJjYmQ1O3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICAgICAgIGQ9Ik0gMCwwIFYgNTYiCiAgICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICAgICAgIGlkPSJwYXRoODgiCiAgICAgICAgICAgIHN0eWxlPSJmaWxsOiM2MmNiZDU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOiM2MmNiZDU7c3Ryb2tlLXdpZHRoOjAuNzA1NTU1NTtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgICAgZD0ibSAxOC41MjA4MzYsMjQuNjQyOTU3IGggLTQuMjMzMzQgdiAtNC4yMzMzMzQgaCA0LjIzMzM0IHoiCiAgICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICA8cGF0aAogICAgICAgICAgICBpZD0icGF0aDkwIgogICAgICAgICAgICBzdHlsZT0iZmlsbDojNjJjYmQ1O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojNjJjYmQ1O3N0cm9rZS13aWR0aDowLjcwNTU1NTU7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICAgICAgIGQ9Im0gMzIuOTg0NzI2LDI2LjA1NDA2OCBoIC00LjIzMzM0IHYgLTQuMjMzMzM0IGggNC4yMzMzNCB6IgogICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgICAgICAgaWQ9InBhdGg5MiIKICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzYyY2JkNTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6IzYyY2JkNTtzdHJva2Utd2lkdGg6MC43MDU1NTU1O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICAgICBkPSJtIDIyLjA0ODYxNiw3LjM1Njg0NTcgaCAtNC4yMzMzNCB2IC00LjIzMzMzMyBoIDQuMjMzMzQgeiIKICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICA8L2c+Cjwvc3ZnPgo=" width="129" height="136" class="img_zmyy"></p>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="ratis-pipeline-v1-async-api">Ratis Pipeline V1: Async API<a href="#ratis-pipeline-v1-async-api" class="hash-link" aria-label="Direct link to Ratis Pipeline V1: Async API" title="Direct link to Ratis Pipeline V1: Async API">​</a></h4>
<p>The original Ozone replication pipeline (V1) uses the Ratis Async API for data replication across multiple Datanodes:</p>
<ol>
<li>Client buffers data locally until a certain threshold is reached</li>
<li>Data is sent to the leader Datanode in the pipeline</li>
<li>Leader replicates data to follower Datanodes</li>
<li>Once a quorum of Datanodes acknowledge the write, the operation is considered successful</li>
</ol>
<p>This approach ensures data consistency but has some limitations in terms of network topology awareness and buffer handling efficiency.</p>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="ratis-pipeline-v2-streaming-api">Ratis Pipeline V2: Streaming API<a href="#ratis-pipeline-v2-streaming-api" class="hash-link" aria-label="Direct link to Ratis Pipeline V2: Streaming API" title="Direct link to Ratis Pipeline V2: Streaming API">​</a></h4>
<p>The newer Streaming Write Pipeline (V2) in Ozone leverages the Ratis Streaming API to provide significant performance improvements:</p>
<p><strong>Key Enhancements:</strong></p>
<ul>
<li>Better network topology awareness</li>
<li>Elimination of unnecessary buffer copying (Netty zero copy)</li>
<li>Improved CPU and disk utilization on Datanodes</li>
<li>More efficient parallelism in data processing</li>
</ul>
<p>The Streaming Write Pipeline introduces a new network protocol that enables direct streaming of data from client to Datanodes, reducing overhead and improving throughput.</p>
<p><strong>Configuration:</strong></p>
<p>To enable the Streaming Write Pipeline (V2), configure these properties in <code>ozone-site.xml</code>:</p>
<div class="language-xml codeBlockContainer_mZR4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rIoO"><pre tabindex="0" class="prism-code language-xml codeBlock_kDDR thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_SQL2"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hdds.container.ratis.datastream.enabled</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Enable data stream of container</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hdds.container.ratis.datastream.port</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">9855</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">The datastream port number of container</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ozone.fs.datastream.enabled</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Enable filesystem write via ratis streaming</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_QU8l"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_PE_v" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_bUEh"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_DKrM"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="2-erasure-coded-pipelines">2. Erasure Coded Pipelines<a href="#2-erasure-coded-pipelines" class="hash-link" aria-label="Direct link to 2. Erasure Coded Pipelines" title="Direct link to 2. Erasure Coded Pipelines">​</a></h3>
<p>Erasure coded (EC) pipelines use mathematical techniques to achieve data durability with lower storage overhead than full replication.</p>
<ul>
<li><strong>Structure</strong>: Distributes data chunks and parity chunks across multiple Datanodes</li>
<li><strong>Efficiency</strong>: Requires less storage space than full replication (e.g., 50% overhead instead of 200%)</li>
<li><strong>Recovery</strong>: Can reconstruct data from a subset of available chunks</li>
<li><strong>Use Case</strong>: Optimized for large data sets where storage efficiency is critical</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Erasure Coded Pipeline" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTAwIDcwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDx0aXRsZT5FcmFzdXJlIENvZGluZyBJY29uIC0gT2JqZWN0IFNwbGl0PC90aXRsZT4KICA8ZGVzYz5BYnN0cmFjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBvYmplY3QgYmVpbmcgc3BsaXQgaW50byBkYXRhIGFuZCBwYXJpdHkgYmxvY2tzLjwvZGVzYz4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1LCAtMSkiPgoKICA8IS0tIE9yaWdpbmFsIE9iamVjdCAtLT4KICA8cmVjdCB4PSIzNSIgeT0iNSIgd2lkdGg9IjMwIiBoZWlnaHQ9IjE1IiBmaWxsPSIjMzA2OTAwIiByeD0iMiIvPgoKICA8IS0tIExpbmVzIHNob3dpbmcgc3BsaXR0aW5nIGZyb20gdGhlIG9iamVjdCAtLT4KICA8bGluZSB4MT0iNDAiIHkxPSIyMCIgeDI9IjE1IiB5Mj0iNDAiIHN0cm9rZT0iIzM1NzUwMCIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4gPCEtLSBEYXRhIGxpbmUgLS0+CiAgPGxpbmUgeDE9IjQ1IiB5MT0iMjAiIHgyPSIzNSIgeTI9IjQwIiBzdHJva2U9IiMzNTc1MDAiIHN0cm9rZS13aWR0aD0iMS41Ii8+IDwhLS0gRGF0YSBsaW5lIC0tPgogIDxsaW5lIHgxPSI1MCIgeTE9IjIwIiB4Mj0iNTUiIHkyPSI0MCIgc3Ryb2tlPSIjMzU3NTAwIiBzdHJva2Utd2lkdGg9IjEuNSIvPiA8IS0tIERhdGEgbGluZSAtLT4KICA8bGluZSB4MT0iNTUiIHkxPSIyMCIgeDI9Ijc1IiB5Mj0iNDAiIHN0cm9rZT0iIzk2ZDI2ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4gPCEtLSBQYXJpdHkgbGluZSAtLT4KICA8bGluZSB4MT0iNjAiIHkxPSIyMCIgeDI9Ijk1IiB5Mj0iNDAiIHN0cm9rZT0iIzk2ZDI2ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4gPCEtLSBQYXJpdHkgbGluZSAtLT4KCiAgPCEtLSBEYXRhIEZyYWdtZW50cyAtLT4KICA8cmVjdCB4PSIxMCIgeT0iNDAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMiIgZmlsbD0iIzM1NzUwMCIgcng9IjEiLz4KICA8cmVjdCB4PSIzMCIgeT0iNDAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMiIgZmlsbD0iIzM1NzUwMCIgcng9IjEiLz4KICA8cmVjdCB4PSI1MCIgeT0iNDAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMiIgZmlsbD0iIzM1NzUwMCIgcng9IjEiLz4KCiAgPCEtLSBQYXJpdHkgRnJhZ21lbnRzIC0tPgogIDxyZWN0IHg9IjcwIiB5PSI0MCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEyIiBmaWxsPSJub25lIiBzdHJva2U9IiM5NmQyNmUiIHN0cm9rZS13aWR0aD0iMS41IiByeD0iMSIvPgogIDxyZWN0IHg9IjkwIiB5PSI0MCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEyIiBmaWxsPSJub25lIiBzdHJva2U9IiM5NmQyNmUiIHN0cm9rZS13aWR0aD0iMS41IiByeD0iMSIvPgogIDwvZz4KCjwvc3ZnPg==" width="150" height="70" class="img_zmyy"></p>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="striping-and-data-layout">Striping and Data Layout<a href="#striping-and-data-layout" class="hash-link" aria-label="Direct link to Striping and Data Layout" title="Direct link to Striping and Data Layout">​</a></h4>
<p>EC in Ozone uses a striping data model where:</p>
<ol>
<li>Data is divided into fixed-size chunks (typically 1MB)</li>
<li>The chunks are organized into stripes</li>
<li>For each stripe, parity chunks are computed</li>
<li>The chunks are distributed across Datanodes</li>
</ol>
<p>For example, with an RS (Reed-Solomon) 6-3 configuration:</p>
<ul>
<li>Data is split into 6 data chunks</li>
<li>3 parity chunks are computed</li>
<li>These 9 chunks together form a &quot;Stripe&quot;</li>
<li>Multiple stripes using the same set of Datanodes form a &quot;BlockGroup&quot;</li>
</ul>
<p>This approach provides 50% storage overhead compared to 200% with 3x replication, while maintaining similar durability guarantees.</p>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="ec-configuration">EC Configuration<a href="#ec-configuration" class="hash-link" aria-label="Direct link to EC Configuration" title="Direct link to EC Configuration">​</a></h4>
<p>To use Erasure Coding in Ozone, you can configure EC at the bucket level or per key:</p>
<p><strong>Setting EC at bucket creation:</strong></p>
<div class="language-bash codeBlockContainer_mZR4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rIoO"><pre tabindex="0" class="prism-code language-bash codeBlock_kDDR thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_SQL2"><span class="token-line" style="color:#393A34"><span class="token plain">ozone </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bucket create </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">bucket path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token plain"> EC </span><span class="token parameter variable" style="color:#36acaa">--replication</span><span class="token plain"> rs-6-3-1024k</span><br></span></code></pre><div class="buttonGroup_QU8l"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_PE_v" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_bUEh"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_DKrM"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Changing EC configuration for an existing bucket:</strong></p>
<div class="language-bash codeBlockContainer_mZR4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rIoO"><pre tabindex="0" class="prism-code language-bash codeBlock_kDDR thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_SQL2"><span class="token-line" style="color:#393A34"><span class="token plain">ozone </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bucket set-replication-config </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">bucket path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token plain"> EC </span><span class="token parameter variable" style="color:#36acaa">--replication</span><span class="token plain"> rs-3-2-1024k</span><br></span></code></pre><div class="buttonGroup_QU8l"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_PE_v" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_bUEh"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_DKrM"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Setting EC when creating a key:</strong></p>
<div class="language-bash codeBlockContainer_mZR4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rIoO"><pre tabindex="0" class="prism-code language-bash codeBlock_kDDR thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_SQL2"><span class="token-line" style="color:#393A34"><span class="token plain">ozone </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> key put </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Ozone Key Object Path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Local File</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token plain"> EC </span><span class="token parameter variable" style="color:#36acaa">--replication</span><span class="token plain"> rs-6-3-1024k</span><br></span></code></pre><div class="buttonGroup_QU8l"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_PE_v" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_bUEh"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_DKrM"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Supported EC configurations include:</p>
<ul>
<li><code>RS-3-2-1024k</code>: Reed-Solomon with 3 data chunks, 2 parity chunks, 1MB chunk size</li>
<li><code>RS-6-3-1024k</code>: Reed-Solomon with 6 data chunks, 3 parity chunks, 1MB chunk size (recommended)</li>
<li><code>XOR-2-1-1024k</code>: XOR coding with 2 data chunks, 1 parity chunk, 1MB chunk size</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="pipeline-lifecycle">Pipeline Lifecycle<a href="#pipeline-lifecycle" class="hash-link" aria-label="Direct link to Pipeline Lifecycle" title="Direct link to Pipeline Lifecycle">​</a></h2>
<p>Write pipelines follow a well-defined lifecycle, managed by the Storage Container Manager:</p>
<ol>
<li><strong>Creation</strong>: SCM selects appropriate Datanodes and creates a pipeline</li>
<li><strong>Active</strong>: Pipeline accepts write operations and manages replication</li>
<li><strong>Closing</strong>: Pipeline stops accepting new writes when it reaches capacity limits</li>
<li><strong>Closed</strong>: Pipeline becomes read-only after all write operations complete</li>
<li><strong>Recovery/Reconstruction</strong>: If a node fails, SCM may initiate recovery procedures</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="how-write-pipelines-work">How Write Pipelines Work<a href="#how-write-pipelines-work" class="hash-link" aria-label="Direct link to How Write Pipelines Work" title="Direct link to How Write Pipelines Work">​</a></h2>
<p>The write operation in Ozone follows these steps through the pipeline:</p>
<ol>
<li><strong>Client Request</strong>: Client contacts the Ozone Manager (OM) to create or write to a key</li>
<li><strong>Block Allocation</strong>: OM requests block allocation from SCM</li>
<li><strong>Pipeline Selection</strong>: SCM selects an appropriate pipeline for the write operation</li>
<li><strong>Data Transfer</strong>: Client streams data directly to the leader Datanode in the pipeline</li>
<li><strong>Replication</strong>: For Ratis pipelines, the leader replicates data to followers using the Raft protocol; for EC pipelines, the client distributes different chunks to different Datanodes</li>
<li><strong>Acknowledgment</strong>: Once all replicas are written, the client receives confirmation</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Write Pipeline Flow" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJJY29ucyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgICB2aWV3Qm94PSIwIDAgMjguOCAyOC44IiB3aWR0aD0iOTAiIGhlaWdodD0iOTAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOm5vbmU7c3Ryb2tlOiMzNTc1MDA7c3Ryb2tlLXdpZHRoOjEuNjtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fQoJLnN0MXtmaWxsOm5vbmU7c3Ryb2tlOiMzNTc1MDA7c3Ryb2tlLXdpZHRoOjEuNjtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fQoJLnN0MntmaWxsOm5vbmU7c3Ryb2tlOiMzNTc1MDA7c3Ryb2tlLXdpZHRoOjEuNjtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CiAgICA8ZyB0cmFuc2Zvcm09InNjYWxlKDAuOSkiPgogIDxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMSw3SDVDMy45LDcsMyw2LjEsMyw1VjNoMTB2MkMxMyw2LjEsMTIuMSw3LDExLDd6Ii8+CiAgICAgICAgPHBhdGggY2xhc3M9InN0MCIgZD0iTTE4LDEzdjZjMCwwLjYtMC40LDEtMSwxaC0yYy0wLjYsMC0xLTAuNC0xLTF2LTZjMC0wLjYsMC40LTEsMS0xaDJDMTcuNiwxMiwxOCwxMi40LDE4LDEzeiIvPgogICAgICAgIDxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0yOSwyOUgxOXYtMmMwLTEuMSwwLjktMiwyLTJoNmMxLjEsMCwyLDAuOSwyLDJWMjl6Ii8+CiAgICAgICAgPHBhdGggY2xhc3M9InN0MCIgZD0iTTE0LDEzaC0xLjhjLTAuNiwwLTEuMi0wLjUtMS4yLTEuMlY3SDV2NnYwYzAsMy4zLDIuNyw2LDYsNmgwaDMiLz4KICAgICAgICA8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMTgsMTloMS44YzAuNiwwLDEuMiwwLjUsMS4yLDEuMlYyNWg2di02djBjMC0zLjMtMi43LTYtNi02aC0zIi8+CjwvZz4KPC9zdmc+" width="90" height="90" class="img_zmyy"></p>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="implementation-details">Implementation Details<a href="#implementation-details" class="hash-link" aria-label="Direct link to Implementation Details" title="Direct link to Implementation Details">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="replication-pipeline-implementation">Replication Pipeline Implementation<a href="#replication-pipeline-implementation" class="hash-link" aria-label="Direct link to Replication Pipeline Implementation" title="Direct link to Replication Pipeline Implementation">​</a></h4>
<p>The replication write pipeline is implemented through several key classes:</p>
<ul>
<li><strong>BlockOutputStream</strong>: Base class that manages the overall write process</li>
<li><strong>RatisBlockOutputStream</strong>: Implements the Ratis-specific functionality for replication</li>
<li><strong>CommitWatcher</strong>: Tracks commit status across all Datanodes in the pipeline</li>
<li><strong>XceiverClient</strong>: Handles communication with Datanodes</li>
</ul>
<p>The write process follows these steps:</p>
<ol>
<li>Client creates a <code>BlockOutputStream</code> for the allocated block</li>
<li>Data is written in chunks, which are buffered locally</li>
<li>When buffer fills or flush is triggered, data is written to Datanodes</li>
<li>Each chunk is assigned a sequential index and checksummed</li>
<li>After all data is written, a putBlock operation finalizes the block</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_e_9H" id="ec-pipeline-implementation">EC Pipeline Implementation<a href="#ec-pipeline-implementation" class="hash-link" aria-label="Direct link to EC Pipeline Implementation" title="Direct link to EC Pipeline Implementation">​</a></h4>
<p>EC write pipeline implementation involves several key components:</p>
<ul>
<li><strong>ECKeyOutputStream</strong>: Main client-side class that manages EC writes</li>
<li><strong>ECChunkBuffers</strong>: Maintains buffers for both data and parity chunks</li>
<li><strong>ECBlockOutputStreamEntry</strong>: Manages Datanode connections and write operations</li>
<li><strong>RawErasureEncoder</strong>: Performs the mathematical encoding to generate parity chunks</li>
</ul>
<p>The EC write process follows these steps:</p>
<ol>
<li><strong>Data Buffering</strong>: Client buffers incoming data into chunks</li>
<li><strong>Stripe Formation</strong>: When all data chunks for a stripe are filled, parity is generated</li>
<li><strong>Parallel Write</strong>: Data and parity chunks are written to different Datanodes</li>
<li><strong>Commit</strong>: After all chunks are written, the stripe is committed</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="containers-and-pipelines">Containers and Pipelines<a href="#containers-and-pipelines" class="hash-link" aria-label="Direct link to Containers and Pipelines" title="Direct link to Containers and Pipelines">​</a></h2>
<p>Containers are the fundamental storage units in Ozone, and their relationship with pipelines is essential to understand:</p>
<ul>
<li>Each container (typically 5GB) is associated with a specific pipeline</li>
<li>Multiple containers can exist within a single pipeline</li>
<li>When a container is in the OPEN state, it actively receives data via its pipeline</li>
<li>Once a container is CLOSED, its data can be accessed via any replica node</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="comparing-replication-and-erasure-coding">Comparing Replication and Erasure Coding<a href="#comparing-replication-and-erasure-coding" class="hash-link" aria-label="Direct link to Comparing Replication and Erasure Coding" title="Direct link to Comparing Replication and Erasure Coding">​</a></h2>
<table><thead><tr><th>Feature</th><th>Replication (RATIS/THREE)</th><th>Erasure Coding (RS-6-3)</th></tr></thead><tbody><tr><td>Storage Overhead</td><td>200% (3x copies)</td><td>50% (9 chunks for 6 data chunks)</td></tr><tr><td>Write Performance</td><td>Higher throughput for small writes</td><td>Better for large sequential writes</td></tr><tr><td>Read Performance</td><td>Consistent performance, any replica can serve</td><td>Slightly lower for intact data, reconstruction penalty for lost chunks</td></tr><tr><td>CPU Usage</td><td>Lower</td><td>Higher (encoding/decoding overhead)</td></tr><tr><td>Network Bandwidth</td><td>Higher during writes</td><td>Lower during writes</td></tr><tr><td>Minimum Nodes</td><td>3</td><td>Depends on config (9 for RS-6-3)</td></tr><tr><td>Use Cases</td><td>Hot data, random access, small files</td><td>Warm/cold data, large files, archival</td></tr></tbody></table>
<p><strong>When to use Replication:</strong></p>
<ul>
<li>For frequently accessed &quot;hot&quot; data</li>
<li>For workloads with small random writes</li>
<li>When raw write performance is critical</li>
<li>When CPU resources are limited</li>
</ul>
<p><strong>When to use Erasure Coding:</strong></p>
<ul>
<li>For &quot;warm&quot; or &quot;cold&quot; data with lower access frequency</li>
<li>For large files with sequential access patterns</li>
<li>To optimize storage costs while maintaining durability</li>
<li>For archival or backup storage</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="advanced-topics">Advanced Topics<a href="#advanced-topics" class="hash-link" aria-label="Direct link to Advanced Topics" title="Direct link to Advanced Topics">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="error-handling-and-recovery">Error Handling and Recovery<a href="#error-handling-and-recovery" class="hash-link" aria-label="Direct link to Error Handling and Recovery" title="Direct link to Error Handling and Recovery">​</a></h3>
<p>Both write pipelines implement sophisticated error handling:</p>
<p><strong>Replication Pipeline:</strong></p>
<ul>
<li>Uses Ratis consensus protocol to handle failures</li>
<li>Automatically recovers from minority Datanode failures</li>
<li>Supports pipeline reconstruction if leader fails</li>
<li>Implements idempotent operations for retries</li>
</ul>
<p><strong>EC Pipeline:</strong></p>
<ul>
<li>Tracks failures at the individual chunk level</li>
<li>Can retry specific chunk writes to failed Datanodes</li>
<li>Maintains stripe status to ensure consistency</li>
<li>Implements checksum validation for data integrity</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="performance-considerations">Performance Considerations<a href="#performance-considerations" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations">​</a></h3>
<p><strong>Optimizing Replication Write Pipeline:</strong></p>
<ul>
<li>Adjust buffer sizes based on workload (<code>hdds.client.buffer.size.max</code>)</li>
<li>Configure flush periods for write-heavy workloads</li>
<li>Use Streaming Pipeline (V2) for high-throughput scenarios</li>
<li>Consider network topology when placing Datanodes</li>
</ul>
<p><strong>Optimizing EC Write Pipeline:</strong></p>
<ul>
<li>Choose EC configuration based on workload characteristics</li>
<li>Enable ISA-L hardware acceleration for better performance</li>
<li>Adjust chunk size for optimal performance</li>
<li>Balance between parallelism and overhead</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="monitoring-and-metrics">Monitoring and Metrics<a href="#monitoring-and-metrics" class="hash-link" aria-label="Direct link to Monitoring and Metrics" title="Direct link to Monitoring and Metrics">​</a></h3>
<p>Both write pipelines expose metrics that can be monitored through Ozone&#x27;s Prometheus endpoint or JMX interface:</p>
<p><strong>Key Metrics for Replication Pipeline:</strong></p>
<ul>
<li>Write throughput</li>
<li>Average chunk write latency</li>
<li>Pipeline creation time</li>
<li>Ratis consensus latency</li>
</ul>
<p><strong>Key Metrics for EC Pipeline:</strong></p>
<ul>
<li>Encode time per stripe</li>
<li>Chunk distribution latency</li>
<li>Success rate of first-time stripe writes</li>
<li>Parity calculation overhead</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="benefits-of-write-pipelines">Benefits of Write Pipelines<a href="#benefits-of-write-pipelines" class="hash-link" aria-label="Direct link to Benefits of Write Pipelines" title="Direct link to Benefits of Write Pipelines">​</a></h2>
<p>The pipeline architecture in Ozone provides several key benefits:</p>
<ol>
<li><strong>Reliability</strong>: Automatic failure detection and recovery mechanisms</li>
<li><strong>Consistency</strong>: Strong consistency guarantees for data replication</li>
<li><strong>Scalability</strong>: Efficient management of write operations across thousands of nodes</li>
<li><strong>Flexibility</strong>: Support for different replication strategies depending on needs</li>
<li><strong>Performance</strong>: Optimized data flow paths that minimize network overhead</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Write pipelines form the backbone of Apache Ozone&#x27;s data redundancy architecture, ensuring data is reliably stored and replicated across the cluster. By understanding how write pipelines work, administrators and users can make informed decisions about their Ozone deployment and effectively tune it for specific use cases. Whether you need the raw performance of replication or the storage efficiency of erasure coding, Ozone&#x27;s write pipelines provide the foundation for durable and consistent data storage.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/03-core-concepts/02-replication/02-write-pipelines.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_kQtw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_orCj"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/core-concepts/replication/storage-containers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Storage Containers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/core-concepts/replication/ratis"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ratis</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_reur thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-write-pipelines" class="table-of-contents__link toc-highlight">What are Write Pipelines?</a></li><li><a href="#pipeline-types" class="table-of-contents__link toc-highlight">Pipeline Types</a><ul><li><a href="#1-ratis-pipelines-replicated" class="table-of-contents__link toc-highlight">1. Ratis Pipelines (Replicated)</a></li><li><a href="#2-erasure-coded-pipelines" class="table-of-contents__link toc-highlight">2. Erasure Coded Pipelines</a></li></ul></li><li><a href="#pipeline-lifecycle" class="table-of-contents__link toc-highlight">Pipeline Lifecycle</a></li><li><a href="#how-write-pipelines-work" class="table-of-contents__link toc-highlight">How Write Pipelines Work</a><ul><li><a href="#implementation-details" class="table-of-contents__link toc-highlight">Implementation Details</a></li></ul></li><li><a href="#containers-and-pipelines" class="table-of-contents__link toc-highlight">Containers and Pipelines</a></li><li><a href="#comparing-replication-and-erasure-coding" class="table-of-contents__link toc-highlight">Comparing Replication and Erasure Coding</a></li><li><a href="#advanced-topics" class="table-of-contents__link toc-highlight">Advanced Topics</a><ul><li><a href="#error-handling-and-recovery" class="table-of-contents__link toc-highlight">Error Handling and Recovery</a></li><li><a href="#performance-considerations" class="table-of-contents__link toc-highlight">Performance Considerations</a></li><li><a href="#monitoring-and-metrics" class="table-of-contents__link toc-highlight">Monitoring and Metrics</a></li></ul></li><li><a href="#benefits-of-write-pipelines" class="table-of-contents__link toc-highlight">Benefits of Write Pipelines</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Software Foundation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/ozone/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/github.svg" alt="GitHub Discussions Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/HDDS/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/jira.svg" alt="Jira Issues Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Jira Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://infra.apache.org/slack.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/slack.svg" alt="Slack Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:dev@ozone.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/mail.svg" alt="Mailing List Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Mailing List<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@ApacheOzone" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/youtube.svg" alt="YouTube Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ApacheOzone" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/twitter-x.svg" alt="Twitter Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/ozone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ozone</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-docker" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker Image</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-docker-runner" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker Runner Image</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div>
          Copyright © 2026 <a href="https://www.apache.org/" class="copyright-link">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" class="copyright-link">Apache License, Version 2.0</a>. <br>
          <div>
            <p>The Apache Software Foundation, Apache Ozone, Ozone, Apache, the Apache Feather, and the Apache Ozone project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
          </div>
        </div></div></div></div></footer></div>
</body>
</html>