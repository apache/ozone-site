

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../index.html" class="navbar-left ozone-logo">
        <img src="../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../index.html">
                

                    
                    <span>An Introduction to Apache Ozone</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../start.html">
                    
                    <span>Getting Started</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../start/productiondeployment.html">Production Deployment</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../concept.html">
                    
                    <span>Architecture</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../concept/overview.html">Overview</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../concept/ozonemanager.html">
                                 
                                 <span>Ozone Manager</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../concept/volumesbucketskeys.html">Volumes, Buckets, and Keys</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/datanodes.html">Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/ozones3gateway.html">Ozone S3 Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/recon.html">Recon</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/networkports.html">Network Ports</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/comparison.html">Comparison with Other Storage Technologies</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/rocksdb.html">RocksDB in Apache Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../feature.html">
                    
                    <span>Features</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/om-ha.html">OM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/erasurecoding.html">Ozone Erasure Coding</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/snapshot.html">
                                 
                                 <span>Ozone Snapshot</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/snapshot-configuration-properties.html">Snapshot Configuration Properties</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/scm-ha.html">SCM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/streaming-write-pipeline.html">Streaming Write Pipeline</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/dn-merge-rocksdb.html">Merge Container RocksDB in DN</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/prefixfso.html">Prefix based File System Optimization</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/topology.html">Topology awareness</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/quota.html">Quota in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/recon.html">Recon Server</a>
                           
                        </li>
                    
                        <li class="active">
                           
                           <a href="../feature/observability.html">Observability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/nonrolling-upgrade.html">Non-Rolling Upgrades and Downgrades</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/s3-multi-tenancy.html">
                                 
                                 <span>S3 Multi-Tenancy</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-setup.html">Setup</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-tenant-commands.html">Tenant commands</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-access-control.html">Access Control</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/reconfigurability.html">Reconfigurability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/containerbalancer.html">Container Balancer</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/maintenance.html">Maintenance Mode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/multi-raft-support.html">Multi-Raft Support in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/trash.html">Trash</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../integration.html">
                    
                    <span>Application Integrations</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../integration/distcp.html">Hadoop DistCp</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/hive.html">Hive</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/impala.html">Impala</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../interface.html">
                    
                    <span>Client Interfaces</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../interface/ofs.html">Ofs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/o3fs.html">O3fs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../interface/s3.html">
                                 
                                 <span>S3 Protocol</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../interface/cyberduckozones3.html">Accessing Ozone S3 via CyberDuck</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/cli.html">Command Line Interface</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/python.html">Accessing Apache Ozone from Python</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/csi.html">CSI Protocol</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/httpfs.html">HttpFS Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/native-cpp.html">Native C/C&#43;&#43; Client Access to Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../security.html">
                    
                    <span>Security</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../security/secureozone.html">Securing Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingtde.html">Transparent Data Encryption</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/gdpr.html">GDPR in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingdatanodes.html">Securing Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingozonehttp.html">Securing HTTP</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securings3.html">Securing S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securityacls.html">Ozone ACLs</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/protect-in-transit-traffic.html">Protect In-Transit Traffic</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../tools.html">
                

                    
                    <span>Tools</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../recipe.html">
                

                    
                    <span>Recipes</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../troubleshooting.html">
                

                    
                    <span>Troubleshooting</span>
                </a>
            </li>
        
    
    <li><a href="../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../feature.html">Features</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Observability</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
    
    
    <a href="../zh/feature/observability.html"><span class="label label-success">中文</span></a>
    
    
</div>


          <div class="col-md-9">
            <h1>Observability</h1>

            <!---
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<p>Ozone provides multiple tools to get more information about the current state of the cluster.</p>
<h2 id="prometheus">Prometheus</h2>
<p>Ozone has native support for Prometheus integration. All internal metrics (collected by Hadoop metrics framework) are published under the <code>/prom</code> HTTP endpoint. (For example under http://localhost:9876/prom for SCM).</p>
<p>The Prometheus endpoint is turned on by default but can be turned off by the <code>hdds.prometheus.endpoint.enabled</code> configuration variable.</p>
<p>In a secure environment the page is guarded with SPNEGO authentication which is not supported by Prometheus. To enable monitoring in a secure environment, a specific authentication token can be configured</p>
<p>Example <code>ozone-site.xml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&lt;name&gt;</span>hdds.prometheus.endpoint.token<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&lt;value&gt;</span>putyourtokenhere<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p>Example prometheus configuration:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-YAML" data-lang="YAML"><span style="display:flex;"><span><span style="color:#f92672">scrape_configs</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">job_name</span>: <span style="color:#ae81ff">ozone</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">bearer_token</span>: <span style="color:#ae81ff">&lt;putyourtokenhere&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metrics_path</span>: <span style="color:#ae81ff">/prom</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span>         - <span style="color:#e6db74">&#34;127.0.0.1:9876&#34;</span> 
</span></span></code></pre></div><h2 id="grafana">Grafana</h2>
<p>Once Prometheus is up and running, Grafana can be configured to monitor and visualize Ozone metrics.</p>
<h3 id="add-prometheus-as-a-data-source">Add Prometheus as a data source</h3>
<p>In the Grafana web UI, go to <code>Add Data Sources</code> and then select <code>Prometheus</code>.</p>
<p>Enter the Prometheus hostname/port in the <code>HTTP</code>. For example, http://localhost:9094 (verify the port used by looking at Prometheus command line flags <code>-web.listen-address</code>. The port can also be found from Prometheus web UI → Status → Command-Line Flags.)</p>
<p>Choose Prometheus type: <code>Prometheus</code></p>
<p>Choose Prometheus version: <code>2.37.x</code></p>
<p>Finish the setup by clicking on <code>Save and Test</code>.</p>
<h3 id="import-a-grafana-dashboard-for-ozone">Import a Grafana dashboard for Ozone</h3>
<p>Apache Ozone comes with a default Grafana dashboard. Follow the instructions below to import it:</p>
<p>Download dashboard json:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/apache/ozone/master/hadoop-ozone/dist/src/main/compose/common/grafana/dashboards/Ozone%20-%20Overall%20Metrics.json
</span></span></code></pre></div><p>Open Grafana portal and click on Dashboards on the left and select <code>Import</code>.</p>
<p>Click at <code>Upload JSON file</code> and select the file <code>Ozone - Overall Metrics.json</code> that was just downloaded.</p>
<p>The dashboard is now imported.</p>
<p>

<img src="GrafanaOzoneOverall.png" alt='Overall dashboard'  class="img-responsive" /></p>
<p>Repeat the same for <a href="https://raw.githubusercontent.com/apache/ozone/master/hadoop-ozone/dist/src/main/compose/common/grafana/dashboards/Ozone%20-%20Object%20Metrics.json">Object Metrics</a> dashboard and <a href="https://raw.githubusercontent.com/apache/ozone/master/hadoop-ozone/dist/src/main/compose/common/grafana/dashboards/Ozone%20-%20RPC%20Metrics.json">RPC Metrics</a> dashboard. (For more dashboards, including Create/Read/List/Delete Key, OM Snapshot, OM CommitIndex, OM RocksDB, S3 Object, RPC, JVM and Memory Metrics, see <a href="https://github.com/apache/ozone/tree/master/hadoop-ozone/dist/src/main/compose/common/grafana/dashboards">this folder</a>.)</p>
<p>

<img src="GrafanaOzoneObjectMetrics.png" alt='Object dashboard'  class="img-responsive" /></p>
<p>

<img src="GrafanaOzoneRPCMetrics.png" alt='RPC dashboard'  class="img-responsive" /></p>
<h2 id="distributed-tracing">Distributed tracing</h2>
<p>Distributed tracing can help to understand performance bottleneck with visualizing end-to-end performance.
Ozone makes use of <a href="https://opentelemetry.io/">OpenTelemetry</a> API for tracing and uses otlp with Grpc format for sending traces.
<a href="https://jaegertracing.io">jaeger</a> tracing library as collector can collect traces from Ozone over default port 4317 (as default).</p>
<p>Tracing is turned off by default, but can be turned on with <code>hdds.tracing.enabled</code> from <code>ozone-site.xml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&lt;name&gt;</span>hdds.tracing.enabled<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&lt;value&gt;</span>true<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p>Below are the configuration steps for setting the collector endpoint and sampling strategy. Set these environment variables to be set for each Ozone component (OM, SCM, datanode) and for the Ozone client to enable tracing.</p>
<pre tabindex="0"><code>OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_TRACES_SAMPLER_ARG=0.01
</code></pre><p>This configuration will record 1% of the requests to limit the performance overhead.</p>
<h2 id="ozone-insight">ozone insight</h2>
<p>Ozone insight is a swiss-army-knife tool to for checking the current state of Ozone cluster. It can show logging, metrics and configuration for a particular component.</p>
<p>To check the available components use <code>ozone insight list</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; ozone insight list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Available insight points:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  scm.node-manager                     SCM Datanode management related information.
</span></span><span style="display:flex;"><span>  scm.replica-manager                  SCM closed container replication manager
</span></span><span style="display:flex;"><span>  scm.event-queue                      Information about the internal async event delivery
</span></span><span style="display:flex;"><span>  scm.protocol.block-location          SCM Block location protocol endpoint
</span></span><span style="display:flex;"><span>  scm.protocol.container-location      SCM Container location protocol endpoint
</span></span><span style="display:flex;"><span>  scm.protocol.security                SCM Block location protocol endpoint
</span></span><span style="display:flex;"><span>  om.key-manager                       OM Key Manager
</span></span><span style="display:flex;"><span>  om.protocol.client                   Ozone Manager RPC endpoint
</span></span><span style="display:flex;"><span>  datanode.pipeline                    More information about one ratis datanode ring.
</span></span></code></pre></div><h3 id="configuration">Configuration</h3>
<p><code>ozone insight config</code> can show configuration related to a specific component (supported only for selected components).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; ozone insight config scm.replica-manager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Configuration <span style="color:#66d9ef">for</span> <span style="color:#e6db74">`</span>scm.replica-manager<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span>SCM closed container replication manager<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; hdds.scm.replication.thread.interval
</span></span><span style="display:flex;"><span>       default: 300s
</span></span><span style="display:flex;"><span>       current: 300s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>There is a replication monitor thread running inside SCM which takes care of replicating the containers in the cluster. This property is used to configure the interval in which that thread runs.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; hdds.scm.replication.event.timeout
</span></span><span style="display:flex;"><span>       default: 30m
</span></span><span style="display:flex;"><span>       current: 30m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Timeout <span style="color:#66d9ef">for</span> the container replication/deletion commands sent  to datanodes. After this timeout the command will be retried.
</span></span></code></pre></div><h3 id="metrics">Metrics</h3>
<p><code>ozone insight metrics</code> can show metrics related to a specific component (supported only for selected components).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; ozone insight metrics scm.protocol.block-location
</span></span><span style="display:flex;"><span>Metrics <span style="color:#66d9ef">for</span> <span style="color:#e6db74">`</span>scm.protocol.block-location<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span>SCM Block location protocol endpoint<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RPC connections
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Open connections: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  Dropped connections: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  Received bytes: <span style="color:#ae81ff">1267</span>
</span></span><span style="display:flex;"><span>  Sent bytes: <span style="color:#ae81ff">2420</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RPC queue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RPC average queue time: 0.0
</span></span><span style="display:flex;"><span>  RPC call queue length: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RPC performance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RPC processing time average: 0.0
</span></span><span style="display:flex;"><span>  Number of slow calls: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Message type counters
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Number of AllocateScmBlock: ???
</span></span><span style="display:flex;"><span>  Number of DeleteScmKeyBlocks: ???
</span></span><span style="display:flex;"><span>  Number of GetScmInfo: ???
</span></span><span style="display:flex;"><span>  Number of SortDatanodes: ???
</span></span></code></pre></div><h3 id="logs">Logs</h3>
<p><code>ozone insight logs</code> can connect to the required service and show the DEBUG/TRACE log related to one specific component. For example to display RPC message:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt;ozone insight logs om.protocol.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OM<span style="color:#f92672">]</span> 2020-07-28 12:31:49,988 <span style="color:#f92672">[</span>DEBUG|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher<span style="color:#f92672">]</span> OzoneProtocol ServiceList request is received
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OM<span style="color:#f92672">]</span> 2020-07-28 12:31:50,095 <span style="color:#f92672">[</span>DEBUG|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher<span style="color:#f92672">]</span> OzoneProtocol CreateVolume request is received
</span></span></code></pre></div><p>Using <code>-v</code> flag the content of the protobuf message can also be displayed (TRACE level log):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ozone insight logs -v om.protocol.client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OM<span style="color:#f92672">]</span> 2020-07-28 12:33:28,463 <span style="color:#f92672">[</span>TRACE|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>service<span style="color:#f92672">=</span>OzoneProtocol<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">=</span>CreateVolume<span style="color:#f92672">]</span> request is received:
</span></span><span style="display:flex;"><span>cmdType: CreateVolume
</span></span><span style="display:flex;"><span>traceID: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>clientId: <span style="color:#e6db74">&#34;client-A31DF5C6ECF2&#34;</span>
</span></span><span style="display:flex;"><span>createVolumeRequest <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  volumeInfo <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    adminName: <span style="color:#e6db74">&#34;hadoop&#34;</span>
</span></span><span style="display:flex;"><span>    ownerName: <span style="color:#e6db74">&#34;hadoop&#34;</span>
</span></span><span style="display:flex;"><span>    volume: <span style="color:#e6db74">&#34;vol1&#34;</span>
</span></span><span style="display:flex;"><span>    quotaInBytes: <span style="color:#ae81ff">1152921504606846976</span>
</span></span><span style="display:flex;"><span>    volumeAcls <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type: USER
</span></span><span style="display:flex;"><span>      name: <span style="color:#e6db74">&#34;hadoop&#34;</span>
</span></span><span style="display:flex;"><span>      rights: <span style="color:#e6db74">&#34;200&#34;</span>
</span></span><span style="display:flex;"><span>      aclScope: ACCESS
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    volumeAcls <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type: GROUP
</span></span><span style="display:flex;"><span>      name: <span style="color:#e6db74">&#34;users&#34;</span>
</span></span><span style="display:flex;"><span>      rights: <span style="color:#e6db74">&#34;200&#34;</span>
</span></span><span style="display:flex;"><span>      aclScope: ACCESS
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    creationTime: <span style="color:#ae81ff">1595939608460</span>
</span></span><span style="display:flex;"><span>    objectID: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    updateID: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    modificationTime: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OM<span style="color:#f92672">]</span> 2020-07-28 12:33:28,474 <span style="color:#f92672">[</span>TRACE|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>service<span style="color:#f92672">=</span>OzoneProtocol<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">=</span>CreateVolume<span style="color:#f92672">]</span> request is processed. Response:
</span></span><span style="display:flex;"><span>cmdType: CreateVolume
</span></span><span style="display:flex;"><span>traceID: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>success: false
</span></span><span style="display:flex;"><span>message: <span style="color:#e6db74">&#34;Volume already exists&#34;</span>
</span></span><span style="display:flex;"><span>status: VOLUME_ALREADY_EXISTS
</span></span></code></pre></div><div class="alert alert-warning" role="alert">
<p>Under the hood <code>ozone insight</code> uses HTTP endpoints to retrieve the required information (<code>/conf</code>, <code>/prom</code> and <code>/logLevel</code> endpoints). It&rsquo;s not yet supported in secure environment.</p>
</div>


          
          <a class="btn  btn-success btn-lg" href="../feature/nonrolling-upgrade.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: 2.2.0-SNAPSHOT, Last Modified: September 22, 2025 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/8887a14030fcd0ad0e285b42f6b9fab5956200ea">8887a14030</a>
    </span>
  </div>
</footer>



<script src="../js/jquery-3.5.1.min.js"></script>
<script src="../js/ozonedoc.js"></script>
<script src="../js/bootstrap.min.js"></script>


</body>

</html>