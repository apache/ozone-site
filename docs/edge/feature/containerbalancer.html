

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../index.html" class="navbar-left ozone-logo">
        <img src="../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../index.html">
                

                    
                    <span>An Introduction to Apache Ozone</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../start/index.html">
                    
                    <span>Getting Started</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../start/productiondeployment.html">Production Deployment</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../concept/index.html">
                    
                    <span>Architecture</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../concept/overview.html">Overview</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../concept/ozonemanager.html">
                                 
                                 <span>Ozone Manager</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../concept/volumesbucketskeys.html">Volumes, Buckets, and Keys</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/datanodes.html">Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/ozones3gateway.html">Ozone S3 Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/recon.html">Recon</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/networkports.html">Network Ports</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/comparison.html">Comparison with Other Storage Technologies</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/rocksdb.html">RocksDB in Apache Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../feature/index.html">
                    
                    <span>Features</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/om-ha.html">OM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/erasurecoding.html">Ozone Erasure Coding</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/snapshot.html">
                                 
                                 <span>Ozone Snapshot</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/snapshot-configuration-properties.html">Snapshot Configuration Properties</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/scm-ha.html">SCM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/streaming-write-pipeline.html">Streaming Write Pipeline</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/dn-merge-rocksdb.html">Merge Container RocksDB in DN</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/prefixfso.html">Prefix based File System Optimization</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/topology.html">Topology awareness</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/quota.html">Quota in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/recon.html">Recon Server</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/observability.html">Observability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/nonrolling-upgrade.html">Non-Rolling Upgrades and Downgrades</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/s3-multi-tenancy.html">
                                 
                                 <span>S3 Multi-Tenancy</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-setup.html">Setup</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-tenant-commands.html">Tenant commands</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-access-control.html">Access Control</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/reconfigurability.html">Reconfigurability</a>
                           
                        </li>
                    
                        <li class="active">
                           
                           <a href="../feature/containerbalancer.html">Container Balancer</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/maintenance.html">Maintenance Mode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/multi-raft-support.html">Multi-Raft Support in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/trash.html">Trash</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../integration/index.html">
                    
                    <span>Application Integrations</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../integration/distcp.html">Hadoop DistCp</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/hive.html">Hive</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/impala.html">Impala</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../interface/index.html">
                    
                    <span>Client Interfaces</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../interface/ofs.html">Ofs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/o3fs.html">O3fs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../interface/s3.html">
                                 
                                 <span>S3 Protocol</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../interface/cyberduckozones3.html">Accessing Ozone S3 via CyberDuck</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/cli.html">Command Line Interface</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/python.html">Accessing Apache Ozone from Python</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/csi.html">CSI Protocol</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/httpfs.html">HttpFS Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/native-cpp.html">Native C/C&#43;&#43; Client Access to Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../security/index.html">
                    
                    <span>Security</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../security/secureozone.html">Securing Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingtde.html">Transparent Data Encryption</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/gdpr.html">GDPR in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingdatanodes.html">Securing Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingozonehttp.html">Securing HTTP</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securings3.html">Securing S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securityacls.html">Ozone ACLs</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/protect-in-transit-traffic.html">Protect In-Transit Traffic</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../tools/index.html">
                

                    
                    <span>Tools</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../recipe/index.html">
                

                    
                    <span>Recipes</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../troubleshooting/index.html">
                

                    
                    <span>Troubleshooting</span>
                </a>
            </li>
        
    
    <li><a href="../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../feature/index.html">Features</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Container Balancer</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
</div>


          <div class="col-md-9">
            <h1>Container Balancer</h1>

            <!---
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<h2 id="overview">Overview</h2>
<p>The Container Balancer is a tool in Apache Ozone that balances data containers across the cluster. Its primary goal is to ensure an even distribution of data based on disk space usage on datanodes. This helps to prevent some datanodes from becoming full while others remain underutilized.</p>
<p>The balancer operates by moving <code>CLOSED</code> container replicas, which means it doesn&rsquo;t interfere with active I/O operations. It is designed to work with both regular and Erasure Coded (EC) containers. To maintain cluster stability, the Container Balancer&rsquo;s startup is delayed after a Storage Container Manager (SCM) failover.</p>
<h2 id="command-line-usage">Command Line Usage</h2>
<p>The Container Balancer is managed through the <code>ozone admin containerbalancer</code> command.</p>
<h3 id="start">Start</h3>
<p>To start the Container Balancer with default settings:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin containerbalancer start
</span></span></code></pre></div><p>You can also start the balancer with specific options:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin containerbalancer start <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>Options:</strong></p>
<table>
  <thead>
      <tr>
          <th>Option</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>-t</code>, <code>--threshold</code></td>
          <td>The percentage deviation from the average utilization of the cluster after which a datanode will be rebalanced. Default is 10%.</td>
      </tr>
      <tr>
          <td><code>-i</code>, <code>--iterations</code></td>
          <td>The maximum number of consecutive iterations the balancer will run for. Default is 10. Use -1 for infinite iterations.</td>
      </tr>
      <tr>
          <td><code>-d</code>, <code>--maxDatanodesPercentageToInvolvePerIteration</code></td>
          <td>The maximum percentage of healthy, in-service datanodes that can be involved in balancing in one iteration. Default is 20%.</td>
      </tr>
      <tr>
          <td><code>-s</code>, <code>--maxSizeToMovePerIterationInGB</code></td>
          <td>The maximum size of data in GB to be moved in one iteration. Default is 500GB.</td>
      </tr>
      <tr>
          <td><code>-e</code>, <code>--maxSizeEnteringTargetInGB</code></td>
          <td>The maximum size in GB that can enter a target datanode in one iteration. Default is 26GB.</td>
      </tr>
      <tr>
          <td><code>-l</code>, <code>--maxSizeLeavingSourceInGB</code></td>
          <td>The maximum size in GB that can leave a source datanode in one iteration. Default is 26GB.</td>
      </tr>
      <tr>
          <td><code>--balancing-iteration-interval-minutes</code></td>
          <td>The interval in minutes between each iteration of the Container Balancer. Default is 70 minutes.</td>
      </tr>
      <tr>
          <td><code>--move-timeout-minutes</code></td>
          <td>The time in minutes to allow a single container to move from source to target. Default is 65 minutes.</td>
      </tr>
      <tr>
          <td><code>--move-replication-timeout-minutes</code></td>
          <td>The time in minutes to allow a single container&rsquo;s replication from source to target as part of a container move. Default is 50 minutes.</td>
      </tr>
      <tr>
          <td><code>--move-network-topology-enable</code></td>
          <td>Whether to consider network topology when selecting a target for a source. Default is false.</td>
      </tr>
      <tr>
          <td><code>--include-datanodes</code></td>
          <td>A comma-separated list of datanode hostnames or IP addresses to be included in balancing.</td>
      </tr>
      <tr>
          <td><code>--exclude-datanodes</code></td>
          <td>A comma-separated list of datanode hostnames or IP addresses to be excluded from balancing.</td>
      </tr>
  </tbody>
</table>
<h3 id="status">Status</h3>
<p>To check the status of the Container Balancer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin containerbalancer status
</span></span></code></pre></div><p>To get a more detailed status, including the history of iterations:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin containerbalancer status -v --history
</span></span></code></pre></div><h3 id="stop">Stop</h3>
<p>To stop the Container Balancer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin containerbalancer stop
</span></span></code></pre></div><h2 id="configuration">Configuration</h2>
<p>The Container Balancer can also be configured through the <code>ozone-site.xml</code> file.</p>
<table>
  <thead>
      <tr>
          <th>Property</th>
          <th>Description</th>
          <th>Default Value</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>hdds.container.balancer.utilization.threshold</code></td>
          <td>A cluster is considered balanced if for each datanode, the utilization of the datanode differs from the utilization of the cluster no more than this threshold.</td>
          <td>10%</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.datanodes.involved.max.percentage.per.iteration</code></td>
          <td>Maximum percentage of healthy, in-service datanodes that can be involved in balancing in one iteration.</td>
          <td>20%</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.size.moved.max.per.iteration</code></td>
          <td>The maximum size of data that will be moved by Container Balancer in one iteration.</td>
          <td>500GB</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.size.entering.target.max</code></td>
          <td>The maximum size that can enter a target datanode in each iteration.</td>
          <td>26GB</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.size.leaving.source.max</code></td>
          <td>The maximum size that can leave a source datanode in each iteration.</td>
          <td>26GB</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.iterations</code></td>
          <td>The number of iterations that Container Balancer will run for.</td>
          <td>10</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.exclude.containers</code></td>
          <td>A comma-separated list of container IDs to exclude from balancing.</td>
          <td>&quot;&quot;</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.move.timeout</code></td>
          <td>The amount of time to allow a single container to move from source to target.</td>
          <td>65m</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.move.replication.timeout</code></td>
          <td>The amount of time to allow a single container&rsquo;s replication from source to target as part of a container move.</td>
          <td>50m</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.balancing.iteration.interval</code></td>
          <td>The interval period between each iteration of Container Balancer.</td>
          <td>70m</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.include.datanodes</code></td>
          <td>A comma-separated list of Datanode hostnames or IP addresses. Only the Datanodes specified in this list are balanced.</td>
          <td>&quot;&quot;</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.exclude.datanodes</code></td>
          <td>A comma-separated list of Datanode hostnames or IP addresses. The Datanodes specified in this list are excluded from balancing.</td>
          <td>&quot;&quot;</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.move.networkTopology.enable</code></td>
          <td>Whether to take network topology into account when selecting a target for a source.</td>
          <td>false</td>
      </tr>
      <tr>
          <td><code>hdds.container.balancer.trigger.du.before.move.enable</code></td>
          <td>Whether to send a command to all healthy and in-service data nodes to run <code>du</code> immediately before starting a balance iteration.</td>
          <td>false</td>
      </tr>
  </tbody>
</table>


          
          <a class="btn  btn-success btn-lg" href="../feature/maintenance.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: 2.2.0-SNAPSHOT, Last Modified: July 15, 2025 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/293ccd6b1235281d23fc933aeb45fe8d47f96340">293ccd6b12</a>
    </span>
  </div>
</footer>



<script src="../js/jquery-3.5.1.min.js"></script>
<script src="../js/ozonedoc.js"></script>
<script src="../js/bootstrap.min.js"></script>


</body>

</html>