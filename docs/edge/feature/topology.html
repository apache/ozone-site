

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../index.html" class="navbar-left ozone-logo">
        <img src="../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../index.html">
                

                    
                    <span>An Introduction to Apache Ozone</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../start/index.html">
                    
                    <span>Getting Started</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../start/productiondeployment.html">Production Deployment</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../concept/index.html">
                    
                    <span>Architecture</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../concept/overview.html">Overview</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../concept/ozonemanager.html">
                                 
                                 <span>Ozone Manager</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../concept/volumesbucketskeys.html">Volumes, Buckets, and Keys</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/datanodes.html">Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/ozones3gateway.html">Ozone S3 Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/recon.html">Recon</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/networkports.html">Network Ports</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/comparison.html">Comparison with Other Storage Technologies</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/rocksdb.html">RocksDB in Apache Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../feature/index.html">
                    
                    <span>Features</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/om-ha.html">OM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/erasurecoding.html">Ozone Erasure Coding</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/snapshot.html">
                                 
                                 <span>Ozone Snapshot</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/snapshot-configuration-properties.html">Snapshot Configuration Properties</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/scm-ha.html">SCM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/streaming-write-pipeline.html">Streaming Write Pipeline</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/dn-merge-rocksdb.html">Merge Container RocksDB in DN</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/prefixfso.html">Prefix based File System Optimization</a>
                           
                        </li>
                    
                        <li class="active">
                           
                           <a href="../feature/topology.html">Topology awareness</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/quota.html">Quota in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/recon.html">Recon Server</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/observability.html">Observability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/nonrolling-upgrade.html">Non-Rolling Upgrades and Downgrades</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/s3-multi-tenancy.html">
                                 
                                 <span>S3 Multi-Tenancy</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-setup.html">Setup</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-tenant-commands.html">Tenant commands</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-access-control.html">Access Control</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/reconfigurability.html">Reconfigurability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/containerbalancer.html">Container Balancer</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/maintenance.html">Maintenance Mode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/multi-raft-support.html">Multi-Raft Support in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/trash.html">Trash</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../integration/index.html">
                    
                    <span>Application Integrations</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../integration/distcp.html">Hadoop DistCp</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/hive.html">Hive</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/impala.html">Impala</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../interface/index.html">
                    
                    <span>Client Interfaces</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../interface/ofs.html">Ofs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/o3fs.html">O3fs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../interface/s3.html">
                                 
                                 <span>S3 Protocol</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../interface/cyberduckozones3.html">Accessing Ozone S3 via CyberDuck</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/cli.html">Command Line Interface</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/python.html">Accessing Apache Ozone from Python</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/csi.html">CSI Protocol</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/httpfs.html">HttpFS Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/native-cpp.html">Native C/C&#43;&#43; Client Access to Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../security/index.html">
                    
                    <span>Security</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../security/secureozone.html">Securing Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingtde.html">Transparent Data Encryption</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/gdpr.html">GDPR in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingdatanodes.html">Securing Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingozonehttp.html">Securing HTTP</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securings3.html">Securing S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securityacls.html">Ozone ACLs</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/protect-in-transit-traffic.html">Protect In-Transit Traffic</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../tools/index.html">
                

                    
                    <span>Tools</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../recipe/index.html">
                

                    
                    <span>Recipes</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../troubleshooting/index.html">
                

                    
                    <span>Troubleshooting</span>
                </a>
            </li>
        
    
    <li><a href="../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../feature/index.html">Features</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Topology awareness</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
    
    
    <a href="../zh/feature/topology.html"><span class="label label-success">中文</span></a>
    
    
</div>


          <div class="col-md-9">
            <h1>Topology awareness</h1>

            <!---
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<p>Apache Ozone uses topology information (e.g., rack placement) to optimize data access and improve resilience. A fully rack-aware cluster needs:</p>
<ol>
<li>Configured network topology.</li>
<li>Topology-aware DataNode selection for container replica placement (write path).</li>
<li>Prioritized reads from topologically closest DataNodes (read path).</li>
</ol>
<h2 id="applicability-to-container-types">Applicability to Container Types</h2>
<p>Ozone&rsquo;s topology-aware strategies apply differently depending on the operation:</p>
<ul>
<li><strong>Write Path (Open Containers):</strong> When a client writes data, topology awareness is used during <strong>pipeline creation</strong> to ensure the set of datanodes forming the pipeline are on different racks. This provides fault tolerance for the initial write.</li>
<li><strong>Re-replication Path (Closed Containers):</strong> When a replica of a <strong>closed</strong> container is needed (due to node failure, decommissioning, or balancing), a topology-aware policy is used to select the best datanode for the new replica.</li>
</ul>
<p>See the <a href="../concept/containers.html">page about Containers</a> for more information related to Open vs Closed containers.</p>
<h2 id="configuring-topology-hierarchy">Configuring Topology Hierarchy</h2>
<p>Ozone determines DataNode network locations (e.g., racks) using Hadoop&rsquo;s rack awareness, configured via <code>net.topology.node.switch.mapping.impl</code> in <code>ozone-site.xml</code>. This key specifies a <code>org.apache.hadoop.net.CachedDNSToSwitchMapping</code> implementation. [1]</p>
<p>Two primary methods exist:</p>
<h3 id="1-static-list-tablemapping">1. Static List: <code>TableMapping</code></h3>
<p>Maps IPs/hostnames to racks using a predefined file.</p>
<ul>
<li><strong>Configuration:</strong> Set <code>net.topology.node.switch.mapping.impl</code> to <code>org.apache.hadoop.net.TableMapping</code> and <code>net.topology.table.file.name</code> to the mapping file&rsquo;s path. [1]
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>net.topology.node.switch.mapping.impl<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>org.apache.hadoop.net.TableMapping<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>net.topology.table.file.name<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>/etc/ozone/topology.map<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div></li>
<li><strong>File Format:</strong> A two-column text file (IP/hostname, rack path per line). Unlisted nodes go to <code>/default-rack</code>. [1]
Example <code>topology.map</code>:
<pre tabindex="0"><code>192.168.1.100 /rack1
datanode101.example.com /rack1
192.168.1.102 /rack2
datanode103.example.com /rack2
</code></pre></li>
</ul>
<h3 id="2-dynamic-list-scriptbasedmapping">2. Dynamic List: <code>ScriptBasedMapping</code></h3>
<p>Uses an external script to resolve rack locations for IPs.</p>
<ul>
<li><strong>Configuration:</strong> Set <code>net.topology.node.switch.mapping.impl</code> to <code>org.apache.hadoop.net.ScriptBasedMapping</code> and <code>net.topology.script.file.name</code> to the script&rsquo;s path. [1]
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>net.topology.node.switch.mapping.impl<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>org.apache.hadoop.net.ScriptBasedMapping<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>net.topology.script.file.name<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>/etc/ozone/determine_rack.sh<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div></li>
<li><strong>Script:</strong> Admin-provided, executable script. Ozone passes IPs (up to <code>net.topology.script.number.args</code>, default 100) as arguments; script outputs rack paths (one per line).
Example <code>determine_rack.sh</code>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># This is a simplified example. A real script might query a CMDB or use other logic.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> $# -gt <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span> ; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  nodeAddress<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$nodeAddress<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;192.168.1.100&#34;</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;</span>$nodeAddress<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;datanode101.example.com&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;/rack1&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">elif</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$nodeAddress<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;192.168.1.102&#34;</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;</span>$nodeAddress<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;datanode103.example.com&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;/rack2&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;/default-rack&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  shift
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div></li>
</ul>
<p>Ensure the script is executable (<code>chmod +x /etc/ozone/determine_rack.sh</code>).</p>
<p><strong>Note:</strong> For production environments, implement robust error handling and validation in your script. This should include handling network timeouts, invalid inputs, CMDB query failures, and logging errors appropriately. The example above is simplified for illustration purposes only.</p>
<p><strong>Topology Mapping Best Practices:</strong></p>
<ul>
<li><strong>Accuracy:</strong> Mappings must be accurate and current.</li>
<li><strong>Static Mapping:</strong> Simpler for small, stable clusters; requires manual updates.</li>
<li><strong>Dynamic Mapping:</strong> Flexible for large/dynamic clusters. Script performance, correctness, and reliability are vital; ensure it&rsquo;s idempotent and handles batch lookups efficiently.</li>
</ul>
<h2 id="placement-and-selection-policies">Placement and Selection Policies</h2>
<p>Ozone uses three distinct types of policies to manage how and where data is written.</p>
<h3 id="1-pipeline-creation-policy">1. Pipeline Creation Policy</h3>
<p>This policy selects a set of datanodes to form a new pipeline. Its purpose is to ensure new pipelines are internally fault-tolerant by spreading their nodes across racks, while also balancing the number of pipelines across the datanodes. This is the primary mechanism for topology awareness on the write path for open containers.</p>
<p>The policy is configured by the <code>ozone.scm.pipeline.placement.impl</code> property in <code>ozone-site.xml</code>.</p>
<ul>
<li><strong><code>PipelinePlacementPolicy</code> (Default)</strong>
<ul>
<li><strong>Function:</strong> This is the default and only supported policy for pipeline creation. It chooses datanodes based on load balancing (pipeline count per node) and network topology. It filters out nodes that are too heavily engaged in other pipelines and then selects nodes to ensure rack diversity. This policy is recommended for most production environments.</li>
<li><strong>Use Cases:</strong> General purpose pipeline creation in a rack-aware cluster.</li>
</ul>
</li>
</ul>
<h3 id="2-pipeline-selection-load-balancing-policy">2. Pipeline Selection (Load Balancing) Policy</h3>
<p>After a pool of healthy, open, and rack-aware pipelines has been created, this policy is used to <strong>select one</strong> of them to handle a client&rsquo;s write request. Its purpose is <strong>load balancing</strong>, not topology awareness, as the topology has already been handled during pipeline creation.</p>
<p>The policy is configured by <code>hdds.scm.pipeline.choose.policy.impl</code> in <code>ozone-site.xml</code>.</p>
<ul>
<li><strong><code>RandomPipelineChoosePolicy</code> (Default):</strong> Selects a pipeline at random from the available list. This policy is simple and distributes load without considering other metrics.</li>
<li><strong><code>CapacityPipelineChoosePolicy</code>:</strong> Picks two random pipelines and selects the one with lower utilization, favoring pipelines with more available capacity.</li>
<li><strong><code>RoundRobinPipelineChoosePolicy</code>:</strong> Selects pipelines in a round-robin order. This is mainly for debugging and testing.</li>
<li><strong><code>HealthyPipelineChoosePolicy</code>:</strong> Randomly selects pipelines but only returns a healthy one.</li>
</ul>
<p>Note: When configuring these values, include the full class name prefix: for example, org.apache.hadoop.hdds.scm.pipeline.choose.algorithms.CapacityPipelineChoosePolicy</p>
<h3 id="3-closed-container-replication-policy">3. Closed Container Replication Policy</h3>
<p>This is configured using the <code>ozone.scm.container.placement.impl</code> property in <code>ozone-site.xml</code>. The available policies are:</p>
<ul>
<li>
<p><strong><code>SCMContainerPlacementRackAware</code> (Default)</strong></p>
<ul>
<li><strong>Function:</strong> Distributes the datanodes of a pipeline across racks for fault tolerance (e.g., for a 3-node pipeline, it aims for at least two racks). Similar to HDFS placement. [1]</li>
<li><strong>Use Cases:</strong> Production clusters needing rack-level fault tolerance.</li>
<li><strong>Limitations:</strong> Designed for single-layer rack topologies (e.g., <code>/rack/node</code>). Not recommended for multi-layer hierarchies (e.g., <code>/dc/row/rack/node</code>) as it may not interpret deeper levels correctly. [1]</li>
</ul>
</li>
<li>
<p><strong><code>SCMContainerPlacementRandom</code></strong></p>
<ul>
<li><strong>Function:</strong> Randomly selects healthy, available DataNodes, ignoring rack topology. [3]</li>
<li><strong>Use Cases:</strong> Small/dev/test clusters where rack fault tolerance is not critical.</li>
</ul>
</li>
<li>
<p><strong><code>SCMContainerPlacementCapacity</code></strong></p>
<ul>
<li><strong>Function:</strong> Selects DataNodes by available capacity (favors lower disk utilization) to balance disk usage across the cluster. [4]</li>
<li><strong>Use Cases:</strong> Heterogeneous storage clusters or where even disk utilization is key.</li>
</ul>
</li>
</ul>
<p>Note: When configuring these values, include the full class name prefix: for example, org.apache.hadoop.hdds.scm.container.placement.algorithms.SCMContainerPlacementCapacity</p>
<h2 id="container-placement-for-erasure-coded-ec-containers">Container Placement for Erasure Coded (EC) Containers</h2>
<p>For Erasure Coded (EC) containers, SCM employs a specialized placement policy to ensure data resilience and availability by distributing data and parity blocks across multiple racks. This is configured using the <code>ozone.scm.container.placement.ec.impl.key</code> property in <code>ozone-site.xml</code>.</p>
<h3 id="1-scmcontainerplacementrackscatter-default">1. <code>SCMContainerPlacementRackScatter</code> (Default)</h3>
<ul>
<li><strong>Function:</strong> This is the default policy for EC containers. It attempts to place each block (both data and parity) of an EC container on a different rack. For example, for an RS-6-3-1024k container (6 data blocks + 3 parity blocks), this policy will try to place the 9 blocks on 9 different racks. This &ldquo;scatter&rdquo; approach maximizes the fault tolerance, as the loss of a single rack will not impact more than one block of the container. [5]</li>
<li><strong>Use Cases:</strong> This policy is highly recommended for production clusters using Erasure Coding to protect against rack-level failures.</li>
<li><strong>Configuration:</strong>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>ozone.scm.container.placement.ec.impl.key<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>org.apache.hadoop.hdds.scm.container.placement.algorithms.SCMContainerPlacementRackScatter<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div></li>
<li><strong>Behavior:</strong> If the number of available racks is less than the number of blocks in the EC group, the policy will start placing more than one block on the same rack, while trying to keep the distribution as even as possible.</li>
<li><strong>Limitations:</strong> Similar to <code>SCMContainerPlacementRackAware</code>, this policy is designed for single-layer rack topologies (e.g., <code>/rack/node</code>) and is not recommended for multi-layer hierarchies.</li>
</ul>
<h2 id="optimizing-read-paths">Optimizing Read Paths</h2>
<p>Enable by setting <code>ozone.network.topology.aware.read</code> to <code>true</code> in <code>ozone-site.xml</code>. [1]</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>ozone.network.topology.aware.read<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>true<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p>This directs clients (replicated data) to read from topologically closest DataNodes, reducing latency and cross-rack traffic. Recommended with accurate topology.</p>
<h2 id="summary-of-best-practices">Summary of Best Practices</h2>
<ul>
<li><strong>Accurate Topology:</strong> Maintain an accurate, up-to-date topology map (static or dynamic script); this is foundational.</li>
<li><strong>Pipeline Creation:</strong> For production environments, use the default <code>PipelinePlacementPolicy</code> for <code>ozone.scm.pipeline.placement.impl</code> to ensure both rack fault tolerance and pipeline load balancing.</li>
<li><strong>Pipeline Selection:</strong> The default <code>RandomPipelineChoosePolicy</code> for <code>hdds.scm.pipeline.choose.policy.impl</code> is suitable for general load balancing.</li>
<li><strong>Replicated (RATIS) Containers:</strong> For production, use <code>SCMContainerPlacementRackAware</code> (mindful of its single-layer topology limitation) or <code>SCMContainerPlacementCapacity</code> (balanced disk usage) over <code>SCMContainerPlacementRandom</code>.</li>
<li><strong>Erasure Coded (EC) Containers:</strong> For production rack fault tolerance, use <code>SCMContainerPlacementRackScatter</code>.</li>
<li><strong>Read Operations:</strong> Enable <code>ozone.network.topology.aware.read</code> with accurate topology.</li>
<li><strong>Monitor &amp; Validate:</strong> Regularly monitor placement and balance; use tools like Recon to verify topology awareness.</li>
</ul>
<h2 id="references">References</h2>
<ol>
<li><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/RackAwareness.html">Hadoop Documentation: Rack Awareness</a>.</li>
<li><a href="https://github.com/apache/ozone/tree/master/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/placement/algorithms">Ozone Source Code: container placement policies</a>. (For implementations of pluggable placement policies).</li>
<li><a href="https://github.com/apache/ozone/blob/master/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/placement/algorithms/SCMContainerPlacementRandom.java">Ozone Source Code: SCMContainerPlacementRandom.java</a>.</li>
<li><a href="https://github.com/apache/ozone/blob/master/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/placement/algorithms/SCMContainerPlacementCapacity.java">Ozone Source Code: SCMContainerPlacementCapacity.java</a>.</li>
<li><a href="https://github.com/apache/ozone/blob/master/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/container/placement/algorithms/SCMContainerPlacementRackScatter.java">Ozone Source Code: SCMContainerPlacementRackScatter.java</a>.</li>
</ol>


          
          <a class="btn  btn-success btn-lg" href="../feature/quota.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: [ERROR] [ERROR] Some problems were encountered while processing the POMs:
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
[ERROR] Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
 @ 
 @ 
[ERROR] The build could not read 6 projects -&gt; [Help 1]
[ERROR]   
[ERROR]   The project org.apache.ozone:hdds-interface-admin:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-hdds/interface-admin/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR]   
[ERROR]   The project org.apache.ozone:hdds-interface-client:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-hdds/interface-client/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR]   
[ERROR]   The project org.apache.ozone:hdds-interface-server:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-hdds/interface-server/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR]   
[ERROR]   The project org.apache.ozone:ozone-csi:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-ozone/csi/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR]   
[ERROR]   The project org.apache.ozone:ozone-interface-client:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-ozone/interface-client/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR]   
[ERROR]   The project org.apache.ozone:ozone-interface-storage:2.2.0-SNAPSHOT (/home/runner/work/ozone-site/ozone-site/ozone/hadoop-ozone/interface-storage/pom.xml) has 1 error
[ERROR]     Unresolveable build extension: Plugin org.xolstice.maven.plugins:protobuf-maven-plugin:0.6.1 or one of its dependencies could not be resolved:
[ERROR]     	Failed to read artifact descriptor for org.sonatype.sisu:sisu-inject-bean:jar:1.4.2
[ERROR]     	Failed to read artifact descriptor for org.apache.maven:maven-settings-builder:jar:3.0
[ERROR]     -&gt; [Help 2]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/ProjectBuildingException
[ERROR] [Help 2] http://cwiki.apache.org/confluence/display/MAVEN/PluginManagerException, Last Modified: September 19, 2025 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/7cf9f655b090d70f5ad680d34955f2ed8eb50c02">7cf9f655b0</a>
    </span>
  </div>
</footer>



<script src="../js/jquery-3.5.1.min.js"></script>
<script src="../js/ozonedoc.js"></script>
<script src="../js/bootstrap.min.js"></script>


</body>

</html>