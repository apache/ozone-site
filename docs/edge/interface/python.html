

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../index.html" class="navbar-left ozone-logo">
        <img src="../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../index.html">
                

                    
                    <span>An Introduction to Apache Ozone</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../start.html">
                    
                    <span>Getting Started</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../start/productiondeployment.html">Production Deployment</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../concept.html">
                    
                    <span>Architecture</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../concept/overview.html">Overview</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../concept/ozonemanager.html">
                                 
                                 <span>Ozone Manager</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../concept/volumesbucketskeys.html">Volumes, Buckets, and Keys</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/datanodes.html">Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/ozones3gateway.html">Ozone S3 Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/recon.html">Recon</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/networkports.html">Network Ports</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../concept/comparison.html">Comparison with Other Storage Technologies</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../feature.html">
                    
                    <span>Features</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/om-ha.html">OM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/erasurecoding.html">Ozone Erasure Coding</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/snapshot.html">Ozone Snapshot</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/scm-ha.html">SCM High Availability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/streaming-write-pipeline.html">Streaming Write Pipeline</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/dn-merge-rocksdb.html">Merge Container RocksDB in DN</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/prefixfso.html">Prefix based File System Optimization</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/topology.html">Topology awareness</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/quota.html">Quota in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/recon.html">Recon Server</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/observability.html">Observability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/nonrolling-upgrade.html">Non-Rolling Upgrades and Downgrades</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../feature/s3-multi-tenancy.html">
                                 
                                 <span>S3 Multi-Tenancy</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-setup.html">Setup</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-tenant-commands.html">Tenant commands</a>
                                  </li>
                               
                                  <li class="">
                                     <a href="../feature/s3-multi-tenancy-access-control.html">Access Control</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/reconfigurability.html">Reconfigurability</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/containerbalancer.html">Container Balancer</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/maintenance.html">Maintenance Mode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/multi-raft-support.html">Multi-Raft Support in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../feature/trash.html">Trash</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../integration.html">
                    
                    <span>Application Integrations</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../integration/distcp.html">Hadoop DistCp</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/hive.html">Hive</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../integration/impala.html">Impala</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../interface.html">
                    
                    <span>Client Interfaces</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../interface/ofs.html">Ofs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/o3fs.html">O3fs (Hadoop compatible)</a>
                           
                        </li>
                    
                        <li class="">
                           
                               <a href="../interface/s3.html">
                                 
                                 <span>S3 Protocol</span>
                               </a>
                               <ul class="nav">
                               
                                  <li class="">
                                     <a href="../interface/cyberduckozones3.html">Accessing Ozone S3 via CyberDuck</a>
                                  </li>
                               
                               </ul>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/cli.html">Command Line Interface</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="active">
                           
                           <a href="../interface/python.html">Accessing Apache Ozone from Python</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/csi.html">CSI Protocol</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/httpfs.html">HttpFS Gateway</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../interface/native-cpp.html">Native C/C&#43;&#43; Client Access to Ozone</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../security.html">
                    
                    <span>Security</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../security/secureozone.html">Securing Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingtde.html">Transparent Data Encryption</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/gdpr.html">GDPR in Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingdatanodes.html">Securing Datanodes</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securingozonehttp.html">Securing HTTP</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securings3.html">Securing S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securityacls.html">Ozone ACLs</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/protect-in-transit-traffic.html">Protect In-Transit Traffic</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../tools.html">
                

                    
                    <span>Tools</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../recipe.html">
                

                    
                    <span>Recipes</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../troubleshooting.html">
                

                    
                    <span>Troubleshooting</span>
                </a>
            </li>
        
    
    <li><a href="../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../interface.html">Client Interfaces</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Accessing Apache Ozone from Python</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
</div>


          <div class="col-md-9">
            <h1>Accessing Apache Ozone from Python</h1>

            <!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<p>Apache Ozone project itself does not provide Python client libraries.
However, several third-party open source libraries can be used to build applications to access an Ozone cluster via
different interfaces: OFS file system, Ozone HTTPFS REST API and Ozone S3.</p>
<p>This document outlines these approaches, providing concise setup instructions and validated code examples.</p>
<h2 id="setup-and-prerequisites">Setup and Prerequisites</h2>
<p>Before starting, ensure the following:</p>
<ul>
<li>Python installed (3.x recommended)</li>
<li>Apache Ozone configured and accessible</li>
<li>For PyArrow with libhdfs:
<ul>
<li>PyArrow library (<code>pip install pyarrow</code>)</li>
<li>Hadoop native libraries configured and Ozone classpath specified (see below for details)</li>
</ul>
</li>
<li>For S3 access:
<ul>
<li>Boto3 (<code>pip install boto3</code>)</li>
<li>Ozone S3 Gateway endpoint and bucket names</li>
<li>Access credentials (AWS-like key and secret)</li>
</ul>
</li>
<li>For HttpFS access:
<ul>
<li>Requests (<code>pip install requests</code>) or fsspec (<code>pip install fsspec</code>)</li>
</ul>
</li>
</ul>
<h2 id="method-1-access-ozone-via-pyarrow-and-libhdfs">Method 1: Access Ozone via PyArrow and libhdfs</h2>
<p>This approach leverages PyArrow&rsquo;s HadoopFileSystem API, which requires libhdfs.so native library.
The libhdfs.so is not packaged within PyArrow and you must download it separately from Hadoop.</p>
<h3 id="configuration">Configuration</h3>
<p>Ensure Ozone configuration files (core-site.xml and ozone-site.xml) are available and <code>OZONE_CONF_DIR</code> is set.
Also ensure <code>ARROW_LIBHDFS_DIR</code> and <code>CLASSPATH</code> are set properly.</p>
<p>For example,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>export ARROW_LIBHDFS_DIR<span style="color:#f92672">=</span>hadoop-3.4.0/lib/native/
</span></span><span style="display:flex;"><span>export CLASSPATH<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>ozone classpath ozone-tools<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><h3 id="code-example">Code Example</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pyarrow.fs <span style="color:#66d9ef">as</span> pafs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Connect to Ozone using HadoopFileSystem</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;default&#34; tells PyArrow to use the fs.defaultFS property from core-site.xml</span>
</span></span><span style="display:flex;"><span>fs <span style="color:#f92672">=</span> pafs<span style="color:#f92672">.</span>HadoopFileSystem(<span style="color:#e6db74">&#34;default&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a directory inside the bucket</span>
</span></span><span style="display:flex;"><span>fs<span style="color:#f92672">.</span>create_dir(<span style="color:#e6db74">&#34;volume/bucket/aaa&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Write data to a file</span>
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;volume/bucket/file1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> fs<span style="color:#f92672">.</span>open_output_stream(path) <span style="color:#66d9ef">as</span> stream:
</span></span><span style="display:flex;"><span>  stream<span style="color:#f92672">.</span>write(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;data&#39;</span>)
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> configure fs.defaultFS in the core-site.xml to point to the Ozone cluster. For example,</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;name&gt;</span>fs.defaultFS<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;value&gt;</span>ofs://om:9862<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;description&gt;</span>Ozone Manager endpoint<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>Try it yourself! Check out <a href="../recipe/pyarrowtutorial.html">PyArrow Tutorial</a> for a quick start using Ozone&rsquo;s Docker image.</p>
<h2 id="method-2-access-ozone-via-boto3-and-s3-gateway">Method 2: Access Ozone via Boto3 and S3 Gateway</h2>
<h3 id="configuration-1">Configuration</h3>
<ul>
<li>Identify your Ozone S3 Gateway endpoint (e.g., <code>http://s3g:9878</code>).</li>
<li>Use AWS-compatible credentials (from Ozone).</li>
</ul>
<h3 id="code-example-1">Code Example</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a local file to upload</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;localfile.txt&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>  f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;Hello from Ozone via Boto3!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure Boto3 client</span>
</span></span><span style="display:flex;"><span>s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;s3&#39;</span>,
</span></span><span style="display:flex;"><span>  endpoint_url<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http://s3g:9878&#39;</span>,
</span></span><span style="display:flex;"><span>  aws_access_key_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ozone-access-key&#39;</span>,
</span></span><span style="display:flex;"><span>  aws_secret_access_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ozone-secret-key&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># List buckets</span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> s3<span style="color:#f92672">.</span>list_buckets()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Buckets:&#34;</span>, response[<span style="color:#e6db74">&#39;Buckets&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Upload the file</span>
</span></span><span style="display:flex;"><span>s3<span style="color:#f92672">.</span>upload_file(<span style="color:#e6db74">&#39;localfile.txt&#39;</span>, <span style="color:#e6db74">&#39;bucket&#39;</span>, <span style="color:#e6db74">&#39;file.txt&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Uploaded &#39;localfile.txt&#39; to &#39;bucket/file.txt&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Download the file back</span>
</span></span><span style="display:flex;"><span>s3<span style="color:#f92672">.</span>download_file(<span style="color:#e6db74">&#39;bucket&#39;</span>, <span style="color:#e6db74">&#39;file.txt&#39;</span>, <span style="color:#e6db74">&#39;downloaded.txt&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Downloaded &#39;file.txt&#39; as &#39;downloaded.txt&#39;&#34;</span>)
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> Replace endpoint URL, credentials, and bucket names with your setup.</p>
</blockquote>
<p>Try it yourself! Check out <a href="../recipe/boto3tutorial.html">Boto3 Tutorial</a> for a quick start using Ozone&rsquo;s Docker image.</p>
<h2 id="method-3-access-ozone-via-httpfs-rest-api">Method 3: Access Ozone via HttpFS REST API</h2>
<p>First, install requests Python module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install requests
</span></span></code></pre></div><h3 id="configuration-2">Configuration</h3>
<ul>
<li>Use Ozone’s HTTPFS endpoint (e.g., <code>http://httpfs:14000</code>).</li>
</ul>
<h3 id="code-example-requests">Code Example (requests)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ozone HTTPFS endpoint and file path</span>
</span></span><span style="display:flex;"><span>host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://httpfs:14000&#34;</span>
</span></span><span style="display:flex;"><span>volume <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vol1&#34;</span>
</span></span><span style="display:flex;"><span>bucket <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bucket1&#34;</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello.txt&#34;</span>
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/webhdfs/v1/</span><span style="color:#e6db74">{</span>volume<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ozone&#34;</span>  <span style="color:#75715e"># can be any value in simple auth mode</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 1: Initiate file creation (responds with 307 redirect)</span>
</span></span><span style="display:flex;"><span>params_create <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;op&#34;</span>: <span style="color:#e6db74">&#34;CREATE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;overwrite&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;user.name&#34;</span>: user
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Creating file...&#34;</span>)
</span></span><span style="display:flex;"><span>resp_create <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>put(host <span style="color:#f92672">+</span> path, params<span style="color:#f92672">=</span>params_create, allow_redirects<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> resp_create<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">307</span>:
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Unexpected response: </span><span style="color:#e6db74">{</span>resp_create<span style="color:#f92672">.</span>status_code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>  print(resp_create<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>  exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>redirect_url <span style="color:#f92672">=</span> resp_create<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Location&#39;</span>]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Redirected to: </span><span style="color:#e6db74">{</span>redirect_url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: Write data to the redirected location with correct headers</span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/octet-stream&#34;</span>}
</span></span><span style="display:flex;"><span>content <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello from Ozone HTTPFS!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resp_upload <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>put(redirect_url, data<span style="color:#f92672">=</span>content, headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> resp_upload<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">201</span>:
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Upload failed: </span><span style="color:#e6db74">{</span>resp_upload<span style="color:#f92672">.</span>status_code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>  print(resp_upload<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>  exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;File created successfully.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: Read the file back</span>
</span></span><span style="display:flex;"><span>params_open <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;op&#34;</span>: <span style="color:#e6db74">&#34;OPEN&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;user.name&#34;</span>: user
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Reading file...&#34;</span>)
</span></span><span style="display:flex;"><span>resp_read <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(host <span style="color:#f92672">+</span> path, params<span style="color:#f92672">=</span>params_open, allow_redirects<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> resp_read<span style="color:#f92672">.</span>ok:
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#34;File contents:&#34;</span>)
</span></span><span style="display:flex;"><span>  print(resp_read<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Read failed: </span><span style="color:#e6db74">{</span>resp_read<span style="color:#f92672">.</span>status_code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>  print(resp_read<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><p>Try it yourself! Check out <a href="../recipe/pythonrequestsozonehttpfs.html">Access Ozone using HTTPFS REST API Tutorial</a> for a quick start using Ozone&rsquo;s Docker image.</p>
<h3 id="code-example-webhdfs">Code Example (webhdfs)</h3>
<p>First, install fsspec Python module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install fsspec
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> fsspec.implementations.webhdfs <span style="color:#f92672">import</span> WebHDFS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fs <span style="color:#f92672">=</span> WebHDFS(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;httpfs&#39;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">14000</span>, user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ozone&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Read a file from /vol1/bucket1/hello.txt</span>
</span></span><span style="display:flex;"><span>file_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/vol1/bucket1/hello.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> fs<span style="color:#f92672">.</span>open(file_path, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>  content <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#34;File contents:&#34;</span>)
</span></span><span style="display:flex;"><span>  print(content<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> Replace host, port, and path as per your setup.</p>
</blockquote>
<h2 id="troubleshooting-tips">Troubleshooting Tips</h2>
<ul>
<li><strong>Authentication Errors</strong>: Verify credentials and Kerberos tokens (if used).</li>
<li><strong>Connection Issues</strong>: Check endpoint URLs, ports, and firewall rules.</li>
<li><strong>FileSystem Errors</strong>: Ensure correct Ozone configuration and appropriate permissions.</li>
<li><strong>Missing Dependencies</strong>: Install required Python packages (<code>pip install pyarrow boto3 requests fsspec</code>).</li>
</ul>
<h2 id="references-and-further-resources">References and Further Resources</h2>
<ul>
<li><a href="https://ozone.apache.org/docs/">Apache Ozone Documentation</a></li>
<li><a href="https://arrow.apache.org/docs/python/">PyArrow Documentation</a></li>
<li><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">Boto3 Documentation</a></li>
<li><a href="https://filesystem-spec.readthedocs.io/en/latest/api.html#fsspec.implementations.webhdfs.WebHDFS">fsspec WebHDFS Python API</a></li>
</ul>


          
          <a class="btn  btn-success btn-lg" href="../interface/csi.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: 2.1.0-SNAPSHOT, Last Modified: June 8, 2025 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/31d13de52a184cb3ca99f81d903cb0f9cb2df2ae">31d13de52a</a>
    </span>
  </div>
</footer>



<script src="../js/jquery-3.5.1.min.js"></script>
<script src="../js/ozonedoc.js"></script>
<script src="../js/bootstrap.min.js"></script>


</body>

</html>