

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../../zh/index.html" class="navbar-left ozone-logo">
        <img src="../../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../../zh/index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../../zh/index.html">
                

                    
                    <span>概述</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../../zh/start.html">
                

                    
                    <span>快速入门</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/concept.html">
                    
                    <span>概念</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/concept/overview.html">概览</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/ozonemanager.html">Ozone Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/datanodes.html">数据节点</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/recon.html">Recon</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/feature.html">
                    
                    <span>特性</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/erasurecoding.html">纠删码</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/om-ha.html">高可用 OM</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/scm-ha.html">高可用 SCM</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/dn-merge-rocksdb.html">在DataNode上合并Container的RocksDB</a>
                           
                        </li>
                    
                        <li class="active">
                           
                           <a href="../../zh/feature/prefixfso.html">基于前缀的文件系统优化</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/topology.html">拓扑感知能力</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/quota.html">Ozone 中的配额</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/recon.html">Recon 服务器</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/reconfigurability.html">动态加载配置</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/security.html">
                    
                    <span>安全</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/security/secureozone.html">安全化 Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securingtde.html">透明数据加密</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/gdpr.html">Ozone 中的 GDPR</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securingdatanodes.html">安全化 Datanode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securings3.html">安全化 S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securityacls.html">Ozone 访问控制列表</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/interface.html">
                    
                    <span>编程接口</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/o3fs.html">Ozone 文件系统</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/csi.html">CSI 协议</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/s3.html">S3 协议接口</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../../zh/tools.html">
                

                    
                    <span>工具</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../../zh/recipe.html">
                

                    
                    <span>使用配方</span>
                </a>
            </li>
        
    
    <li><a href="../../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../../zh/index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../../zh/feature.html">特性</a></li>
                  <li class="breadcrumb-item active" aria-current="page">基于前缀的文件系统优化</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
    <a href="../../feature/prefixfso.html"><span class="label label-success">English</span></a>
    
    
    
    
</div>


          <div class="col-md-9">
            <h1>基于前缀的文件系统优化</h1>

            <!---
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<p>基于前缀的文件系统优化特性支持命名空间中任意级别目录的重命名和删除操作，且操作均能在常数时间内完成。</p>
<p>若要启用该特性，需要在创建桶时指定 <code>--layout</code> 参数为 <code>FILE_SYSTEM_OPTIMIZED</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ozone sh bucket create /&lt;volume-name&gt;/&lt;bucket-name&gt; --layout FILE_SYSTEM_OPTIMIZED
</code></pre></div><p>注意：在启用基于前缀的文件系统优化的桶中，对 Hadoop 文件系统的兼容性优先于对 S3 的兼容性，某些不规范的 S3 键名在操作时将会被拒绝或规范化。</p>
<p>当 Ozone 中的桶主要通过兼容 Hadoop 的接口使用，尤其是涉及到较深目录层级下的大量文件时，强烈推荐开启该特性。</p>
<h2 id="ozonemanager-元数据布局格式">OzoneManager 元数据布局格式</h2>
<p>OzoneManager 支持两种元数据布局格式：简单布局格式和基于前缀的布局格式。</p>
<p>在简单布局格式中，OM 采用完整路径名来存储每个键的元数据。在基于前缀的优化布局格式中，OM 将中间目录的元数据存储在 <code>DirectoryTable</code> 中，将文件的元数据存储在 <code>FileTable</code> 中，如下图所示。两张表中的主键是以父目录唯一标识符为前缀的文件名或目录名， 形如 <code>&lt;parent unique-id&gt;/&lt;filename&gt;</code>。</p>
<p>

<img src="PrefixFSO-Format.png" alt='FSO Format'  class="img-responsive" /></p>
<h3 id="基于前缀布局的目录删除操作">基于前缀布局的目录删除操作</h3>
<p>下图描述了进行目录删除操作时 OM 的元数据变化。</p>
<p>

<img src="PrefixFSO-Delete.png" alt='FSO Delete'  class="img-responsive" /></p>
<h3 id="基于前缀布局的目录重命名操作">基于前缀布局的目录重命名操作</h3>
<p>下图描述了进行目录重命名操作时 OM 的元数据变化。</p>
<p>

<img src="PrefixFSO-Rename.png" alt='FSO Rename'  class="img-responsive" /></p>
<h2 id="配置">配置</h2>
<p>可以在 <code>ozone-site.xml</code> 中加入以下配置来设定创建桶时，客户端未指定桶样式时的默认的桶样式：
可用的值有 <code>OBJECT_STORE</code>, <code>FILE_SYSTEM_OPTIMIZED</code> 和 <code>LEGACY</code>.</p>
<p>若该配置的值为空，则默认值为 <code>FILE_SYSTEM_OPTIMIZED</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML">
<span style="color:#f92672">&lt;property&gt;</span>
    <span style="color:#f92672">&lt;name&gt;</span>ozone.default.bucket.layout<span style="color:#f92672">&lt;/name&gt;</span>
    <span style="color:#f92672">&lt;value/&gt;</span>
<span style="color:#f92672">&lt;/property&gt;</span>
</code></pre></div>

          
          <a class="btn  btn-success btn-lg" href="../../zh/feature/topology.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: 1.5.0-SNAPSHOT, Last Modified: February 22, 2024 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/5f6306dd1dde3c9c982ed933aa1fa8f4fa7a9301">5f6306d</a>
    </span>
  </div>
</footer>



<script src="../../js/jquery-3.5.1.min.js"></script>
<script src="../../js/ozonedoc.js"></script>
<script src="../../js/bootstrap.min.js"></script>


</body>

</html>