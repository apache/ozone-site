<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files | Apache Ozone</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ozone-site-v2.staged.apache.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://ozone-site-v2.staged.apache.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files | Apache Ozone"><meta data-rh="true" name="description" content="Guest post by the Didi Engineering Team. For the full story with detailed slides, see Apache Ozone Best Practices at Didi (PDF)."><meta data-rh="true" property="og:description" content="Guest post by the Didi Engineering Team. For the full story with detailed slides, see Apache Ozone Best Practices at Didi (PDF)."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-01-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/rich7420,https://github.com/jojochuang,https://ozone.apache.org"><meta data-rh="true" property="article:tag" content="user-stories,performance,erasure-coding,scale"><link data-rh="true" rel="canonical" href="https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi"><link data-rh="true" rel="alternate" href="https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi" hreflang="en"><link data-rh="true" rel="alternate" href="https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PLACEHOLDER-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi","mainEntityOfPage":"https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi","url":"https://ozone-site-v2.staged.apache.org/blog/2026/01/30/apache-ozone-best-practices-at-didi","headline":"Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files","name":"Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files","description":"Guest post by the Didi Engineering Team. For the full story with detailed slides, see Apache Ozone Best Practices at Didi (PDF).","datePublished":"2026-01-30T00:00:00.000Z","author":[{"@type":"Person","name":"Kaun-Hung (Rich) Huang","description":"Apache Ozone Contributor","url":"https://github.com/rich7420","image":"https://github.com/rich7420.png"},{"@type":"Person","name":"Wei-Chiu Chuang","description":"Apache Ozone PMC","url":"https://github.com/jojochuang","image":"https://github.com/jojochuang.png"},{"@type":"Person","name":"The Apache Ozone Community","description":"Apache Ozone Project","url":"https://ozone.apache.org","image":"/img/ozone-logo.svg"}],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ozone-site-v2.staged.apache.org/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Ozone RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Ozone Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Ozone" href="/opensearch.xml">
<link rel="manifest" href="/pwa/manifest.json">

<link rel="icon" href="favicon.ico" sizes="32x32">
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<script src="/script/matomo.js"></script><link rel="stylesheet" href="/assets/css/styles.27c88cdc.css">
<script src="/assets/js/runtime~main.487a3445.js" defer="defer"></script>
<script src="/assets/js/main.2954cde0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_wi3M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ozone-logo.svg" alt="Ozone Logo" class="themedComponent_Ka_G themedComponent--light_hIiB"><img src="/img/ozone-logo.svg" alt="Ozone Logo" class="themedComponent_Ka_G themedComponent--dark_GbLg"></div><b class="navbar__title text--truncate">Apache Ozone</b></a><a class="navbar__item navbar__link" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/faq">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/communication-channels">Communication Channels</a></li><li><a class="dropdown__link" href="/community/who-uses-ozone">Who Uses Ozone?</a></li><li><a class="dropdown__link" href="/community/report-an-issue">Report An Issue</a></li><li><a class="dropdown__link" href="/community/ask-a-question">Ask a Question</a></li><li><a class="dropdown__link" href="/community/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/events-and-media">Events and Media</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_NU7Q"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/2026/01/30/apache-ozone-best-practices-at-didi" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/apache/ozone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub Repo"></a><div class="toggle_F0tt colorModeToggle_Cksm"><button class="clean-btn toggleButton_tFD4 toggleButtonDisabled_UmGx" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_gzz6"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_HsWo"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_SQAi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_HMzJ"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_PEPA thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_VopF margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_pWWT">2026</h3><ul class="sidebarItemList_LncH clean-list"><li class="sidebarItem_vei_"><a aria-current="page" class="sidebarItemLink_Wz97 sidebarItemLinkActive_p9Qw" href="/blog/2026/01/30/apache-ozone-best-practices-at-didi">Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files</a></li><li class="sidebarItem_vei_"><a class="sidebarItemLink_Wz97" href="/blog/2026/01/29/disk-balancer-preview">No More Hotspots: Introducing the Automatic Disk Balancer in Apache Ozone</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_pWWT">2025</h3><ul class="sidebarItemList_LncH clean-list"><li class="sidebarItem_vei_"><a class="sidebarItemLink_Wz97" href="/blog/2025/07/02/access-ozone-via-cyberduck">Accessing Ozone S3 via CyberDuck</a></li><li class="sidebarItem_vei_"><a class="sidebarItemLink_Wz97" href="/blog/2025/04/30/ozone-2.0.0-release">Apache Ozone 2.0.0 Release</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_NDYL">Apache Ozone Best Practices at Didi: Scaling to Tens of Billions of Files</h1><div class="container_Onn9 margin-vert--md"><time datetime="2026-01-30T00:00:00.000Z">January 30, 2026</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Ht0c"><div class="avatar margin-bottom--sm"><a href="https://github.com/rich7420" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_PSYc" src="https://github.com/rich7420.png" alt="Kaun-Hung (Rich) Huang"></a><div class="avatar__intro authorDetails_V6CU"><div class="avatar__name"><a href="https://github.com/rich7420" target="_blank" rel="noopener noreferrer"><span class="authorName_za88">Kaun-Hung (Rich) Huang</span></a></div><small class="authorTitle_KGt7" title="Apache Ozone Contributor">Apache Ozone Contributor</small><div class="authorSocials_gIBy"></div></div></div></div><div class="col col--6 authorCol_Ht0c"><div class="avatar margin-bottom--sm"><a href="https://github.com/jojochuang" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_PSYc" src="https://github.com/jojochuang.png" alt="Wei-Chiu Chuang"></a><div class="avatar__intro authorDetails_V6CU"><div class="avatar__name"><a href="https://github.com/jojochuang" target="_blank" rel="noopener noreferrer"><span class="authorName_za88">Wei-Chiu Chuang</span></a></div><small class="authorTitle_KGt7" title="Apache Ozone PMC">Apache Ozone PMC</small><div class="authorSocials_gIBy"></div></div></div></div><div class="col col--6 authorCol_Ht0c"><div class="avatar margin-bottom--sm"><a href="https://ozone.apache.org" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_PSYc" src="/img/ozone-logo.svg" alt="The Apache Ozone Community"></a><div class="avatar__intro authorDetails_V6CU"><div class="avatar__name"><a href="https://ozone.apache.org" target="_blank" rel="noopener noreferrer"><span class="authorName_za88">The Apache Ozone Community</span></a></div><small class="authorTitle_KGt7" title="Apache Ozone Project">Apache Ozone Project</small><div class="authorSocials_gIBy"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Guest post by the Didi Engineering Team. For the full story with detailed slides, see <a href="https://ozone.apache.org/assets/ApacheOzoneBestPracticesAtDidi.pdf" target="_blank" rel="noopener noreferrer">Apache Ozone Best Practices at Didi (PDF)</a>.</p>
<p>As Didi&#x27;s volume of unstructured data surged into the hundreds of petabytes, comprising tens of billions of files, their traditional storage architecture faced severe scalability bottlenecks. This post summarizes how they migrated from HDFS to Apache Ozone, the optimizations they implemented for high-performance reads, and their journey in contributing these improvements back to the community.</p>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="the-challenge-hdfs-at-scale">The Challenge: HDFS at Scale<a href="#the-challenge-hdfs-at-scale" class="hash-link" aria-label="Direct link to The Challenge: HDFS at Scale" title="Direct link to The Challenge: HDFS at Scale">​</a></h2>
<p>Like many data-driven enterprises, Didi relied heavily on HDFS. However, as their data scale grew, they hit the classic &quot;NameNode Limit.&quot;</p>
<ul>
<li><strong>Metadata Pressure:</strong> Storing hundreds of millions of files put immense pressure on the HDFS NameNode memory.</li>
<li><strong>Block Reporting Storms:</strong> With massive file counts, block reporting became a significant overhead.</li>
<li><strong>Scalability Ceiling:</strong> They needed a solution that could handle tens of billions of files without partitioning their clusters into unmanageable silos.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="why-ozone">Why Ozone?<a href="#why-ozone" class="hash-link" aria-label="Direct link to Why Ozone?" title="Direct link to Why Ozone?">​</a></h2>
<p>They chose Apache Ozone as their next-generation storage engine because it addresses these limitations architecturally:</p>
<ul>
<li><strong>Decoupled Metadata:</strong> By separating the Ozone Manager (OM) for namespace and Storage Container Manager (SCM) for block management, Ozone scales significantly better than HDFS.</li>
<li><strong>RocksDB-based Metadata:</strong> Unlike HDFS, which relies entirely on heap memory, Ozone stores metadata in RocksDB, removing the memory bottleneck.</li>
<li><strong>Container Logic:</strong> Managing data in &quot;containers&quot; rather than individual blocks reduces the reporting overhead on the SCM.</li>
</ul>
<p>Today, Ozone has been running in production at Didi for over two years, managing hundreds of PB of storage.</p>
<p><img decoding="async" loading="lazy" alt="Figure 1: Ozone Cluster Scale at Didi" src="/assets/images/ozone-cluster-scale-at-didi-bff8e63e93ed0f503b50d7350756bef4.png" width="1856" height="842" class="img_zmyy"></p>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="architecture--key-optimizations">Architecture &amp; Key Optimizations<a href="#architecture--key-optimizations" class="hash-link" aria-label="Direct link to Architecture &amp; Key Optimizations" title="Direct link to Architecture &amp; Key Optimizations">​</a></h2>
<p>Migrating was just the first step. To meet Didi&#x27;s strict latency requirements (especially for &quot;first-frame&quot; read access), they engineered several critical optimizations.</p>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="1-multi-cluster-routing-with-viewfs">1. Multi-Cluster Routing with ViewFs<a href="#1-multi-cluster-routing-with-viewfs" class="hash-link" aria-label="Direct link to 1. Multi-Cluster Routing with ViewFs" title="Direct link to 1. Multi-Cluster Routing with ViewFs">​</a></h3>
<p>To manage the sheer volume of data, they utilized a client-side routing mechanism inspired by HDFS ViewFs. By mapping paths to specific clusters (e.g., <code>vol/bucket/prefix1</code> → cluster1), they effectively balanced the load and kept the file count in each cluster under 5 billion, alleviating RPC pressure on individual Ozone Managers.</p>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="2-boosting-read-performance-s3g-follower-reads">2. Boosting Read Performance: S3G Follower Reads<a href="#2-boosting-read-performance-s3g-follower-reads" class="hash-link" aria-label="Direct link to 2. Boosting Read Performance: S3G Follower Reads" title="Direct link to 2. Boosting Read Performance: S3G Follower Reads">​</a></h3>
<p>They observed that the Leader OM often became a bottleneck for S3 Gateway (S3G) requests. To solve this, they implemented a Follower Read strategy.</p>
<p>They introduced a &quot;probe task&quot; in the client (e.g. every 3 seconds) that evaluates:</p>
<ul>
<li><strong>Latency:</strong> Selects the OM node with the lowest response time.</li>
<li><strong>Freshness:</strong> Checks the lastAppliedIndex to ensure the Follower isn&#x27;t serving stale data.</li>
</ul>
<p><strong>Result:</strong> The P90 latency for S3G metadata requests (GetMetaLatency) dropped from a weekly average of ~90ms to ~17ms; in best cases, from tens of milliseconds to under 3ms.</p>
<p><img decoding="async" loading="lazy" alt="Figure 6-2. S3G Download Latency Monitoring After FollowerRead Goes Online" src="/assets/images/s3g-download-latency-follower-read-goes-online-102b1f38e6b783c7401950efbbef20b0.png" width="2310" height="1772" class="img_zmyy"></p>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="3-heterogeneous-caching-hdd--nvme">3. Heterogeneous Caching (HDD + NVMe)<a href="#3-heterogeneous-caching-hdd--nvme" class="hash-link" aria-label="Direct link to 3. Heterogeneous Caching (HDD + NVMe)" title="Direct link to 3. Heterogeneous Caching (HDD + NVMe)">​</a></h3>
<p>Didi&#x27;s clusters use cost-effective hard disk drives, but random reads on small files (tens of MBs) suffered from disk latency. They designed a heterogeneous caching layer:</p>
<ul>
<li><strong>Strategy:</strong> They cache the first Chunk (1MB) of each block on high-speed NVMe SSDs; for EC (e.g. RS-6-3-1024k) they cache the first stripe (9MB: 6 data + 3 parity) to cover first-frame needs.</li>
<li><strong>Impact:</strong> The 6MB of actual data in that stripe is sufficient for most first-frame requests, dramatically improving read speeds without the cost of all-flash storage.</li>
<li><strong>Implementation:</strong> A custom LRU cache on the Datanode manages this hot data, ensuring efficient space utilization. This caching optimization brought at least 100ms latency improvement in first-frame reads.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_e_9H" id="4-concurrency--lock-optimization">4. Concurrency &amp; Lock Optimization<a href="#4-concurrency--lock-optimization" class="hash-link" aria-label="Direct link to 4. Concurrency &amp; Lock Optimization" title="Direct link to 4. Concurrency &amp; Lock Optimization">​</a></h3>
<p>During high-concurrency testing, they identified thread contention issues. Specifically, a spin lock in <code>ChunkUtils#processFileExclusive</code> was causing CPU spikes.</p>
<p>They contributed a fix (see <a href="https://issues.apache.org/jira/browse/HDDS-11281" target="_blank" rel="noopener noreferrer">HDDS-11281</a>) that replaced the global lock with a <code>Striped&lt;ReadWriteLock&gt;</code>. This granular locking mechanism reduced lock contention and improved system throughput, yielding a performance gain of at least 50ms per operation in contended scenarios.</p>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="cost-efficiency-erasure-coding-ec">Cost Efficiency: Erasure Coding (EC)<a href="#cost-efficiency-erasure-coding-ec" class="hash-link" aria-label="Direct link to Cost Efficiency: Erasure Coding (EC)" title="Direct link to Cost Efficiency: Erasure Coding (EC)">​</a></h2>
<p>With data growing at &gt;1PB per day, the 3-replica cost model was unsustainable. They transitioned to Erasure Coding (EC) using the RS-6-3-1024k policy.</p>
<ul>
<li><strong>Storage Savings:</strong> Reduced replication factor from 3x to ~1.5x, saving 50% on hardware.</li>
<li><strong>Challenges Solved:</strong> They encountered and fixed issues with deletion backlogs (<a href="https://issues.apache.org/jira/browse/HDDS-11498" target="_blank" rel="noopener noreferrer">HDDS-11498</a>), insufficient EC pipelines (<a href="https://issues.apache.org/jira/browse/HDDS-11209" target="_blank" rel="noopener noreferrer">HDDS-11209</a>), and Safe Mode logic for EC containers (<a href="https://issues.apache.org/jira/browse/HDDS-11243" target="_blank" rel="noopener noreferrer">HDDS-11243</a>), ensuring EC is as robust as replication in production.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="community-contributions">Community Contributions<a href="#community-contributions" class="hash-link" aria-label="Direct link to Community Contributions" title="Direct link to Community Contributions">​</a></h2>
<p>Didi&#x27;s journey with Ozone has been deeply collaborative. We are proud to highlight that Didi&#x27;s contributors have brought several key fixes and improvements back to the Apache Ozone community:</p>
<ul>
<li><a href="https://issues.apache.org/jira/browse/HDDS-11483" target="_blank" rel="noopener noreferrer">HDDS-11483</a>: Increased S3G buffer size (e.g. to 4MB) to reduce network I/O and improve first-frame latency.</li>
<li><a href="https://issues.apache.org/jira/browse/HDDS-11209" target="_blank" rel="noopener noreferrer">HDDS-11209</a>: Avoid insufficient EC pipelines in the container pipeline cache (OM must not cache EC pipelines with incomplete Datanodes).</li>
<li><a href="https://issues.apache.org/jira/browse/HDDS-9342" target="_blank" rel="noopener noreferrer">HDDS-9342</a>: Fixed OM HA crash and restart failure caused by timing inconsistency between applyTransactionMap and double-buffer.</li>
<li><a href="https://issues.apache.org/jira/browse/HDDS-10985" target="_blank" rel="noopener noreferrer">HDDS-10985</a>: EC Reconstruction failed because the size of currentChunks was not equal to checksumBlockDataChunks.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_e_9H" id="summary--future-work">Summary &amp; Future Work<a href="#summary--future-work" class="hash-link" aria-label="Direct link to Summary &amp; Future Work" title="Direct link to Summary &amp; Future Work">​</a></h2>
<p>Apache Ozone has successfully enabled Didi to scale its storage infrastructure to hundreds of petabytes while maintaining high performance and lowering costs.</p>
<p>Looking ahead, Didi is exploring:</p>
<ul>
<li><strong>IO_URING:</strong> To further enhance asynchronous I/O efficiency.</li>
<li><strong>SPDK:</strong> To accelerate access to RocksDB on NVMe drives for OM and SCM.</li>
</ul>
<p>Didi thanks the Apache Ozone community for their support and vibrant collaboration. The transition to Ozone has been a game-changer for Didi&#x27;s big data infrastructure.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_Sgtu padding--none margin-left--sm"><li class="tag_ZUEm"><a class="tag_de0C tagRegular_Y72n" href="/blog/tags/user-stories">user-stories</a></li><li class="tag_ZUEm"><a class="tag_de0C tagRegular_Y72n" href="/blog/tags/performance">performance</a></li><li class="tag_ZUEm"><a class="tag_de0C tagRegular_Y72n" href="/blog/tags/erasure-coding">erasure-coding</a></li><li class="tag_ZUEm"><a class="tag_de0C tagRegular_Y72n" href="/blog/tags/scale">scale</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/blog/2026-01-30-apache-ozone-best-practices-at-didi.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_kQtw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_orCj"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2026/01/29/disk-balancer-preview"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">No More Hotspots: Introducing the Automatic Disk Balancer in Apache Ozone</div></a></nav></main><div class="col col--2"><div class="tableOfContents_reur thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-challenge-hdfs-at-scale" class="table-of-contents__link toc-highlight">The Challenge: HDFS at Scale</a></li><li><a href="#why-ozone" class="table-of-contents__link toc-highlight">Why Ozone?</a></li><li><a href="#architecture--key-optimizations" class="table-of-contents__link toc-highlight">Architecture &amp; Key Optimizations</a><ul><li><a href="#1-multi-cluster-routing-with-viewfs" class="table-of-contents__link toc-highlight">1. Multi-Cluster Routing with ViewFs</a></li><li><a href="#2-boosting-read-performance-s3g-follower-reads" class="table-of-contents__link toc-highlight">2. Boosting Read Performance: S3G Follower Reads</a></li><li><a href="#3-heterogeneous-caching-hdd--nvme" class="table-of-contents__link toc-highlight">3. Heterogeneous Caching (HDD + NVMe)</a></li><li><a href="#4-concurrency--lock-optimization" class="table-of-contents__link toc-highlight">4. Concurrency &amp; Lock Optimization</a></li></ul></li><li><a href="#cost-efficiency-erasure-coding-ec" class="table-of-contents__link toc-highlight">Cost Efficiency: Erasure Coding (EC)</a></li><li><a href="#community-contributions" class="table-of-contents__link toc-highlight">Community Contributions</a></li><li><a href="#summary--future-work" class="table-of-contents__link toc-highlight">Summary &amp; Future Work</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Software Foundation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/ozone/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/github.svg" alt="GitHub Discussions Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/HDDS/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/jira.svg" alt="Jira Issues Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Jira Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://infra.apache.org/slack.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/slack.svg" alt="Slack Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:dev@ozone.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/mail.svg" alt="Mailing List Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Mailing List<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@ApacheOzone" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/youtube.svg" alt="YouTube Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ApacheOzone" target="_blank" rel="noopener noreferrer" class="footer__link-item"><img src="/img/social/twitter-x.svg" alt="Twitter Icon" style="width:1em;height:1em;margin-right:0.5em;vertical-align:middle">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QWNa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/ozone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ozone</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-docker" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker Image</a></li><li class="footer__item"><a href="https://github.com/apache/ozone-docker-runner" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker Runner Image</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div>
          Copyright © 2026 <a href="https://www.apache.org/" class="copyright-link">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" class="copyright-link">Apache License, Version 2.0</a>. <br>
          <div>
            <p>The Apache Software Foundation, Apache Ozone, Ozone, Apache, the Apache Feather, and the Apache Ozone project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
          </div>
        </div></div></div></div></footer></div>
</body>
</html>