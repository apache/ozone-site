"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[7619],{62392:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var s=i(30758);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},66378:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"system-internals/security/tokens","title":"Token Based Authentication Within Ozone","description":"Ozone uses token-based authentication to secure access to data stored in containers and blocks.","source":"@site/docs/07-system-internals/05-security/03-tokens.md","sourceDirName":"07-system-internals/05-security","slug":"/system-internals/security/tokens","permalink":"/docs/system-internals/security/tokens","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/master/docs/07-system-internals/05-security/03-tokens.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"Tokens"},"sidebar":"defaultSidebar","previous":{"title":"Symmetric Encryption","permalink":"/docs/system-internals/security/symmetric-encryption"},"next":{"title":"Certificates","permalink":"/docs/system-internals/security/certificates"}}');var t=i(86070),r=i(62392);const o={sidebar_label:"Tokens"},a="Token Based Authentication Within Ozone",c={},l=[{value:"Delegation Token",id:"delegation-token",level:2},{value:"Block Token",id:"block-token",level:2},{value:"Container Token",id:"container-token",level:2},{value:"Summary of Key Differences",id:"summary-of-key-differences",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"token-based-authentication-within-ozone",children:"Token Based Authentication Within Ozone"})}),"\n",(0,t.jsx)(n.p,{children:"Ozone uses token-based authentication to secure access to data stored in containers and blocks.\nTokens are short-lived credentials that authorize specific operations without requiring clients to repeatedly\nauthenticate with the central authority."}),"\n",(0,t.jsx)(n.p,{children:"Ozone implements two types of tokens:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Delegation Tokens"})," for namespace operations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Block Tokens"})," for fine-grained data access,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Container Tokens"})," for container-level administrative operations."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"delegation-token",children:"Delegation Token"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Granularity:"})," ",(0,t.jsx)(n.code,{children:"Namespace-level"}),". A Delegation Token grants access to perform metadata and namespace operations across the entire Ozone cluster, such as creating volumes, buckets, and keys, or listing objects."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issuer:"})," ",(0,t.jsx)(n.code,{children:"Ozone Manager (OM)"}),". The OM generates Delegation Tokens when a client initially authenticates (",(0,t.jsx)(n.strong,{children:"typically via Kerberos"}),") and requests a delegation token. This is because the OM is responsible for managing the namespace and metadata operations within Ozone."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Usage Context:"})," A Delegation Token is used when a client needs to perform control-plane operations (namespace/metadata operations) without repeatedly authenticating with Kerberos. For example:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"A client application starts and authenticates with Kerberos to the Ozone Manager."}),"\n",(0,t.jsx)(n.li,{children:"The client requests a Delegation Token from the OM, which issues a token that represents the user's identity."}),"\n",(0,t.jsx)(n.li,{children:"For subsequent operations like creating a volume, listing buckets, or creating keys, the client uses this Delegation Token instead of Kerberos credentials."}),"\n",(0,t.jsx)(n.li,{children:"The token can be renewed before expiry, allowing long-running applications to continue operating without re-authentication."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Information Carried (",(0,t.jsx)(n.code,{children:"OzoneTokenIdentifier"}),"):"]})," The token identifier contains:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The owner (effective username)."}),"\n",(0,t.jsx)(n.li,{children:"The renewer (who can renew the token)."}),"\n",(0,t.jsx)(n.li,{children:"The real user (actual user if impersonation is used)."}),"\n",(0,t.jsx)(n.li,{children:"Issue date and expiration date."}),"\n",(0,t.jsx)(n.li,{children:"Sequence number and master key ID for token management."}),"\n",(0,t.jsx)(n.li,{children:"Secret key ID (for symmetric signing) or OM certificate serial ID (deprecated)."}),"\n",(0,t.jsx)(n.li,{children:"OM service ID for multi-OM deployments."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Token Types:"})," The ",(0,t.jsx)(n.code,{children:"OzoneTokenIdentifier"})," supports two subtypes:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DELEGATION_TOKEN"}),": Standard delegation token for namespace operations."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"S3AUTHINFO"}),": S3 authentication information (AWS Signature Version 4) for S3-compatible access."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"block-token",children:"Block Token"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Granularity:"})," ",(0,t.jsx)(n.code,{children:"Block-level"}),". A Block Token grants access to a single, specific block within a container."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issuer:"})," ",(0,t.jsx)(n.code,{children:"Ozone Manager (OM)"}),". The OM generates Block Tokens when a client requests to write or read a block. This is because the OM is responsible for managing the block namespace within the object store."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Usage Context:"})," A Block Token is used when a client needs to perform a data-plane operation (read/write) on a specific block. For example:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"A client wants to write data for key1."}),"\n",(0,t.jsx)(n.li,{children:"It contacts the OM, which allocates a new block (e.g., block123) for key1."}),"\n",(0,t.jsxs)(n.li,{children:["The OM returns the location of block123 (which includes the Datanodes) and a unique Block Token for ",(0,t.jsx)(n.code,{children:"block123"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"The client then uses this specific Block Token to write data for block123 to the Datanodes."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Information Carried (",(0,t.jsx)(n.code,{children:"OzoneBlockTokenIdentifier"}),"):"]})," The token identifier contains:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The user/owner ID."}),"\n",(0,t.jsx)(n.li,{children:"The BlockID it authorizes."}),"\n",(0,t.jsx)(n.li,{children:"The access modes it permits (e.g., READ, WRITE, DELETE)."}),"\n",(0,t.jsx)(n.li,{children:"The expiration time."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"container-token",children:"Container Token"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Granularity:"})," ",(0,t.jsx)(n.code,{children:"Container-level"}),". A Container Token grants access to an entire container, which can contain many blocks."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issuer:"})," ",(0,t.jsx)(n.code,{children:"Storage Container Manager (SCM)"}),". The SCM generates Container Tokens. This is logical because the SCM is responsible for managing containers and their placement across Datanodes, but it is unaware of the individual blocks inside them."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Usage Context:"})," A Container Token is used for operations that concern the container as a whole, often for administrative or maintenance tasks that bypass the Ozone Manager. For example:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["An administrator uses the ",(0,t.jsx)(n.code,{children:"ozone debug replicas verify"})," command to check the integrity of replicas for a container."]}),"\n",(0,t.jsx)(n.li,{children:"The admin tool contacts the SCM to get a Container Token for the specified ContainerID."}),"\n",(0,t.jsx)(n.li,{children:"The tool then uses this token to communicate directly with Datanodes to perform the verification."}),"\n",(0,t.jsx)(n.li,{children:"Another example is when the SCM itself issues commands to Datanodes (e.g., to close a container). It generates a Container Token to authorize its own command."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Information Carried (",(0,t.jsx)(n.code,{children:"ContainerTokenIdentifier"}),"):"]})," The token identifier contains:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The user/owner ID."}),"\n",(0,t.jsx)(n.li,{children:"The ContainerID it authorizes."}),"\n",(0,t.jsx)(n.li,{children:"Expiration time."}),"\n",(0,t.jsx)(n.li,{children:"It does not specify individual blocks or fine-grained access modes like a Block Token does."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"summary-of-key-differences",children:"Summary of Key Differences"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"Delegation Token"}),(0,t.jsx)(n.th,{children:"Block Token"}),(0,t.jsx)(n.th,{children:"Container Token"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Scope of Access"})}),(0,t.jsx)(n.td,{children:"Entire namespace (all volumes, buckets, keys)"}),(0,t.jsx)(n.td,{children:"A single Block"}),(0,t.jsx)(n.td,{children:"An entire Container"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Generated By"})}),(0,t.jsx)(n.td,{children:"Ozone Manager (OM)"}),(0,t.jsx)(n.td,{children:"Ozone Manager (OM)"}),(0,t.jsx)(n.td,{children:"Storage Container Manager (SCM)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Primary Use Case"})}),(0,t.jsx)(n.td,{children:"Authorizing namespace/metadata operations (create volumes, buckets, keys, list operations)"}),(0,t.jsx)(n.td,{children:"Authorizing client data operations (read/write blocks)"}),(0,t.jsx)(n.td,{children:"Authorizing administrative or management operations on containers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Typical User"})}),(0,t.jsx)(n.td,{children:"End-client applications performing namespace operations"}),(0,t.jsx)(n.td,{children:"End-client applications writing/reading keys"}),(0,t.jsx)(n.td,{children:"Ozone-internal processes (like SCM) or admin tools (ozone debug)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Renewable"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"No (short-lived, get new one when expired)"}),(0,t.jsx)(n.td,{children:"No (short-lived)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Default Enabled"})}),(0,t.jsx)(n.td,{children:"Yes (when security enabled)"}),(0,t.jsx)(n.td,{children:"Yes (when security enabled)"}),(0,t.jsx)(n.td,{children:"No (disabled by default)"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"In short, think of it like this:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Delegation Token"})," is your general admission pass to the movie theater complex (Ozone cluster), given to you by the main ticket counter (Ozone Manager), allowing you to access all attractions (namespace operations) without repeatedly showing your ID (Kerberos credentials)."]}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Block Token"})," is your ticket to a specific seat in a movie theater, given to you by the box office (Ozone Manager)."]}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Container Token"})," is a master key for the entire theater room, given to you by the building manager (SCM) for maintenance or inspection purposes."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);