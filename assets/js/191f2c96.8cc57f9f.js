"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[34411],{12271:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"core-concepts/architecture/storage-container-manager","title":"Storage Container Manager","description":"Storage Container Manager (SCM) is the leader node of the block space management.","source":"@site/versioned_docs/version-2.1.0/03-core-concepts/01-architecture/03-storage-container-manager.md","sourceDirName":"03-core-concepts/01-architecture","slug":"/core-concepts/architecture/storage-container-manager","permalink":"/docs/core-concepts/architecture/storage-container-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/master/versioned_docs/version-2.1.0/03-core-concepts/01-architecture/03-storage-container-manager.md","tags":[],"version":"2.1.0","sidebarPosition":3,"frontMatter":{"sidebar_label":"Storage Container Manager"},"sidebar":"defaultSidebar","previous":{"title":"Ozone Manager","permalink":"/docs/core-concepts/architecture/ozone-manager"},"next":{"title":"Ozone S3 Gateway","permalink":"/docs/core-concepts/architecture/s3-gateway"}}');var s=i(86070),r=i(62392);const a={sidebar_label:"Storage Container Manager"},o="Storage Container Manager",c={},d=[{value:"Main responsibilities",id:"main-responsibilities",level:2},{value:"Main components",id:"main-components",level:2},{value:"Network services provided by Storage Container Manager",id:"network-services-provided-by-storage-container-manager",level:3},{value:"Persisted state",id:"persisted-state",level:3},{value:"Safe Mode",id:"safe-mode",level:2},{value:"How to Exit Safe Mode",id:"how-to-exit-safe-mode",level:3},{value:"Safe Mode Pre-Check",id:"safe-mode-pre-check",level:3},{value:"Notable configurations",id:"notable-configurations",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"storage-container-manager",children:"Storage Container Manager"})}),"\n",(0,s.jsxs)(n.p,{children:["Storage Container Manager (SCM) is the leader node of the ",(0,s.jsx)(n.em,{children:"block space management"}),".\nThe main responsibility is to create and manage ",(0,s.jsx)(n.a,{href:"../replication/storage-containers",children:"containers"})," which is the main replication unit of Ozone."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Storage Container Manager",src:i(95642).A+"",width:"379",height:"294"})}),"\n",(0,s.jsx)(n.h2,{id:"main-responsibilities",children:"Main responsibilities"}),"\n",(0,s.jsx)(n.p,{children:"Storage Container Manager provides multiple critical functions for the Ozone cluster.\nSCM acts as the cluster manager, Certificate authority, Block manager and the Replica manager."}),"\n",(0,s.jsxs)(n.p,{children:["SCM is in charge of creating an Ozone cluster. When an SCM is booted up via ",(0,s.jsx)(n.code,{children:"init"})," command, SCM creates the cluster identity and root certificates needed for the SCM certificate authority. SCM manages the life cycle of a data node in the cluster."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"SCM is the block manager. SCM allocates blocks and assigns them to data nodes. Clients read and write these blocks directly."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"SCM keeps track of all the block replicas. If there is a loss of data node or a disk, SCM detects it and instructs data nodes to make copies of the missing blocks to ensure high availability."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"SCM's Certificate Authority"})," is in\ncharge of issuing identity certificates for each and every\nservice in the cluster. This certificate infrastructure makes\nit easy to enable mTLS at network layer and the block\ntoken infrastructure depends on this certificate infrastructure."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"main-components",children:"Main components"}),"\n",(0,s.jsx)(n.p,{children:"For a detailed view of Storage Container Manager this section gives a quick overview about the provided network services and the stored persisted data."}),"\n",(0,s.jsx)(n.h3,{id:"network-services-provided-by-storage-container-manager",children:"Network services provided by Storage Container Manager"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Pipelines: List/Delete/Activate/Deactivate","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pipelines are set of Datanodes to form replication groups"}),"\n",(0,s.jsx)(n.li,{children:"Raft groups are planned by SCM"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Containers: Create / List / Delete containers"}),"\n",(0,s.jsx)(n.li,{children:"Admin related requests"}),"\n",(0,s.jsx)(n.li,{children:"Safemode status/modification"}),"\n",(0,s.jsx)(n.li,{children:"Replication manager start / stop"}),"\n",(0,s.jsx)(n.li,{children:"CA authority service"}),"\n",(0,s.jsx)(n.li,{children:"Required by other sever components"}),"\n",(0,s.jsxs)(n.li,{children:["Datanode HeartBeat protocol","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"From Datanode to SCM (30 sec by default)"}),"\n",(0,s.jsx)(n.li,{children:"Datanodes report the status of containers, node..."}),"\n",(0,s.jsx)(n.li,{children:"SCM can add commands to the response"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Client doesn't connect directly to the SCM."})}),"\n",(0,s.jsx)(n.h3,{id:"persisted-state",children:"Persisted state"}),"\n",(0,s.jsx)(n.p,{children:"The following data is persisted in Storage Container Manager side in a specific RocksDB directory"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Pipelines","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Replication group of servers. Maintained to find a group for new container/block allocations."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Containers","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Containers are the replication units. Data is required to act in case of data under/over replicated."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Deleted blocks","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Block data is deleted in the background. Need a list to follow the progress."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Valid cert"}),"\n",(0,s.jsx)(n.li,{children:"Used by the internal Certificate Authority to authorize other Ozone services"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"safe-mode",children:"Safe Mode"}),"\n",(0,s.jsx)(n.p,{children:"SCM (Storage Container Manager) enters safe mode on startup. This is a protective state that allows the system to become stable before it becomes fully operational. During safe mode, certain operations like block allocation are restricted."}),"\n",(0,s.jsx)(n.h3,{id:"how-to-exit-safe-mode",children:"How to Exit Safe Mode"}),"\n",(0,s.jsx)(n.p,{children:"There are two ways to exit safe mode:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Automatic Exit:"})," SCM will automatically exit safe mode when a set of predefined ",(0,s.jsx)(n.code,{children:"SafeModeExitRule"}),"s are satisfied. These rules ensure that the cluster is in a healthy state. The primary rules are:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"DataNodeSafeModeRule"})}),": Checks if a minimum number of Datanodes have registered with the SCM. This is configured by ",(0,s.jsx)(n.code,{children:"hdds.scm.safemode.min.datanode"})," (default: ",(0,s.jsx)(n.code,{children:"3"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"RatisContainerSafeModeRule"})}),": Checks if a certain percentage of containers with at least one replica reported are available. This is configured by ",(0,s.jsx)(n.code,{children:"hdds.scm.safemode.threshold.pct"})," (default: ",(0,s.jsx)(n.code,{children:"0.99"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"HealthyPipelineSafeModeRule"})}),": Checks if a certain percentage of pipelines are healthy. This is configured by ",(0,s.jsx)(n.code,{children:"hdds.scm.safemode.healthy.pipeline.pct"})," (default: ",(0,s.jsx)(n.code,{children:"0.10"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"OneReplicaPipelineSafeModeRule"})}),": Checks if a certain percentage of pipelines have at least one replica reported. This is configured by ",(0,s.jsx)(n.code,{children:"hdds.scm.safemode.atleast.one.node.reported.pipeline.pct"})," (default: ",(0,s.jsx)(n.code,{children:"0.90"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ECContainerSafeModeRule"})}),": Checks if a certain percentage of erasure coded block groups are healthy. This is also configured by ",(0,s.jsx)(n.code,{children:"hdds.scm.safemode.threshold.pct"})," (default: ",(0,s.jsx)(n.code,{children:"0.99"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Manual Exit:"})," You can force SCM to exit safe mode using the ",(0,s.jsx)(n.code,{children:"ozone admin safemode --force-exit"})," command."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"safe-mode-pre-check",children:"Safe Mode Pre-Check"}),"\n",(0,s.jsxs)(n.p,{children:['There\'s also a "pre-check" phase. SCM will not exit safe mode until all pre-check rules are satisfied.\nThe ',(0,s.jsx)(n.code,{children:"DataNodeSafeModeRule"})," is a pre-check rule.\nThis means that SCM will wait for a minimum number of Datanodes to be available before it even considers the other conditions for exiting safe mode."]}),"\n",(0,s.jsx)(n.h2,{id:"notable-configurations",children:"Notable configurations"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Key"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ozone.scm.container.size"})}),(0,s.jsx)(n.td,{children:"5GB"}),(0,s.jsx)(n.td,{children:"Default container size used by Ozone"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ozone.scm.block.size"})}),(0,s.jsx)(n.td,{children:"256MB"}),(0,s.jsx)(n.td,{children:"The default size of a data block."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"hdds.scm.safemode.min.datanode"})}),(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Minimum number of Datanodes to start the real work."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ozone.scm.http-address"})}),(0,s.jsx)(n.td,{children:"0.0.0.0:9876"}),(0,s.jsx)(n.td,{children:"HTTP address of the SCM server"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ozone.metadata.dirs"})}),(0,s.jsx)(n.td,{children:"none"}),(0,s.jsx)(n.td,{children:"Directory to store persisted data (RocksDB)."})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},62392:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(30758);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},95642:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/StorageContainerManager-989fad39f0a68b94e8614e86f0f7abab.png"}}]);