"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[7263],{62392:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>r});var t=n(30758);const o={},a=t.createContext(o);function i(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(a.Provider,{value:s},e.children)}},76916:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"administrator-guide/operations/snapshots/overview","title":"Snapshots Overview","description":"Introduction","source":"@site/docs/05-administrator-guide/03-operations/08-snapshots/01-overview.md","sourceDirName":"05-administrator-guide/03-operations/08-snapshots","slug":"/administrator-guide/operations/snapshots/overview","permalink":"/docs/administrator-guide/operations/snapshots/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/03-operations/08-snapshots/01-overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Snapshots","permalink":"/docs/administrator-guide/operations/snapshots/"},"next":{"title":"Snapshot Configuration Properties","permalink":"/docs/administrator-guide/operations/snapshots/configuration-properties"}}');var o=n(86070),a=n(62392);const i={},r="Snapshots Overview",c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Architecture",id:"architecture",level:2},{value:"System Architecture Deep Dive",id:"system-architecture-deep-dive",level:2},{value:"Managing Snapshots",id:"managing-snapshots",level:2},{value:"Using Snapshots via CLI",id:"using-snapshots-via-cli",level:3},{value:"Create Snapshot",id:"create-snapshot",level:4},{value:"Delete Snapshot",id:"delete-snapshot",level:4},{value:"List Snapshots",id:"list-snapshots",level:4},{value:"Read from Snapshot",id:"read-from-snapshot",level:4},{value:"Snapshot Diff",id:"snapshot-diff",level:4},{value:"List Snapshot Diff Jobs",id:"list-snapshot-diff-jobs",level:4},{value:"Snapshot Info",id:"snapshot-info",level:4},{value:"Programmatic Access via Java",id:"programmatic-access-via-java",level:3},{value:"Hadoop Compatible FileSystem (HCFS) Interface",id:"hadoop-compatible-filesystem-hcfs-interface",level:4},{value:"Ozone ObjectStore Client API",id:"ozone-objectstore-client-api",level:4},{value:"HTTP REST API Access",id:"http-rest-api-access",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Configuration Properties",id:"configuration-properties",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Authorization",id:"authorization",level:2},{value:"Comparison to HDFS Snapshots",id:"comparison-to-hdfs-snapshots",level:2},{value:"Known Issues and Limitations",id:"known-issues-and-limitations",level:2},{value:"Linux System Configuration",id:"linux-system-configuration",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"snapshots-overview",children:"Snapshots Overview"})}),"\n",(0,o.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(s.p,{children:"Ozone Snapshots let you create point-in-time, consistent, read-only images of a bucket. Key uses include:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Backup and Restore"}),": For regular data protection and recovery."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Archival and Compliance"}),": For long-term data retention."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Replication and Disaster Recovery (DR)"}),": For copying bucket images to remote DR sites."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Incremental Replication"}),": ",(0,o.jsx)(s.code,{children:"DistCp"})," with ",(0,o.jsx)(s.code,{children:"SnapshotDiff"})," efficiently syncs buckets."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"architecture",children:"Architecture"}),"\n",(0,o.jsx)(s.p,{children:"Ozone Snapshots provide point-in-time, read-only copies of buckets. This relies on Ozone's immutable data blocks. When a snapshot is taken, Ozone Manager (OM) copies the bucket's metadata (key namespace) using its RocksDB store. Data blocks aren't duplicated; they are preserved as long as any snapshot or the live bucket references them. Background services reclaim unreferenced blocks."}),"\n",(0,o.jsx)(s.p,{children:"The SnapshotDiff feature compares two snapshots (or a snapshot and the live bucket) to identify changes like added, deleted, modified, or renamed keys, caching results for speed."}),"\n",(0,o.jsx)(s.h2,{id:"system-architecture-deep-dive",children:"System Architecture Deep Dive"}),"\n",(0,o.jsx)(s.p,{children:"Ozone snapshots version bucket metadata within the OM. A dedicated snapshot metadata table in RocksDB records the key directory tree at snapshot creation. This is an instant operation as it involves metadata pointers (via RocksDB checkpoints) rather than data copying. Each snapshot has a unique ID and name."}),"\n",(0,o.jsx)(s.p,{children:"When keys are changed or deleted in the live bucket, their data blocks are retained if a snapshot references them. This means that taking a snapshot during a large delete operation will preserve the deleted keys in the snapshot, preventing space reclamation until the snapshot is removed. This is by design to maintain snapshot consistency. Deleting a snapshot makes its exclusively referenced blocks reclaimable by background cleanup processes."}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"SnapshotDiff Implementation:"})," Differences are computed using RocksDB key comparisons and a compaction DAG for recent changes (default: 30 days). For older snapshots or if DAG data is compacted, a full metadata scan is used. Diff results (",(0,o.jsx)(s.code,{children:"+"})," add, ",(0,o.jsx)(s.code,{children:"-"})," delete, ",(0,o.jsx)(s.code,{children:"M"})," modify, ",(0,o.jsx)(s.code,{children:"R"})," rename) are cached."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Snapshot Data Storage:"})," Snapshot metadata resides in OM's RocksDB. Diff job data is stored in ",(0,o.jsx)(s.code,{children:"ozone.om.snapshot.diff.db.dir"})," (defaults to OM metadata directory)."]}),"\n",(0,o.jsxs)(s.p,{children:["For more details, see Prashant Pogde's ",(0,o.jsx)(s.a,{href:"https://medium.com/@prashantpogde/introducing-apache-ozone-snapshots-af82e976142f",children:"Introducing Apache Ozone Snapshots"}),"."]}),"\n",(0,o.jsx)(s.h2,{id:"managing-snapshots",children:"Managing Snapshots"}),"\n",(0,o.jsx)(s.p,{children:"This section shows how to manage Ozone snapshots via CLI and Java."}),"\n",(0,o.jsx)(s.h3,{id:"using-snapshots-via-cli",children:"Using Snapshots via CLI"}),"\n",(0,o.jsxs)(s.p,{children:["Manage snapshots using ",(0,o.jsx)(s.code,{children:"ozone sh"})," or ",(0,o.jsx)(s.code,{children:"ozone fs"})," (Hadoop-compatible) commands:"]}),"\n",(0,o.jsx)(s.h4,{id:"create-snapshot",children:"Create Snapshot"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot create /vol1/bucket1 [snapshotName]\n# Or via Hadoop FS interface:\n# ozone fs -createSnapshot ofs://om-service/vol1/bucket1 [snapshotName]\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Requires bucket owner or admin privilege. If ",(0,o.jsx)(s.code,{children:"snapshotName"})," is omitted, it's auto-generated (e.g., ",(0,o.jsx)(s.code,{children:"s20250530-005848.163"}),"). Custom names must be unique, valid DNS names."]}),"\n",(0,o.jsx)(s.h4,{id:"delete-snapshot",children:"Delete Snapshot"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot delete /vol1/bucket1 <snapshotName>\n# Or via Hadoop FS interface:\n# ozone fs -deleteSnapshot ofs://om-service/vol1/bucket1 <snapshotName>\n"})}),"\n",(0,o.jsx)(s.h4,{id:"list-snapshots",children:"List Snapshots"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot list /vol1/bucket1\n# Or via Hadoop FS interface (list .snapshot directory):\n# ozone fs -ls /vol1/bucket1/.snapshot\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Snapshots appear in the bucket's read-only ",(0,o.jsx)(s.code,{children:".snapshot"})," directory."]}),"\n",(0,o.jsx)(s.h4,{id:"read-from-snapshot",children:"Read from Snapshot"}),"\n",(0,o.jsx)(s.p,{children:"List keys:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh key list /vol1/bucket1/.snapshot/<snapshotName>\n# Or: ozone fs -ls /vol1/bucket1/.snapshot/<snapshotName>\n"})}),"\n",(0,o.jsx)(s.p,{children:"Get a key:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh key get /vol1/bucket1/.snapshot/<snapshotName>/reports/Q1.csv ./Q1_snapshot.csv\n"})}),"\n",(0,o.jsx)(s.p,{children:"Requires read privileges on the bucket."}),"\n",(0,o.jsx)(s.h4,{id:"snapshot-diff",children:"Snapshot Diff"}),"\n",(0,o.jsx)(s.p,{children:"Shows changes between two snapshots or a snapshot and the live bucket."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot diff /vol1/bucket1 <snap1> <snap2_or_live_bucket>\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Output prefixes: ",(0,o.jsx)(s.code,{children:"+"})," (add), ",(0,o.jsx)(s.code,{children:"-"})," (delete), ",(0,o.jsx)(s.code,{children:"M"})," (modify), ",(0,o.jsx)(s.code,{children:"R"})," (rename). Use ",(0,o.jsx)(s.code,{children:"-p"}),", ",(0,o.jsx)(s.code,{children:"-t"})," for pagination.\nManage diff jobs: ",(0,o.jsx)(s.code,{children:"ozone sh snapshot listDiff /vol1/bucket1"}),", ",(0,o.jsx)(s.code,{children:"ozone sh snapshot cancelDiff <jobId>"}),"."]}),"\n",(0,o.jsx)(s.h4,{id:"list-snapshot-diff-jobs",children:"List Snapshot Diff Jobs"}),"\n",(0,o.jsx)(s.p,{children:"Lists snapshot diff jobs for a bucket."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot listDiff /vol1/bucket1\n"})}),"\n",(0,o.jsxs)(s.p,{children:["By default, lists jobs with ",(0,o.jsx)(s.code,{children:"in_progress"})," status. Use ",(0,o.jsx)(s.code,{children:"--job-status"})," to filter by specific status:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# List jobs with specific status (queued, in_progress, done, failed, rejected)\nozone sh snapshot listDiff /vol1/bucket1 --job-status done\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Use ",(0,o.jsx)(s.code,{children:"--all-status"})," to list all jobs regardless of status:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# List all snapshot diff jobs regardless of status\nozone sh snapshot listDiff /vol1/bucket1 --all-status\n"})}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Note:"})," The difference between ",(0,o.jsx)(s.code,{children:"--all-status"})," and ",(0,o.jsx)(s.code,{children:"-all"})," (or ",(0,o.jsx)(s.code,{children:"-a"}),"):"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--all-status"}),": Controls which jobs to show based on status (lists all jobs regardless of status)"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"-all"})," (or ",(0,o.jsx)(s.code,{children:"-a"}),"): Controls the number of results returned (pagination option, removes pagination limit, ",(0,o.jsx)(s.strong,{children:"not related to snapshot diff job status"}),")"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"For example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# List all jobs regardless of status, with pagination limit removed\nozone sh snapshot listDiff /vol1/bucket1 --all-status -all\n# Or limit results to 10 items\nozone sh snapshot listDiff /vol1/bucket1 --all-status -l 10\n"})}),"\n",(0,o.jsx)(s.h4,{id:"snapshot-info",children:"Snapshot Info"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ozone sh snapshot info /vol1/bucket1 <snapshotName>\n"})}),"\n",(0,o.jsx)(s.p,{children:"Shows ID, creation time, status, and space usage (Reference and Exclusive Size)."}),"\n",(0,o.jsx)(s.p,{children:"CLI operations call Ozone Manager RPCs and enforce authorization."}),"\n",(0,o.jsx)(s.h3,{id:"programmatic-access-via-java",children:"Programmatic Access via Java"}),"\n",(0,o.jsx)(s.p,{children:"Manage and access snapshots using Java APIs:"}),"\n",(0,o.jsx)(s.h4,{id:"hadoop-compatible-filesystem-hcfs-interface",children:"Hadoop Compatible FileSystem (HCFS) Interface"}),"\n",(0,o.jsxs)(s.p,{children:["Use Ozone FileSystem (ofs) API (Hadoop ",(0,o.jsx)(s.code,{children:"FileSystem"}),")."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'// Example: Create, list, read, rename, delete snapshots\nConfiguration conf = new OzoneConfiguration();\nFileSystem fs = FileSystem.get(new Path("ofs://om-service/vol1/bucket1").toUri(), conf);\nPath bucketPath = new Path("/vol1/bucket1");\n\n// fs.createSnapshot(bucketPath, "snapshotName");\n// fs.listStatus(new Path(bucketPath, ".snapshot"));\n// fs.open(new Path(bucketPath, ".snapshot/snapshotName/key"));\n// fs.rename(new Path(bucketPath, ".snapshot/oldName"), new Path(bucketPath, ".snapshot/newName"));\n// fs.deleteSnapshot(bucketPath, "snapshotName");\n'})}),"\n",(0,o.jsxs)(s.p,{children:["Handle ",(0,o.jsx)(s.code,{children:"OMException"})," or ",(0,o.jsx)(s.code,{children:"IOException"}),". Snapshots are in the bucket's ",(0,o.jsx)(s.code,{children:".snapshot"})," directory."]}),"\n",(0,o.jsx)(s.p,{children:"Refer to the Ozone File System API guide for more details."}),"\n",(0,o.jsx)(s.h4,{id:"ozone-objectstore-client-api",children:"Ozone ObjectStore Client API"}),"\n",(0,o.jsxs)(s.p,{children:["Use ",(0,o.jsx)(s.code,{children:"OzoneClient"})," and ",(0,o.jsx)(s.code,{children:"ObjectStore"})," API."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'// Example: Create, list, get info, rename, delete snapshots\nOzoneClient ozClient = OzoneClientFactory.getRpcClient(conf);\nObjectStore store = ozClient.getObjectStore();\n\n// store.createSnapshot("vol1", "bucket1", "snapshotName");\n// store.listSnapshot("vol1", "bucket1", null, null);\n// store.getSnapshotInfo("vol1", "bucket1", "snapshotName");\n// store.renameSnapshot("vol1", "bucket1", "oldName", "newName");\n// store.deleteSnapshot("vol1", "bucket1", "snapshotName");\n'})}),"\n",(0,o.jsx)(s.p,{children:"Handle exceptions for privilege or non-existent snapshot issues."}),"\n",(0,o.jsx)(s.h4,{id:"http-rest-api-access",children:"HTTP REST API Access"}),"\n",(0,o.jsxs)(s.p,{children:["Use HttpFS Gateway (WebHDFS-compatible REST API) for filesystem operations on snapshots (e.g., reading from ",(0,o.jsx)(s.code,{children:".snapshot"})," paths). Create/delete/rename are supported; ",(0,o.jsx)(s.code,{children:"getSnapshotDiff"})," is not yet."]}),"\n",(0,o.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(s.h3,{id:"configuration-properties",children:"Configuration Properties"}),"\n",(0,o.jsxs)(s.p,{children:["Note: Snapshot configuration may change over time. Check ",(0,o.jsx)(s.code,{children:"ozone-default.xml"})," for the most up-to-date settings."]}),"\n",(0,o.jsx)(s.p,{children:"Key snapshot-related configuration properties include:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"ozone.om.snapshot.diff.db.dir"}),": Directory for snapshot diff job data (defaults to OM metadata directory)"]}),"\n",(0,o.jsx)(s.li,{children:"Configuration for snapshot retention policies"}),"\n",(0,o.jsx)(s.li,{children:"Snapshot cleanup and background service settings"}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["For detailed snapshot configuration properties, see ",(0,o.jsx)(s.a,{href:"/docs/administrator-guide/operations/snapshots/configuration-properties",children:"Snapshot Configuration Properties"}),"."]}),"\n",(0,o.jsx)(s.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,o.jsx)(s.p,{children:"Monitor OM heap usage with many snapshots or large diffs. Enable Ozone Native ACLs or Ranger for access control."}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Monitoring Snapshots:"})," Use OM metrics (Prometheus, RPC) for snapshot counts, diff operations, etc. Check OM logs for snapshot-related messages."]}),"\n",(0,o.jsx)(s.h2,{id:"authorization",children:"Authorization"}),"\n",(0,o.jsx)(s.p,{children:"Snapshot operations require specific privileges:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Create, Delete, Rename Snapshot:"})," Require admin or bucket owner privileges. Access is denied otherwise."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"List Snapshots, Get Snapshot Info:"})," Require read/list access to the bucket. Users who can list bucket contents can typically list its snapshots."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"SnapshotDiff, Cancel/List SnapshotDiff Jobs:"})," Require read access to the bucket, as diffs reveal key information."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Ozone supports native ACLs and optional Ranger policies for snapshot authorization. The behavior described assumes native ACLs. If using Ranger, ensure appropriate permissions are configured for snapshot operations."}),"\n",(0,o.jsx)(s.h2,{id:"comparison-to-hdfs-snapshots",children:"Comparison to HDFS Snapshots"}),"\n",(0,o.jsx)(s.p,{children:"Ozone and HDFS snapshots are conceptually similar but differ in key aspects:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Granularity:"})," Ozone snapshots are bucket-level; HDFS snapshots can be taken at any directory level (if snapshottable)."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Metadata vs. Data Changes:"})," Both track key/file changes. Ozone snapshots don't version bucket metadata changes (e.g., quotas, ACLs)."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Access and Restore:"})," Both use a ",(0,o.jsx)(s.code,{children:".snapshot"})," path for read-only access. Restoring in Ozone is a manual copy process (e.g., using DistCp); no automatic rollback."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Implementation:"})," Ozone uses OM's key-value store (RocksDB) for O(1) metadata-pointer-based snapshots. HDFS also uses metadata manipulation but Ozone's object-store nature means no Datanode-level block tracking for snapshots; all intelligence is in OM."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"known-issues-and-limitations",children:"Known Issues and Limitations"}),"\n",(0,o.jsx)(s.p,{children:"Key limitations for Ozone snapshots include:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"S3 Interface Support:"})," Snapshot operations (create, list, delete) are not available via the S3 API or ",(0,o.jsx)(s.code,{children:"s3a"})," connector. Manage snapshots using Ozone RPC (shell, ",(0,o.jsx)(s.code,{children:"ozone fs"}),", Java API). Snapshotted data can be read via S3 using the ",(0,o.jsx)(s.code,{children:".snapshot/snapshotName/keyName"})," path."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Ratis & EC Buckets:"})," Snapshots work for both Ratis and EC buckets, managed via Ozone interfaces."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsxs)(s.strong,{children:["Reserved Namespace Name ",(0,o.jsx)(s.code,{children:".snapshot"}),":"]})," ",(0,o.jsx)(s.code,{children:".snapshot"})," is a reserved name at the root of a bucket and cannot be used for user-created keys or directories."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Snapshot Performance and Scale:"})," While creating snapshots is fast, a very large number of snapshots per bucket (thousands) can increase OM metadata size and potentially slow down listing operations. Snapshot diff performance is generally not affected by the number of snapshots but by concurrent diff operations."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Space Utilization Reporting:"})," Space used by snapshots (data no longer in the active bucket but retained by snapshots) is reported in ",(0,o.jsx)(s.code,{children:"ozone sh snapshot info"}),". Deleting a snapshot frees space asynchronously."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Hard Link Upper Limit:"})," RocksDB checkpoints use hard links, limited to 65,535 per file by the filesystem. This restricts the number of snapshots per bucket."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Refer to project release notes for updates on these limitations."}),"\n",(0,o.jsx)(s.h2,{id:"linux-system-configuration",children:"Linux System Configuration"}),"\n",(0,o.jsx)(s.p,{children:"For optimal performance and stability when using Ozone snapshots, especially in production, consider the following system configurations:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Open File Descriptors:"})," Increase the ",(0,o.jsx)(s.code,{children:"nofile"})," ulimit (e.g., to 64,000 or higher) for the Ozone Manager (OM) process to handle numerous RocksDB files and snapshot operations."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Metadata Storage:"})," Use high-performance storage like NVMe SSDs for OM metadata directories (",(0,o.jsx)(s.code,{children:"ozone.metadata.dirs"}),") to improve I/O for snapshot and diff operations."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"OM Resources:"})," Allocate sufficient RAM (e.g., 16-32GB+, monitor GC) and CPU to the Ozone Manager, particularly for clusters with many snapshots or concurrent diff jobs."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Datanode Disk Space:"})," Account for increased disk usage on Datanodes, as snapshots retain data blocks that would otherwise be deleted. Plan capacity based on snapshot retention policies and change rates."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Filesystem & Kernel:"})," Use filesystems like ext4 or xfs (often preferred for RocksDB) for OM metadata. Ensure disk schedulers and RAID configurations are optimized for low latency."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Networking:"})," Ensure robust network connectivity to the OM, as snapshot diffs or HttpFS access can involve significant data transfer."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Always test snapshot operations under your expected load to fine-tune these configurations."})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);