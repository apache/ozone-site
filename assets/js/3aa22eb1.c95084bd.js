"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[8594],{62392:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>l});var o=a(30758);const i={},t=o.createContext(i);function s(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(t.Provider,{value:n},e.children)}},68685:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"administrator-guide/operations/ldb","title":"LDB Tool","description":"Ozone heavily uses RocksDB for storing metadata.","source":"@site/docs/05-administrator-guide/03-operations/13-ldb.md","sourceDirName":"05-administrator-guide/03-operations","slug":"/administrator-guide/operations/ldb","permalink":"/docs/administrator-guide/operations/ldb","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/03-operations/13-ldb.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_label":"LDB Tool"},"sidebar":"defaultSidebar","previous":{"title":"Trash","permalink":"/docs/administrator-guide/operations/trash"},"next":{"title":"Troubleshooting","permalink":"/docs/troubleshooting/"}}');var i=a(86070),t=a(62392);const s={sidebar_label:"LDB Tool"},l="LDB Tool",c={},d=[{value:"list_column_families command",id:"list_column_families-command",level:2},{value:"scan command",id:"scan-command",level:2},{value:"<code>--startkey</code> and <code>--endkey</code>",id:"--startkey-and---endkey",level:3},{value:"<code>--fields</code>",id:"--fields",level:3},{value:"<code>--filter</code>",id:"--filter",level:3},{value:"value-schema command",id:"value-schema-command",level:2},{value:"checkpoint command",id:"checkpoint-command",level:2}];function r(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ldb-tool",children:"LDB Tool"})}),"\n",(0,i.jsxs)(n.p,{children:["Ozone heavily uses RocksDB for storing metadata.\nThis tool helps parse the contents of RocksDB belonging to Ozone Roles.\nSupported DB's : Ozone Manager (",(0,i.jsx)(n.code,{children:"om.db"}),") , StorageContainerManager (",(0,i.jsx)(n.code,{children:"scm.db"}),"),  Datanode/Container (",(0,i.jsx)(n.code,{children:"container.db"}),")\nBelow is the usage:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Usage: ozone debug ldb --db=<dbPath> [COMMAND]\nParse rocksdb file content\n      --db=<dbPath>   Database File Path\nCommands:\n  scan                      Parse specified metadataTable\n  list_column_families, ls  list all column families in db.\n  value-schema              Schema of value in metadataTable\n  checkpoint                Create checkpoint for specified db\n"})}),"\n",(0,i.jsx)(n.h2,{id:"list_column_families-command",children:"list_column_families command"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"list_column_families"})," command lists all the column families in the db provided."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ ozone debug ldb --db=/path/to/scm.db ls\ndefault\nsequenceId\nrevokedCertsV2\npipelines\ncrls\ncrlSequenceId\nmeta\ncontainers\nvalidCerts\nvalidSCMCerts\nscmTransactionInfos\ndeletedBlocks\nstatefulServiceConfig\nrevokedCerts\nmove\n"})}),"\n",(0,i.jsx)(n.h2,{id:"scan-command",children:"scan command"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"scan"})," command parses a particular column family of a RocksDB provided and prints the records."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'Usage: ozone debug ldb scan [--compact] [--count] [--with-keys]\n                            [--batch-size=<batchSize>] --cf=<tableName>\n                            [--cid=<containerId>] [-d=<dnDBSchemaVersion>]\n                            [-e=<endKey>] [--fields=<fieldsFilter>]\n                            [--filter=<filter>] [-l=<limit>] [-o=<fileName>]\n                            [-s=<startKey>] [--thread-count=<threadCount>]\nParse specified metadataTable\n      --batch-size=<batchSize>\n                          Batch size for processing DB data.\n      --cf, --column_family, --column-family=<tableName>\n                          Table name\n      --cid, --container-id=<containerId>\n                          Container ID. Applicable if datanode DB Schema is V3\n      --compact           disable the pretty print the output\n      --count, --show-count\n                          Get estimated key count for the given DB column family\n                            Default: false\n  -d, --dnSchema, --dn-schema=<dnDBSchemaVersion>\n                          Datanode DB Schema Version: V1/V2/V3\n  -e, --ek, --endkey=<endKey>\n                          Key at which iteration of the DB ends\n      --fields=<fieldsFilter>\n                          Comma-separated list of fields needed for each value.\n                            eg.) "name,acls.type" for showing name and type\n                            under acls.\n      --filter=<filter>   Comma-separated list of "<field>:<operator>:<value>"\n                            where <field> is any valid field of the record,\n                            <operator> is [EQUALS,LESSER, GREATER or REGEX].\n                            (EQUALS compares the exact string, REGEX compares\n                            with a valid regular expression passed, and\n                            LESSER/GREATER works with numeric values), <value>\n                            is the value of the field.\n                          eg.) "dataSize:equals:1000" for showing records\n                            having the value 1000 for dataSize,\n                               "keyName:regex:^key.*$" for showing records\n                            having keyName that matches the given regex.\n  -l, --limit, --length=<limit>\n                          Maximum number of items to list.\n  -o, --out=<fileName>    File to dump table scan data\n  -s, --sk, --startkey=<startKey>\n                          Key from which to iterate the DB\n      --thread-count=<threadCount>\n                          Thread count for concurrent processing.\n      --with-keys         Print a JSON object of key->value pairs (default)\n                            instead of a JSON array of only values.\n'})}),"\n",(0,i.jsxs)(n.p,{children:["By default, the contents are printed on the console, but it can be redirected to a file using the ",(0,i.jsx)(n.code,{children:"--out"})," option."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--length"})," can be used to limit the number of records being printed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--count"})," doesn't print the records, it shows the approximate number of records. This is not accurate."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ozone debug ldb scan"})," command provides many filtering options to make debugging easier, elaborated below:"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Multiple filtering options can be used together in a single command."})}),"\n",(0,i.jsxs)(n.h3,{id:"--startkey-and---endkey",children:[(0,i.jsx)(n.code,{children:"--startkey"})," and ",(0,i.jsx)(n.code,{children:"--endkey"})]}),"\n",(0,i.jsx)(n.p,{children:"As the names suggest, these options specify the keys from/until which the iteration needs to happen."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--startkey"})," specifies which key to start iterating from, it is inclusive."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--endkey"})," specifies which key to stop iterating at, it is exclusive."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone debug ldb --db=/path/to/om.db scan --cf=volumeTable --startkey=vol3 --endkey=vol5\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{ "/vol3": {\n  "metadata" : { },\n  "objectID" : -9999,\n  "updateID" : 4000,\n  "adminName" : "om",\n  "ownerName" : "om",\n  "volume" : "vol3",\n  "creationTime" : 1707192335309,\n  "modificationTime" : 1714057412205,\n  "quotaInBytes" : 22854448694951936,\n  "quotaInNamespace" : 100000000,\n  "usedNamespace" : 1,\n  "acls" : [ {\n    "type" : "USER",\n    "name" : "om",\n    "aclScope" : "ACCESS"\n  } ],\n  "refCount" : 0\n}\n, "/vol4": {\n    "metadata" : { },\n    "objectID" : -888,\n    "updateID" : 5000,\n    "adminName" : "om",\n    "ownerName" : "om",\n    "volume" : "vol4",\n    "creationTime" : 1696280979907,\n    "modificationTime" : 1696280979907,\n    "quotaInBytes" : 2251799813685250,\n    "quotaInNamespace" : 100000000,\n    "usedNamespace" : 2,\n    "acls" : [ {\n      "type" : "USER",\n      "name" : "om",\n      "aclScope" : "ACCESS"\n    } ],\n    "refCount" : 0\n}\n  }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"--fields",children:(0,i.jsx)(n.code,{children:"--fields"})}),"\n",(0,i.jsxs)(n.p,{children:["There are multiple fields in each record. ",(0,i.jsx)(n.code,{children:"--fields"})," option allows us to choose the specific fields to display."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ozone debug ldb --db=/path/to/om.db scan --cf=keyTable -l=1 --fields="volumeName,bucketName,keyName,keyLocationVersions.version,acls.name"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{ "/vol1/ozone-legacy-bucket/10T-1-terasort-input/": {\n  "keyLocationVersions" : [ {\n    "version" : 0\n  } ],\n  "keyName" : "10T-1-terasort-input/",\n  "bucketName" : "ozone-legacy-bucket",\n  "acls" : [ {\n    "name" : "om"\n  }, {\n    "name" : "scm"\n  }, {\n    "name" : "testuser"\n  } ],\n  "volumeName" : "vol1"\n}\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"--filter",children:(0,i.jsx)(n.code,{children:"--filter"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"--filter"})," can be used to select records whose value matches a given condition. The filter is given in this format: ",(0,i.jsx)(n.code,{children:"<field>:<operator>:<value>"}),",\nwhere ",(0,i.jsx)(n.code,{children:"<field>"})," is any valid field from the value of the record, ",(0,i.jsx)(n.code,{children:"<operator>"})," is one of the 4 supported operations ",(0,i.jsx)(n.code,{children:"[equals, regex, lesser, greater]"}),", ",(0,i.jsx)(n.code,{children:"<value>"})," is the value used for the comparison."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"'Equals' and 'regex' work with string, bool and numerical fields, 'lesser' and 'greater' work only with numerical values."}),"\n",(0,i.jsx)(n.li,{children:"Multiple filters can also be given in one command, they need to be separated by commas."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"equals"})," operator:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ozone debug ldb --db=/path/to/om.db scan --cf=volumeTable --filter="usedNamespace:equals:2"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "/vol4": {\n    "metadata": {},\n    "objectID": -888,\n    "updateID": 5000,\n    "adminName": "om",\n    "ownerName": "om",\n    "volume": "vol4",\n    "creationTime": 1696280979907,\n    "modificationTime": 1696280979907,\n    "quotaInBytes": 2251799813685250,\n    "quotaInNamespace": 100000000,\n    "usedNamespace": 2,\n    "acls": [\n      {\n        "type": "USER",\n        "name": "om",\n        "aclScope": "ACCESS"\n      }\n    ],\n    "refCount": 0\n  }\n, "/vol5": {\n  "metadata" : { },\n  "objectID" : -956599,\n  "updateID" : 45600,\n  "adminName" : "om",\n  "ownerName" : "om",\n  "volume" : "vol5",\n  "creationTime" : 1807192332309,\n  "modificationTime" : 1914057410005,\n  "quotaInBytes" : 7785494951936,\n  "quotaInNamespace" : 100000000,\n  "usedNamespace" : 2,\n  "acls" : [ {\n    "type" : "USER",\n    "name" : "om",\n    "aclScope" : "ACCESS"\n  } ],\n  "refCount" : 0\n}\n }\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"lesser"})," operator (",(0,i.jsx)(n.code,{children:"greater"})," operator can also be used in the same way):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ozone debug ldb --db=/path/to/om.db scan --cf=volumeTable --filter="usedNamespace:lesser:2"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "/vol2": {\n    "metadata": {},\n    "objectID": -73548,\n    "updateID": 2384,\n    "adminName": "om",\n    "ownerName": "om",\n    "volume": "vol2",\n    "creationTime": 11980979907,\n    "modificationTime": 1296280979900,\n    "quotaInBytes": 417913685250,\n    "quotaInNamespace": 100000000,\n    "usedNamespace": 1,\n    "acls": [\n      {\n        "type": "USER",\n        "name": "om",\n        "aclScope": "ACCESS"\n      }\n    ],\n    "refCount": 0\n  }\n }\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"regex"})," operator:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ozone debug ldb --db=/path/to/om.db scan --cf=volumeTable --filter="volume:regex:^v.*2$"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "/vol2": {\n    "metadata": {},\n    "objectID": -73548,\n    "updateID": 2384,\n    "adminName": "om",\n    "ownerName": "om",\n    "volume": "vol2",\n    "creationTime": 11980979907,\n    "modificationTime": 1296280979900,\n    "quotaInBytes": 417913685250,\n    "quotaInNamespace": 100000000,\n    "usedNamespace": 1,\n    "acls": [\n      {\n        "type": "USER",\n        "name": "om",\n        "aclScope": "ACCESS"\n      }\n    ],\n    "refCount": 0\n  }\n }\n'})}),"\n",(0,i.jsx)(n.p,{children:"Using multiple filters:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ozone debug ldb --db=/path/to/om.db scan --cf=volumeTable --filter="usedNamespace:equals:2,volume:regex:^.*4$"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "/vol4": {\n    "metadata": {},\n    "objectID": -888,\n    "updateID": 5000,\n    "adminName": "om",\n    "ownerName": "om",\n    "volume": "vol4",\n    "creationTime": 1696280979907,\n    "modificationTime": 1696280979907,\n    "quotaInBytes": 2251799813685250,\n    "quotaInNamespace": 100000000,\n    "usedNamespace": 2,\n    "acls": [\n      {\n        "type": "USER",\n        "name": "om",\n        "aclScope": "ACCESS"\n      }\n    ],\n    "refCount": 0\n  }\n }\n'})}),"\n",(0,i.jsx)(n.h2,{id:"value-schema-command",children:"value-schema command"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"value-schema"})," command shows the schema of the value stored in a column-family of a RocksDB, i.e., it shows the fields stored in the value and it's datatype.\n",(0,i.jsx)(n.code,{children:"--depth"})," can be used optionally to limit the level until which the fields are fetched."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone debug ldb --db=/data/metadata/om.db value-schema --cf=keyTable --depth=1\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "OmKeyInfo" : {\n    "bucketName" : "String", \n    "metadata" : "struct", \n    "fileName" : "String", \n    "creationTime" : "long",\n    "isFile" : "boolean", \n    "acls" : "struct", \n    "keyName" : "String",\n    "replicationConfig" : "struct", \n    "encInfo" : "struct", \n    "dataSize" : "long", \n    "tags" : "struct", \n    "keyLocationVersions" : "struct", \n    "updateID" : "long", \n    "ownerName" : "String", \n    "modificationTime" : "long", \n    "parentObjectID" : "long", \n    "volumeName" : "String", \n    "fileChecksum" : "struct", \n    "objectID" : "long"\n}\n }\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone debug ldb --db=/data/metadata/om.db value-schema --cf=keyTable\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "OmKeyInfo" : {\n    "bucketName" : "String",\n    "metadata" : { },\n    "fileName" : "String",\n    "creationTime" : "long",\n    "isFile" : "boolean",\n    "acls" : {\n      "toStringMethod" : { },\n      "hashCodeMethod" : { },\n      "name" : "String",\n      "type" : {\n        "name" : "String",\n        "value" : "String",\n        "ordinal" : "int"\n      },\n      "aclScope" : {\n        "name" : "String",\n        "ordinal" : "int"\n      },\n      "aclBits" : "int"\n    },\n    "keyName" : "String",\n    "replicationConfig" : { },\n    "encInfo" : {\n      "ezKeyVersionName" : "String",\n      "keyName" : "String",\n      "edek" : { },\n      "cipherSuite" : {\n        "unknownValue" : {\n          "value" : "int"\n        },\n        "name" : "String",\n        "algoBlockSize" : "int",\n        "ordinal" : "int"\n      },\n      "version" : {\n        "unknownValue" : {\n          "value" : "int"\n        },\n        "name" : "String",\n        "description" : "String",\n        "version" : "int",\n        "ordinal" : "int"\n      },\n      "iv" : { }\n    },\n    "dataSize" : "long",\n    "tags" : { },\n    "keyLocationVersions" : {\n      "isMultipartKey" : "boolean",\n      "locationVersionMap" : { },\n      "version" : "long"\n    },\n    "updateID" : "long",\n    "ownerName" : "String",\n    "modificationTime" : "long",\n    "parentObjectID" : "long",\n    "volumeName" : "String",\n    "fileChecksum" : { },\n    "objectID" : "long"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"checkpoint-command",children:"checkpoint command"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"checkpoint"})," command takes a checkpoint of a RocksDB, at a provided path."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone debug ldb --db=/data/metadata/om.db checkpoint --output=/tmp/om-checkpoint\n"})})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}}}]);