"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[8127],{53497:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"developer-guide/run/docker-compose","title":"Running Ozone From Docker Compose","description":"This guide walks you through the process of building Apache Ozone from source and running it using Docker Compose. This approach is particularly useful for development, testing, and understanding Ozone\'s architecture.","source":"@site/docs/08-developer-guide/02-run/02-docker-compose.md","sourceDirName":"08-developer-guide/02-run","slug":"/developer-guide/run/docker-compose","permalink":"/docs/developer-guide/run/docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/08-developer-guide/02-run/02-docker-compose.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Docker Compose"},"sidebar":"defaultSidebar","previous":{"title":"Intellij","permalink":"/docs/developer-guide/run/intellij"},"next":{"title":"Kubernetes","permalink":"/docs/developer-guide/run/kubernetes"}}');var s=r(86070),t=r(62392);r(56281),r(81556);const a={sidebar_label:"Docker Compose"},i="Running Ozone From Docker Compose",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Building and Deploying Ozone",id:"building-and-deploying-ozone",level:2},{value:"Step 1: Build from Source",id:"step-1-build-from-source",level:3},{value:"Step 2: Locate Docker Compose Files",id:"step-2-locate-docker-compose-files",level:3},{value:"Step 3: Configure Your Deployment (Optional)",id:"step-3-configure-your-deployment-optional",level:3},{value:"Step 4: Launch the Cluster",id:"step-4-launch-the-cluster",level:3},{value:"Container Diagram",id:"container-diagram",level:2},{value:"Cluster Components",id:"cluster-components",level:2},{value:"Core Services",id:"core-services",level:3},{value:"Cluster Management",id:"cluster-management",level:2},{value:"Essential Commands",id:"essential-commands",level:3},{value:"CLI Access",id:"cli-access",level:3},{value:"Advanced Configurations",id:"advanced-configurations",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"running-ozone-from-docker-compose",children:"Running Ozone From Docker Compose"})}),"\n","\n",(0,s.jsx)(n.p,{children:"This guide walks you through the process of building Apache Ozone from source and running it using Docker Compose. This approach is particularly useful for development, testing, and understanding Ozone's architecture."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Before you begin, ensure you have installed:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"Docker Engine"})," - Latest stable version"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"})," - Latest stable version"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"building-and-deploying-ozone",children:"Building and Deploying Ozone"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-build-from-source",children:"Step 1: Build from Source"}),"\n",(0,s.jsxs)(n.p,{children:["First, build Ozone from source following our ",(0,s.jsx)(n.a,{href:"/docs/developer-guide/build/maven",children:"Build with Maven"})," guide."]}),"\n",(0,s.jsx)(n.h3,{id:"step-2-locate-docker-compose-files",children:"Step 2: Locate Docker Compose Files"}),"\n",(0,s.jsx)(n.p,{children:"Navigate to the compose directory in your build output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd ./hadoop-ozone/dist/target/ozone-<VERSION>/compose/ozone\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-configure-your-deployment-optional",children:"Step 3: Configure Your Deployment (Optional)"}),"\n",(0,s.jsxs)(n.p,{children:["You can customize your Ozone deployment by modifying the configuration parameters in the ",(0,s.jsx)(n.code,{children:"docker-compose.yaml"})," file:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Common Configurations"}),": Located under the ",(0,s.jsx)(n.code,{children:"x-common-config"})," section"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service-Specific Settings"}),": Found under the ",(0,s.jsx)(n.code,{children:"environment"})," section of individual services"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example configuration modification:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Example configuration modifications\nx-common-config:\n  environment:\n    OZONE-SITE.XML_ozone.scm.container.size: 1GB\n    OZONE-SITE.XML_ozone.scm.block.size: 256MB\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-4-launch-the-cluster",children:"Step 4: Launch the Cluster"}),"\n",(0,s.jsx)(n.p,{children:"Start your Ozone cluster:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose up -d --scale datanode=3\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This command creates a fully functional Apache Ozone cluster using the ",(0,s.jsx)(n.code,{children:"ozone-docker-runner"})," base image, which mounts your locally compiled Ozone binaries."]}),"\n",(0,s.jsx)(n.h2,{id:"container-diagram",children:"Container Diagram"}),"\n",(0,s.jsxs)(n.p,{children:["This image shows the containers that will be created by the ",(0,s.jsx)(n.code,{children:"docker compose up -d"})," command when running the default Docker Compose configuration under ",(0,s.jsx)(n.code,{children:"/compose/ozone"})," ."]}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Apache Ozone Containers"\n        scm["SCM<br/>Storage Container Manager<br/>(Port: 9876, 9860)"]\n        om["OM<br/>Ozone Manager<br/>(Port: 9874, 9862)"]\n        s3g["S3G<br/>S3 Gateway<br/>(Port: 9878)"]\n        recon["Recon<br/>Monitoring Service<br/>(Port: 9888)"]\n        httpfs["HttpFS<br/>HTTP FileSystem<br/>(Port: 14000)"]\n        \n        subgraph "Data Nodes"\n            dn1["DataNode 1<br/>(Port: 19864, 9882)"]\n            dnN["DataNode N<br/>(Port: 19864, 9882)"]\n        end\n        \n        %% Connections\n        scm --\x3e dn1\n        scm --\x3e dnN\n        om --\x3e dn1\n        om --\x3e dnN\n        s3g --\x3e om\n        s3g --\x3e scm\n        httpfs --\x3e om\n        httpfs --\x3e scm\n        recon --\x3e scm\n        recon --\x3e om\n    end\n\n    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;\n    classDef datanode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px;\n    classDef manager fill:#e8f5e9,stroke:#388e3c,stroke-width:2px;\n    \n    class dn1,dnN datanode;\n    class scm,om manager;'}),"\n",(0,s.jsx)(n.h2,{id:"cluster-components",children:"Cluster Components"}),"\n",(0,s.jsx)(n.h3,{id:"core-services",children:"Core Services"}),"\n",(0,s.jsx)(n.p,{children:"Your Ozone cluster includes the following components:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage Container Manager (SCM)"}),": Manages storage containers and block allocation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Ozone Manager (OM)"}),": Handles namespace operations and metadata management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"S3 Gateway"}),": Provides S3-compatible API access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Recon"}),": Monitoring and management service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Datanodes"}),": Distributed storage nodes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HttpFS"}),": HTTP-based filesystem interface"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"cluster-management",children:"Cluster Management"}),"\n",(0,s.jsx)(n.h3,{id:"essential-commands",children:"Essential Commands"}),"\n",(0,s.jsx)(n.p,{children:"Here are the key commands for managing your Ozone cluster:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Start the cluster\ndocker compose up -d\n\n# Stop and remove all containers\ndocker compose down\n\n# Monitor service logs\ndocker compose logs -f [service_name]\n\n# Scale the number of datanodes\ndocker compose up -d --scale datanode=3\n\n# Check cluster status\ndocker compose ps\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cli-access",children:"CLI Access"}),"\n",(0,s.jsx)(n.p,{children:"Access the Ozone command-line interface from any Ozone container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Enter the Ozone Manager container or any other container\ndocker compose exec om bash\n\n# Run Ozone commands\nozone\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-configurations",children:"Advanced Configurations"}),"\n",(0,s.jsx)(n.p,{children:"The compose directory includes several specialized configurations for different use cases:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Configuration"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ozone-ha"}),(0,s.jsx)(n.td,{children:"High availability deployment setup"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ozonesecure"}),(0,s.jsx)(n.td,{children:"Security features with SSL and Kerberos"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ozone-topology"}),(0,s.jsx)(n.td,{children:"Rack-aware deployment configuration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"upgrade"}),(0,s.jsx)(n.td,{children:"Non-rolling upgrade testing environment"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"To explore these configurations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd hadoop-ozone/dist/target/ozone-*-SNAPSHOT/compose/\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsx)(n.p,{children:"After setting up your development cluster:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Explore the ",(0,s.jsx)(n.a,{href:"/docs/user-guide/clients/ozone",children:"Ozone CLI documentation"})]}),"\n",(0,s.jsx)(n.li,{children:"Experiment with the various compose configurations for specific use cases"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},56281:(e,n,r)=>{r.d(n,{A:()=>k});var o=r(30758),s=r(13526),t=r(59226),a=r(25557),i=r(26703),l=r(95535),c=r(38196),d=r(25392);function u(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:r}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:o,default:s}}=e;return{value:n,label:r,attributes:o,default:s}}))}(r);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function p(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const s=(0,a.W6)(),t=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,l.aZ)(t),(0,o.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function g(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,t=h(e),[a,l]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=r.find((e=>e.default))??r[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:t}))),[c,u]=m({queryString:r,groupId:s}),[g,f]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,t]=(0,d.Dv)(r);return[s,(0,o.useCallback)((e=>{r&&t.set(e)}),[r,t])]}({groupId:s}),x=(()=>{const e=c??g;return p({value:e,tabValues:t})?e:null})();(0,i.A)((()=>{x&&l(x)}),[x]);return{selectedValue:a,selectValue:(0,o.useCallback)((e=>{if(!p({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),f(e)}),[u,f,t]),tabValues:t}}var f=r(19309);const x={tabList:"tabList_fNUd",tabItem:"tabItem_d6dp"};var b=r(86070);function v(e){let{className:n,block:r,selectedValue:o,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const n=e.currentTarget,r=l.indexOf(n),s=i[r].value;s!==o&&(c(n),a(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:i.map((e=>{let{value:n,label:r,attributes:t}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...t,className:(0,s.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":o===n}),children:r??n},n)}))})}function j(e){let{lazy:n,children:r,selectedValue:t}=e;const a=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===t));return e?(0,o.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function y(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,b.jsx)(v,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function k(e){const n=(0,f.A)();return(0,b.jsx)(y,{...e,children:u(e.children)},String(n))}},62392:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>i});var o=r(30758);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}},81556:(e,n,r)=>{r.d(n,{A:()=>a});r(30758);var o=r(13526);const s={tabItem:"tabItem_dCa7"};var t=r(86070);function a(e){let{children:n,hidden:r,className:a}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,o.A)(s.tabItem,a),hidden:r,children:n})}}}]);