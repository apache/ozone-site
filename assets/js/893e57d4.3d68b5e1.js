"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[7386],{50996:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"administrator-guide/configuration/performance/rocksdb","title":"RocksDB in Apache Ozone","description":"This page covers advanced topics. Ozone administration normally does not require changing these settings.","source":"@site/versioned_docs/version-2.1.0/05-administrator-guide/02-configuration/04-performance/04-rocksdb.md","sourceDirName":"05-administrator-guide/02-configuration/04-performance","slug":"/administrator-guide/configuration/performance/rocksdb","permalink":"/docs/administrator-guide/configuration/performance/rocksdb","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/master/versioned_docs/version-2.1.0/05-administrator-guide/02-configuration/04-performance/04-rocksdb.md","tags":[],"version":"2.1.0","sidebarPosition":4,"frontMatter":{"sidebar_label":"RocksDB In Apache Ozone"},"sidebar":"defaultSidebar","previous":{"title":"Multi-Raft","permalink":"/docs/administrator-guide/configuration/performance/multi-raft"},"next":{"title":"Streaming Write Pipeline","permalink":"/docs/administrator-guide/configuration/performance/streaming-write-pipeline"}}');var t=n(86070),o=n(62392);const r={sidebar_label:"RocksDB In Apache Ozone"},d="RocksDB in Apache Ozone",c={},l=[{value:"1. Introduction to RocksDB",id:"1-introduction-to-rocksdb",level:2},{value:"2. How Ozone uses RocksDB",id:"2-how-ozone-uses-rocksdb",level:2},{value:"3. Tunings applicable to RocksDB",id:"3-tunings-applicable-to-rocksdb",level:2},{value:"General Settings",id:"general-settings",level:3},{value:"Ozone Manager (OM) Specific Settings",id:"ozone-manager-om-specific-settings",level:3},{value:"Datanode-Specific Settings",id:"datanode-specific-settings",level:3},{value:"4. Troubleshooting and repair tools relevant to RocksDB",id:"4-troubleshooting-and-repair-tools-relevant-to-rocksdb",level:2},{value:"5. Version compatibility",id:"5-version-compatibility",level:2},{value:"6. Monitoring and Metrics",id:"6-monitoring-and-metrics",level:2},{value:"7. Storage Sizing",id:"7-storage-sizing",level:2}];function a(e){const s={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"rocksdb-in-apache-ozone",children:"RocksDB in Apache Ozone"})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["This page covers advanced topics. Ozone administration normally does ",(0,t.jsx)(s.strong,{children:"not"})," require changing these settings."]})}),"\n",(0,t.jsx)(s.p,{children:"RocksDB is a critical component of Apache Ozone, providing a high-performance embedded key-value store. It is used by various Ozone services to persist metadata and state."}),"\n",(0,t.jsx)(s.h2,{id:"1-introduction-to-rocksdb",children:"1. Introduction to RocksDB"}),"\n",(0,t.jsxs)(s.p,{children:["RocksDB is a log-structured merge-tree (LSM-tree) based key-value store created by Facebook. It is optimized for fast storage environments like SSDs and offers high write throughput and efficient point lookups.",(0,t.jsx)(s.br,{}),"\n","See the ",(0,t.jsx)(s.a,{href:"https://github.com/facebook/rocksdb",children:"RocksDB GitHub project"})," and the ",(0,t.jsx)(s.a,{href:"https://github.com/facebook/rocksdb/wiki",children:"RocksDB Wiki"})," for more details."]}),"\n",(0,t.jsx)(s.h2,{id:"2-how-ozone-uses-rocksdb",children:"2. How Ozone uses RocksDB"}),"\n",(0,t.jsx)(s.p,{children:"RocksDB is utilized in the following Ozone components to store critical metadata:"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Ozone Manager (OM):"})," The OM uses RocksDB as its primary metadata store, holding the entire namespace and related information. As defined in ",(0,t.jsx)(s.code,{children:"OMDBDefinition.java"}),", this includes tables for:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Namespace:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Object Store Layout:"})," ",(0,t.jsx)(s.code,{children:"volumeTable"}),", ",(0,t.jsx)(s.code,{children:"bucketTable"}),", ",(0,t.jsx)(s.code,{children:"keyTable"})," (for object store layout), ",(0,t.jsx)(s.code,{children:"openKeyTable"})," (for tracking open keys during multipart uploads), and ",(0,t.jsx)(s.code,{children:"multipartInfoTable"})," (for storing multipart upload information)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"File System Layout:"})," ",(0,t.jsx)(s.code,{children:"directoryTable"})," and ",(0,t.jsx)(s.code,{children:"fileTable"})," (for file system layout), ",(0,t.jsx)(s.code,{children:"openFileTable"})," (for tracking open files), and ",(0,t.jsx)(s.code,{children:"deletedDirectoryTable"})," (for tracking deleted directories)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Access Control:"})," ",(0,t.jsx)(s.code,{children:"prefixTable"})," (for storing prefix-based access control information)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Security:"})," ",(0,t.jsx)(s.code,{children:"userTable"}),", ",(0,t.jsx)(s.code,{children:"dTokenTable"})," (delegation tokens), and ",(0,t.jsx)(s.code,{children:"s3SecretTable"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"S3 Multi-Tenancy:"})," ",(0,t.jsx)(s.code,{children:"tenantStateTable"})," (for storing tenant state information), ",(0,t.jsx)(s.code,{children:"tenantAccessIdTable"})," (for storing access ID information), and ",(0,t.jsx)(s.code,{children:"principalToAccessIdsTable"})," (for mapping user principals to access IDs)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"State Management:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"transactionInfoTable"})," for tracking transactions."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"metaTable"})," for storing miscellaneous metadata key-value pairs."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"deletedTable"})," for pending key deletions."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Snapshots:"})," ",(0,t.jsx)(s.code,{children:"snapshotInfoTable"})," for managing Ozone snapshots, ",(0,t.jsx)(s.code,{children:"snapshotRenamedTable"})," (for tracking renamed objects between snapshots), and ",(0,t.jsx)(s.code,{children:"compactionLogTable"})," (for storing compaction log entries)."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Storage Container Manager (SCM):"})," The SCM persists the state of the storage layer in RocksDB. The structure, defined in ",(0,t.jsx)(s.code,{children:"SCMDBDefinition.java"}),", includes tables for:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"pipelines"}),": Manages the state and composition of data pipelines."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"containers"}),": Stores information about all storage containers in the cluster."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"deletedBlocks"}),": Tracks blocks that are marked for deletion and awaiting garbage collection."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"move"}),": Coordinates container movements for data rebalancing."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"validCerts"}),": Stores certificates for validating Datanodes."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"validSCMCerts"}),": Stores certificates for validating SCMs."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"scmTransactionInfos"}),": Tracks SCM transactions."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"sequenceId"}),": Manages sequence IDs for various SCM operations."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"meta"}),": Stores miscellaneous SCM metadata, including upgrade finalization status and metadata layout version."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"statefulServiceConfig"}),": Stores configurations for stateful services."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Datanode:"})," A Datanode utilizes RocksDB for two main purposes:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Per-Volume Metadata:"})," It maintains one RocksDB instance per storage volume. Each of these instances manages metadata for the containers and blocks stored on that specific volume. As specified in ",(0,t.jsx)(s.code,{children:"DatanodeSchemaThreeDBDefinition.java"}),", this database is structured with column families for ",(0,t.jsx)(s.code,{children:"block_data"}),", ",(0,t.jsx)(s.code,{children:"metadata"}),", ",(0,t.jsx)(s.code,{children:"delete_txns"}),", ",(0,t.jsx)(s.code,{children:"finalize_blocks"}),", and ",(0,t.jsx)(s.code,{children:"last_chunk_info"}),". To optimize performance, it uses a fixed-length prefix based on the container ID, enabling efficient lookups with RocksDB's prefix seek feature."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Global Container Tracking:"})," Additionally, each Datanode has a single, separate RocksDB instance to record the set of all containers it manages. This database, defined in ",(0,t.jsx)(s.code,{children:"WitnessedContainerDBDefinition.java"}),", contains a ",(0,t.jsx)(s.code,{children:"ContainerCreateInfoTable"})," table that provides a complete index of the containers hosted on that Datanode."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Recon:"})," Ozone's administration and monitoring tool, Recon, maintains its own RocksDB database to store aggregated and historical data for analysis. The ",(0,t.jsx)(s.code,{children:"ReconDBDefinition.java"})," outlines tables for:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"containerKeyTable"}),": Maps containers to the keys they contain."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"namespaceSummaryTable"}),": Stores aggregated namespace information for quick reporting."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"replica_history"}),": Tracks the historical locations of container replicas, which is essential for auditing and diagnostics."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"keyContainerTable"}),": Maps keys to the containers they are in."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"containerKeyCountTable"}),": Stores the number of keys in each container."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"replica_history_v2"}),": Tracks the historical locations of container replicas with BCSID, which is essential for auditing and diagnostics."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"fileCountBySizeTable"}),": Stores file count statistics grouped by size ranges."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"globalStatsTable"}),": Stores global statistics for the Recon service."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"3-tunings-applicable-to-rocksdb",children:"3. Tunings applicable to RocksDB"}),"\n",(0,t.jsxs)(s.p,{children:["Effective tuning of RocksDB can significantly impact Ozone's performance. Ozone exposes several configuration properties to tune RocksDB behavior. These properties are typically found in ",(0,t.jsx)(s.code,{children:"ozone-default.xml"})," and can be overridden in ",(0,t.jsx)(s.code,{children:"ozone-site.xml"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"general-settings",children:"General Settings"}),"\n",(0,t.jsxs)(s.p,{children:["Ozone provides a set of general RocksDB configurations that apply to all services (OM, SCM, and Datanodes) unless overridden by more specific settings. With the exception of ",(0,t.jsx)(s.code,{children:"hdds.db.profile"})," and ",(0,t.jsx)(s.code,{children:"ozone.metastore.rocksdb.cf.write.buffer.size"}),", these properties are defined in ",(0,t.jsx)(s.code,{children:"RocksDBConfiguration.java"}),"."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.db.profile"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"DISK"})}),(0,t.jsxs)(s.td,{children:["Specifies the RocksDB profile to use, which determines the default DBOptions and ColumnFamilyOptions. Possible values include ",(0,t.jsx)(s.code,{children:"SSD"})," and ",(0,t.jsx)(s.code,{children:"DISK"}),". For example, setting this to ",(0,t.jsx)(s.code,{children:"SSD"})," will apply tunings optimized for SSD storage."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.metastore.rocksdb.statistics"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"OFF"})}),(0,t.jsxs)(s.td,{children:["The statistics level of the RocksDB store. If set to any value from ",(0,t.jsx)(s.code,{children:"org.rocksdb.StatsLevel"})," (e.g., ALL or EXCEPT_DETAILED_TIMERS), RocksDB statistics will be exposed over JMX. Set to OFF to disable statistics collection. Note: collecting statistics can have a 5\u201310% performance penalty."]})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Write Options:"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.writeoption.sync"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"false"})}),(0,t.jsxs)(s.td,{children:["If set to ",(0,t.jsx)(s.code,{children:"true"}),", writes are synchronized to persistent storage, ensuring durability at the cost of performance. If ",(0,t.jsx)(s.code,{children:"false"}),", writes are flushed asynchronously."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.metastore.rocksdb.cf.write.buffer.size"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"128MB"})}),(0,t.jsx)(s.td,{children:"The write buffer (memtable) size for each column family of the RocksDB store."})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Write-Ahead Log (WAL) Management:"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.WAL_ttl_seconds"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1200"})}),(0,t.jsx)(s.td,{children:"The time-to-live for WAL files in seconds."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.WAL_size_limit_MB"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"0"})}),(0,t.jsxs)(s.td,{children:["The total size limit for WAL files in megabytes. When this limit is exceeded, the oldest WAL files are deleted. A value of ",(0,t.jsx)(s.code,{children:"0"})," means no limit."]})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Logging:"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.logging.enabled"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"false"})}),(0,t.jsx)(s.td,{children:"Enables or disables RocksDB's own logging."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.logging.level"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"INFO"})}),(0,t.jsx)(s.td,{children:"The logging level for RocksDB (INFO, DEBUG, WARN, ERROR, FATAL)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.max.log.file.size"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"100MB"})}),(0,t.jsx)(s.td,{children:"The maximum size of a single RocksDB log file."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.hdds.db.rocksdb.keep.log.file.num"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"10"})}),(0,t.jsx)(s.td,{children:"The maximum number of RocksDB log files to retain."})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"ozone-manager-om-specific-settings",children:"Ozone Manager (OM) Specific Settings"}),"\n",(0,t.jsxs)(s.p,{children:["These settings, defined in ",(0,t.jsx)(s.code,{children:"ozone-default.xml"}),", apply specifically to the Ozone Manager."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.om.db.max.open.files"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-1"})," (unlimited)"]}),(0,t.jsx)(s.td,{children:"The total number of files that a RocksDB can open in the OM."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.om.compaction.service.enabled"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"false"})}),(0,t.jsx)(s.td,{children:"Enable or disable a background job that periodically compacts RocksDB tables flagged for compaction."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.om.compaction.service.run.interval"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"6h"})}),(0,t.jsx)(s.td,{children:"The interval for the OM's compaction service."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.om.compaction.service.timeout"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"10m"})}),(0,t.jsx)(s.td,{children:"Timeout for the OM's compaction service."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ozone.om.compaction.service.columnfamilies"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"keyTable"}),(0,t.jsx)("br",{}),(0,t.jsx)(s.code,{children:"fileTable"}),(0,t.jsx)("br",{}),(0,t.jsx)(s.code,{children:"directoryTable"}),(0,t.jsx)("br",{}),(0,t.jsx)(s.code,{children:"deletedTable"}),(0,t.jsx)("br",{}),(0,t.jsx)(s.code,{children:"deletedDirectoryTable"}),(0,t.jsx)("br",{}),(0,t.jsx)(s.code,{children:"multipartInfoTable"})]}),(0,t.jsx)(s.td,{children:"A comma-separated list of column families to be compacted by the service."})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"datanode-specific-settings",children:"Datanode-Specific Settings"}),"\n",(0,t.jsxs)(s.p,{children:["These settings, defined in ",(0,t.jsx)(s.code,{children:"DatanodeConfiguration.java"}),", apply specifically to Datanodes and will override the general settings where applicable."]}),"\n",(0,t.jsx)(s.p,{children:"Key tuning parameters for the Datanode often involve:"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Memory usage:"})," Configuring block cache, write buffer manager, and other memory-related settings."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.metadata.rocksdb.cache.size"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1GB"})}),(0,t.jsx)(s.td,{children:"Configures the block cache size for RocksDB instances on Datanodes."})]})})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Compaction strategies:"})," Optimizing how data is merged and organized on disk."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.auto-compaction-small-sst-file"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"true"})}),(0,t.jsx)(s.td,{children:"Enables or disables auto-compaction for small SST files."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.auto-compaction-small-sst-file-size-threshold"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1MB"})}),(0,t.jsx)(s.td,{children:"Threshold for small SST file size for auto-compaction."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.auto-compaction-small-sst-file-num-threshold"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"512"})}),(0,t.jsx)(s.td,{children:"Threshold for the number of small SST files for auto-compaction."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.auto-compaction-small-sst-file.interval.minutes"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"120"})}),(0,t.jsx)(s.td,{children:"Auto compact small SST files interval in minutes."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.auto-compaction-small-sst-file.threads"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1"})}),(0,t.jsx)(s.td,{children:"Auto compact small SST files threads."})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Write-ahead log (WAL) settings:"})," Balancing durability and write performance."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.log.max-file-size"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"32MB"})}),(0,t.jsxs)(s.td,{children:["The max size of each user log file of RocksDB. ",(0,t.jsx)(s.code,{children:"0"})," means no size limit."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.log.max-file-num"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"64"})}),(0,t.jsx)(s.td,{children:"The max user log file number to keep for each RocksDB."})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Logging:"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.log.level"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"INFO"})}),(0,t.jsx)(s.td,{children:"The user log level of RocksDB(DEBUG/INFO/WARN/ERROR/FATAL))."})]})})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Other Settings:"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.db.config.path"})}),(0,t.jsx)(s.td,{children:"empty (not configured)"}),(0,t.jsx)(s.td,{children:"Path to an INI configuration file for advanced RocksDB tuning on Datanodes."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.container.schema.v3.enabled"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"true"})}),(0,t.jsx)(s.td,{children:"Enable container schema v3 (one RocksDB per disk)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.container.schema.v3.key.separator"})}),(0,t.jsx)(s.td,{children:"|"}),(0,t.jsx)(s.td,{children:"The separator between Container ID and container meta key name in schema v3."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.delete-obsolete-files-period"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1h"})}),(0,t.jsx)(s.td,{children:"Periodicity when obsolete files get deleted."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hdds.datanode.rocksdb.max-open-files"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"1024"})}),(0,t.jsx)(s.td,{children:"The total number of files that a RocksDB can open."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"4-troubleshooting-and-repair-tools-relevant-to-rocksdb",children:"4. Troubleshooting and repair tools relevant to RocksDB"}),"\n",(0,t.jsx)(s.p,{children:"Troubleshooting RocksDB issues in Ozone often involves:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Analyzing RocksDB logs for errors and warnings."}),"\n",(0,t.jsxs)(s.li,{children:["Using RocksDB's built-in tools for inspecting database files:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/facebook/rocksdb/wiki/Administration-and-Data-Access-Tool#ldb-tool",children:"ldb"}),": A command-line tool for inspecting and manipulating the contents of a RocksDB database."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/facebook/rocksdb/wiki/Administration-and-Data-Access-Tool#sst-dump-tool",children:"sst_dump"}),": A command-line tool for inspecting the contents of SST (Static Table) files, which are the files that store the data in RocksDB."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Understanding common RocksDB error codes and their implications."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"5-version-compatibility",children:"5. Version compatibility"}),"\n",(0,t.jsxs)(s.p,{children:["Ozone 2.2.0 uses RocksDB ",(0,t.jsx)(s.strong,{children:"7.7.3"}),". It is recommended to use RocksDB tools of this version to ensure compatibility and avoid any potential issues."]}),"\n",(0,t.jsx)(s.h2,{id:"6-monitoring-and-metrics",children:"6. Monitoring and Metrics"}),"\n",(0,t.jsx)(s.p,{children:"Monitoring RocksDB performance is crucial for maintaining a healthy Ozone cluster."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"RocksDB Statistics:"})," Ozone can expose detailed RocksDB statistics. Enable this by setting ",(0,t.jsx)(s.code,{children:"ozone.metastore.rocksdb.statistics"})," to ",(0,t.jsx)(s.code,{children:"ALL"})," or ",(0,t.jsx)(s.code,{children:"EXCEPT_DETAILED_TIMERS"})," in ",(0,t.jsx)(s.code,{children:"ozone-site.xml"}),". Be aware that enabling detailed statistics can incur a performance penalty (5-10%)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Grafana Dashboards:"})," Ozone provides Grafana dashboards that visualize low-level RocksDB statistics. Refer to the ",(0,t.jsx)(s.a,{href:"../../operations/observability/",children:"Ozone Monitoring Documentation"})," for details on setting up monitoring and using these dashboards."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"7-storage-sizing",children:"7. Storage Sizing"}),"\n",(0,t.jsx)(s.p,{children:"Properly sizing the storage for RocksDB instances is essential to prevent performance bottlenecks and out-of-disk errors. The requirements vary significantly for each Ozone component, and using dedicated, fast storage (SSDs) is highly recommended."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Ozone Manager (OM):"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Baseline:"})," A minimum of ",(0,t.jsx)(s.strong,{children:"100 GB"})," should be reserved for the OM's RocksDB instance. The OM stores the entire namespace metadata (volumes, buckets, keys), so this is the most critical database in the cluster."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"With Snapshots:"})," Enabling Ozone Snapshots will substantially increase storage needs. Each snapshot preserves a view of the metadata, and the underlying data files (SSTs) cannot be deleted by compaction until a snapshot is removed. The exact requirement depends on the number of retained snapshots and the rate of change (creations/deletions) in the namespace. Monitor disk usage closely after enabling snapshots. For more details, refer to the ",(0,t.jsx)(s.a,{href:"../../operations/snapshots/",children:"Ozone Snapshot Documentation"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Storage Container Manager (SCM):"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["SCM's metadata footprint (pipelines, containers, Datanode heartbeats) is much smaller than the OM's. A baseline of ",(0,t.jsx)(s.strong,{children:"20-50 GB"})," is typically sufficient for its RocksDB instance."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Datanode:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"The Datanode's RocksDB stores metadata for all containers and their blocks. Its size grows proportionally with the number of containers and blocks hosted on that Datanode."}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Rule of Thumb:"})," A good starting point is to reserve ",(0,t.jsx)(s.strong,{children:"0.1% to 0.5%"})," of the total data disk capacity for RocksDB metadata. For example, a Datanode with 100 TB of data disks should reserve between 100 GB and 500 GB for its RocksDB metadata."]}),"\n",(0,t.jsx)(s.li,{children:"Workloads with many small files will result in a higher block count and will require space on the higher end of this range."}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},62392:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>d});var i=n(30758);const t={},o=i.createContext(t);function r(e){const s=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);