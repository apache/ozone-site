"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[7958],{10674:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"system-internals/security/kerberos","title":"How Ozone Uses Kerberos","description":"Tokens","source":"@site/docs/07-system-internals/05-security/01-kerberos.md","sourceDirName":"07-system-internals/05-security","slug":"/system-internals/security/kerberos","permalink":"/docs/system-internals/security/kerberos","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/07-system-internals/05-security/01-kerberos.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Kerberos"},"sidebar":"defaultSidebar","previous":{"title":"Security","permalink":"/docs/system-internals/security/"},"next":{"title":"Symmetric Encryption","permalink":"/docs/system-internals/security/symmetric-encryption"}}');var r=s(86070),o=s(62392);const a={sidebar_label:"Kerberos"},i="How Ozone Uses Kerberos",d={},c=[{value:"Tokens",id:"tokens",level:2},{value:"Delegation Token",id:"delegation-token",level:3},{value:"Block Token",id:"block-token",level:3},{value:"S3AuthInfo",id:"s3authinfo",level:3},{value:"Securing Datanodes",id:"securing-datanodes",level:2},{value:"How a Datanode becomes secure",id:"how-a-datanode-becomes-secure",level:3},{value:"Certificate Approval via Kerberos",id:"certificate-approval-via-kerberos",level:4},{value:"Manual Approval",id:"manual-approval",level:4},{value:"Automatic Approval",id:"automatic-approval",level:4}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"how-ozone-uses-kerberos",children:"How Ozone Uses Kerberos"})}),"\n",(0,r.jsx)(t.h2,{id:"tokens",children:"Tokens"}),"\n",(0,r.jsx)(t.p,{children:"Ozone uses a notion of tokens to avoid overburdening the Kerberos server. When you serve thousands of requests per second, involving Kerberos might not work well. Hence once an authentication is done, Ozone issues delegation tokens and block tokens to the clients. These tokens allow applications to do specified operations against the cluster, as if they have kerberos tickets with them. Ozone supports following kinds of tokens."}),"\n",(0,r.jsx)(t.h3,{id:"delegation-token",children:"Delegation Token"}),"\n",(0,r.jsx)(t.p,{children:"Delegation tokens allow an application to impersonate a users kerberos credentials. This token is based on verification of kerberos identity and is issued by the Ozone Manager. Delegation tokens are enabled by default when security is enabled."}),"\n",(0,r.jsx)(t.h3,{id:"block-token",children:"Block Token"}),"\n",(0,r.jsx)(t.p,{children:"Block tokens allow a client to read or write a block. This is needed so that Datanodes know that the user/client has permission to read or make modifications to the block."}),"\n",(0,r.jsx)(t.h3,{id:"s3authinfo",children:"S3AuthInfo"}),"\n",(0,r.jsx)(t.p,{children:"S3 uses a very different shared secret security scheme. Ozone supports the AWS Signature Version 4 protocol, and from the end users perspective Ozone's S3 feels exactly like AWS S3."}),"\n",(0,r.jsx)(t.p,{children:"The S3 credential tokens are called S3 auth info in the code. These tokens are also enabled by default when security is enabled."}),"\n",(0,r.jsxs)(t.p,{children:["Each of the service daemons that make up Ozone needs a Kerberos service principal name and a corresponding ",(0,r.jsx)(t.a,{href:"https://web.mit.edu/kerberos/krb5-latest/doc/basic/keytab_def.html",children:"kerberos key tab"})," file."]}),"\n",(0,r.jsxs)(t.p,{children:["All these settings should be made in ",(0,r.jsx)(t.code,{children:"ozone-site.xml"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"securing-datanodes",children:"Securing Datanodes"}),"\n",(0,r.jsx)(t.p,{children:"Datanodes under Hadoop is traditionally secured by creating a Keytab file on the Datanodes. With Ozone, we have moved away to using Datanode certificates. That is, Kerberos on Datanodes is not needed in case of a secure Ozone cluster."}),"\n",(0,r.jsxs)(t.p,{children:["However, we support the legacy Kerberos based Authentication to make it easy for the current set of users. The HDFS configuration keys are the following that is setup in ",(0,r.jsx)(t.code,{children:"hdfs-site.xml"}),"."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Property"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"dfs.datanode.kerberos.principal"})}),(0,r.jsxs)(t.td,{children:["The Datanode service principal. e.g. ",(0,r.jsx)(t.code,{children:"dn/_HOST@REALM.COM"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"dfs.datanode.kerberos.keytab.file"})}),(0,r.jsx)(t.td,{children:"The keytab file used by Datanode daemon to login as its service principal."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"hdds.datanode.http.auth.kerberos.principal"})}),(0,r.jsx)(t.td,{children:"Datanode HTTP server service principal."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"hdds.datanode.http.auth.kerberos.keytab"})}),(0,r.jsx)(t.td,{children:"The keytab file used by Datanode HTTP server to login as its service principal."})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"how-a-datanode-becomes-secure",children:"How a Datanode becomes secure"}),"\n",(0,r.jsx)(t.p,{children:"Under Ozone, when a Datanode boots up and discovers SCM's address, the first thing that Datanode does is to create a private key and send a certificate request to the SCM."}),"\n",(0,r.jsx)(t.h4,{id:"certificate-approval-via-kerberos",children:"Certificate Approval via Kerberos"}),"\n",(0,r.jsx)(t.p,{children:"SCM has a built-in CA, and SCM has to approve this request. If the Datanode already has a Kerberos key tab, then SCM will trust Kerberos credentials and issue a certificate automatically."}),"\n",(0,r.jsx)(t.h4,{id:"manual-approval",children:"Manual Approval"}),"\n",(0,r.jsx)(t.p,{children:"If these are brand new Datanodes and Kerberos key tabs are not present at the Datanodes, then this request for the Datanodes identity certificate is queued up for approval from the administrator (This is work in progress, not committed in Ozone yet). In other words, the chain of trust is established by the administrator of the cluster."}),"\n",(0,r.jsx)(t.h4,{id:"automatic-approval",children:"Automatic Approval"}),"\n",(0,r.jsx)(t.p,{children:"If you running under an container orchestrator like Kubernetes, we rely on Kubernetes to create a one-time token that will be given to Datanode during boot time to prove the identity of the Datanode container (This is also work in progress.)"}),"\n",(0,r.jsx)(t.p,{children:"Once a certificate is issued, a Datanode is secure and Ozone Manager can issue block tokens. If there is no Datanode certificates or the SCM's root certificate is not present in the Datanode, then Datanode will register itself and download the SCM's root certificate as well get the certificates for itself."})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},62392:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>i});var n=s(30758);const r={},o=n.createContext(r);function a(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);