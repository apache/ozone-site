"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[467],{62392:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>d});var s=t(30758);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},79555:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"developer-guide/run/kubernetes","title":"Ozone on Kubernetes","description":"The Kubernetes examples and scripts in this project have been tested with Kubernetes 1.34.2 (k3s v1.34.2+k3s1).","source":"@site/docs/08-developer-guide/02-run/03-kubernetes.md","sourceDirName":"08-developer-guide/02-run","slug":"/developer-guide/run/kubernetes","permalink":"/docs/developer-guide/run/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/08-developer-guide/02-run/03-kubernetes.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"Kubernetes"},"sidebar":"defaultSidebar","previous":{"title":"Docker Compose","permalink":"/docs/developer-guide/run/docker-compose"},"next":{"title":"Test","permalink":"/docs/developer-guide/test/"}}');var o=t(86070),r=t(62392);const i={sidebar_label:"Kubernetes"},d="Ozone on Kubernetes",l={},c=[{value:"Connecting IDE to Ozone on Kubernetes",id:"connecting-ide-to-ozone-on-kubernetes",level:2},{value:"Setup Ozone and Kubernetes",id:"setup-ozone-and-kubernetes",level:3},{value:"Configure IntelliJ",id:"configure-intellij",level:3},{value:"Start Ozone in Kubernetes",id:"start-ozone-in-kubernetes",level:3},{value:"Connect IntelliJ to Kubernetes cluster",id:"connect-intellij-to-kubernetes-cluster",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"ozone-on-kubernetes",children:"Ozone on Kubernetes"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"The Kubernetes examples and scripts in this project have been tested with Kubernetes 1.34.2 (k3s v1.34.2+k3s1)."})}),"\n",(0,o.jsx)(n.h2,{id:"connecting-ide-to-ozone-on-kubernetes",children:"Connecting IDE to Ozone on Kubernetes"}),"\n",(0,o.jsx)(n.h3,{id:"setup-ozone-and-kubernetes",children:"Setup Ozone and Kubernetes"}),"\n",(0,o.jsxs)(n.p,{children:["To start Ozone in Kubernetes, you need Kubernetes and kubectl installed. You also need to add the ",(0,o.jsx)(n.a,{href:"https://github.com/elek/flekszible",children:"flekszible"})," binary in your path."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Build the project ",(0,o.jsx)(n.code,{children:"mvn clean install -DskipShade -DskipTests"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"cd <ozone-root>/hadoop-ozone/dist/target/ozone-X.X../kubernetes/examples/ozone"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"source ../testlib.sh"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"regenerate_resources"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"configure-intellij",children:"Configure IntelliJ"}),"\n",(0,o.jsx)(n.p,{children:"Select some preferred ports for attaching the debugger.\nBelow there is an example configuration for connecting OM to port 5005, SCM to port 6006 and S3G to port 7007."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Run -> Edit Configurations... -> Add New Configuration -> Remote JVM Debug"})}),"\n",(0,o.jsxs)(n.li,{children:["Name: ",(0,o.jsx)(n.code,{children:"om-0"}),", Debugger mode: ",(0,o.jsx)(n.code,{children:"Attach to remote JVM"}),", Host: ",(0,o.jsx)(n.code,{children:"localhost"}),", Port: ",(0,o.jsx)(n.code,{children:"5005"})]}),"\n",(0,o.jsxs)(n.li,{children:["Name: ",(0,o.jsx)(n.code,{children:"scm-0"}),", Debugger mode: ",(0,o.jsx)(n.code,{children:"Attach to remote JVM"}),", Host: ",(0,o.jsx)(n.code,{children:"localhost"}),", Port: ",(0,o.jsx)(n.code,{children:"6006"})]}),"\n",(0,o.jsxs)(n.li,{children:["Name: ",(0,o.jsx)(n.code,{children:"s3g-0"}),", Debugger mode: ",(0,o.jsx)(n.code,{children:"Attach to remote JVM"}),", Host: ",(0,o.jsx)(n.code,{children:"localhost"}),", Port: ",(0,o.jsx)(n.code,{children:"7007"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Update Ozone startup to use the preferred ports, as follows:"}),"\n",(0,o.jsxs)(n.p,{children:["In the file ",(0,o.jsx)(n.code,{children:"<ozone-root>/hadoop-ozone/dist/target/ozone-X.X../bin/ozone"})]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Replace ",(0,o.jsx)(n.code,{children:'OZONE_OM_OPTS="${RATIS_OPTS} ${OZONE_OM_OPTS}"'})," with ",(0,o.jsx)(n.code,{children:'OZONE_OM_OPTS="${RATIS_OPTS} ${OZONE_OM_OPTS} -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"'})]}),"\n",(0,o.jsxs)(n.li,{children:["Replace ",(0,o.jsx)(n.code,{children:'OZONE_SCM_OPTS="${RATIS_OPTS} ${OZONE_SCM_OPTS}"'})," with ",(0,o.jsx)(n.code,{children:'OZONE_SCM_OPTS="${RATIS_OPTS} ${OZONE_SCM_OPTS}  -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:6006"'})]}),"\n",(0,o.jsxs)(n.li,{children:["In ",(0,o.jsx)(n.code,{children:"ozone-s3gateway"})," add ",(0,o.jsx)(n.code,{children:'OZONE_S3G_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:7007"'})]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"start-ozone-in-kubernetes",children:"Start Ozone in Kubernetes"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Start the kubernetes server. For example, if using k3s, ",(0,o.jsx)(n.code,{children:"sudo k3s server"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["In a new terminal ",(0,o.jsx)(n.code,{children:"cd <ozone-root>/hadoop-ozone/dist/target/ozone-X.X../kubernetes/examples/ozone"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"kubectl apply -f ."})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Check if the pods are running ",(0,o.jsx)(n.code,{children:"kubectl get pods"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Start port-forwarding in the background"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward om-0 5005:5005 &\nkubectl port-forward scm-0 6006:6006 &\nkubectl port-forward s3g-0 7007:7007 &\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"connect-intellij-to-kubernetes-cluster",children:"Connect IntelliJ to Kubernetes cluster"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Go over the code and set breakpoints for the parts you want to debug"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Start in Debug mode the Remote JVM Debug configurations that we created earlier in IntelliJ"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"An example use would be to read and write objects in bash and check the output in the Debugger in IntelliJ. For example, set a breakpoint in the OMVolumeCreateRequest, then create a volume like so to hit it:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it scm-0 bash\nozone sh volume create testVolume\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);