"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[649],{62392:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var s=n(30758);const o={},i=s.createContext(o);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:t},e.children)}},95561:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"system-internals/components/ozone-manager/disk-layout","title":"Ozone Manager Disk Layout","description":"Overview","source":"@site/docs/07-system-internals/01-components/01-ozone-manager/01-disk-layout.md","sourceDirName":"07-system-internals/01-components/01-ozone-manager","slug":"/system-internals/components/ozone-manager/disk-layout","permalink":"/docs/system-internals/components/ozone-manager/disk-layout","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/master/docs/07-system-internals/01-components/01-ozone-manager/01-disk-layout.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Disk Layout"},"sidebar":"defaultSidebar","previous":{"title":"Ozone Manager","permalink":"/docs/system-internals/components/ozone-manager/"},"next":{"title":"RocksDB Schema","permalink":"/docs/system-internals/components/ozone-manager/rocksdb-schema"}}');var o=n(86070),i=n(62392);const r={sidebar_label:"Disk Layout"},a="Ozone Manager Disk Layout",c={},d=[{value:"<strong>Overview</strong>",id:"overview",level:2},{value:"<strong>Core Metadata Configurations</strong>",id:"core-metadata-configurations",level:2},{value:"<strong>On-Disk Directory Structure</strong>",id:"on-disk-directory-structure",level:2},{value:"<strong>Detailed Component Breakdown</strong>",id:"detailed-component-breakdown",level:2},{value:"<strong>1. RocksDB (<code>om.db</code>)</strong>",id:"1-rocksdb-omdb",level:3},{value:"<strong>2. The VERSION File</strong>",id:"2-the-version-file",level:3},{value:"<strong>3. Security Metadata</strong>",id:"3-security-metadata",level:3},{value:"<strong>4. Ratis Logs</strong>",id:"4-ratis-logs",level:3},{value:"<strong>5. <code>db.checkpoints</code></strong>",id:"5-dbcheckpoints",level:3},{value:"Recommended Storage Configuration Mapping",id:"recommended-storage-configuration-mapping",level:3},{value:"<strong>Layout Implementation for Different Environments</strong>",id:"layout-implementation-for-different-environments",level:2},{value:"<strong>Development/Test Environments</strong>",id:"developmenttest-environments",level:3},{value:"<strong>Production Environments</strong>",id:"production-environments",level:3}];function l(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"ozone-manager-disk-layout",children:"Ozone Manager Disk Layout"})}),"\n",(0,o.jsx)(t.h2,{id:"overview",children:(0,o.jsx)(t.strong,{children:"Overview"})}),"\n",(0,o.jsx)(t.p,{children:"Apache Ozone separates metadata management across different services to ensure scalability. The Ozone Manager (OM) is responsible for managing the namespace metadata, which includes volumes, buckets, and keys. This document outlines the on-disk configurations, directory structures, and layout for the Ozone Manager based on technical specifications."}),"\n",(0,o.jsx)(t.h2,{id:"core-metadata-configurations",children:(0,o.jsx)(t.strong,{children:"Core Metadata Configurations"})}),"\n",(0,o.jsx)(t.p,{children:"The following configuration keys define where the Ozone Manager stores its persistent data. For production environments, it is recommended to host these directories on NVMe/SSDs to ensure high performance."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"ozone.om.db.dirs"})}),": Specifies the dedicated location for the Ozone Manager RocksDB."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"ozone.metadata.dirs"})}),": Serves as the default location for security-related metadata (keys and certificates) and is often used as a fallback if specific DB directories are not defined."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"ozone.om.ratis.storage.dir"})}),": Defines the storage location for Ratis (Raft) logs, which are essential for Ozone Manager High Availability (HA)."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"on-disk-directory-structure",children:(0,o.jsx)(t.strong,{children:"On-Disk Directory Structure"})}),"\n",(0,o.jsxs)(t.p,{children:["A typical Ozone Manager metadata directory (e.g., ",(0,o.jsx)(t.code,{children:"/var/lib/hadoop-ozone/om/"}),") is organized as follows:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-text",children:"/var/lib/hadoop-ozone/om\n\u251c\u2500\u2500 data                              # The path configured for ozone.om.db.dirs\n\u2502   \u251c\u2500\u2500 db.checkpoints/               # Point-in-time snapshots of OM DB for external tools (e.g., Recon)\n\u2502   \u251c\u2500\u2500 om/\n\u2502   \u2502   \u2514\u2500\u2500 current/\n\u2502   \u2502       \u2514\u2500\u2500 VERSION               # Metadata identifying clusterID, omUuid, and layout version\n\u2502   \u251c\u2500\u2500 om.db/                        # The active RocksDB instance (Namespace State)\n\u2502   \u2502   \u251c\u2500\u2500 *.sst                     # Static Sorted Table files (immutable data blocks)\n\u2502   \u2502   \u251c\u2500\u2500 *.log                     # RocksDB Write-Ahead Logs (WAL)\n\u2502   \u2502   \u251c\u2500\u2500 MANIFEST                  # Records changes to the RocksDB structure\n\u2502   \u2502   \u251c\u2500\u2500 CURRENT                   # Pointer to the latest manifest file\n\u2502   \u2502   \u2514\u2500\u2500 snapshots/                # Internal Ozone Bucket Snapshots\n\u2502   \u2502       \u251c\u2500\u2500 om.db-<name1>/        # Hard-linked checkpoint for Snapshot 1\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 *.sst\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 CURRENT\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 MANIFEST\n\u2502   \u2502       \u2514\u2500\u2500 om.db-<name2>/        # Hard-linked checkpoint for Snapshot 2\n\u2502   \u2514\u2500\u2500 omMetrics                     # OM-specific performance and operational metrics\n\u251c\u2500\u2500 ozone-metadata                    # The path configured for ozone.metadata.dirs\n\u2502   \u2514\u2500\u2500 om/\n\u2502       \u251c\u2500\u2500 certs/                    # Public certificates and SCM CA chain\n\u2502       \u2514\u2500\u2500 keys/                     # RSA Private and Public PEM keys\n\u2514\u2500\u2500 ratis/                            # Raft replication logs (HA). The path configured for ozone.om.ratis.storage.dir\n    \u251c\u2500\u2500 <group-uuid>/                 # Ratis Pipeline Group ID\n    \u2502   \u251c\u2500\u2500 current/\n    \u2502   \u2502   \u251c\u2500\u2500 log_inprogress_<id>   # Active transaction logs\n    \u2502   \u2502   \u2514\u2500\u2500 raft-meta.conf        # Ratis membership and configuration metadata\n    \u2514\u2500\u2500 snapshot/                     # Ratis State Machine snapshots (for node synchronization)\n"})}),"\n",(0,o.jsx)(t.h2,{id:"detailed-component-breakdown",children:(0,o.jsx)(t.strong,{children:"Detailed Component Breakdown"})}),"\n",(0,o.jsx)(t.h3,{id:"1-rocksdb-omdb",children:(0,o.jsxs)(t.strong,{children:["1. RocksDB (",(0,o.jsx)(t.code,{children:"om.db"}),")"]})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"om.db"}),' directory contains the RocksDB state store. This is the "source of truth" for the namespace. It stores information about every volume, bucket, and key in the system. Because Ozone handles billions of objects, the performance of the underlying storage for this directory is critical.']}),"\n",(0,o.jsxs)(t.p,{children:["In Ozone, snapshots are implemented as RocksDB Checkpoints. When a bucket snapshot is created, OM creates a directory under snapshots/ and uses hard links for existing ",(0,o.jsx)(t.code,{children:".sst"})," files. This allows snapshots to be created nearly instantaneously with zero initial storage overhead."]}),"\n",(0,o.jsx)(t.h3,{id:"2-the-version-file",children:(0,o.jsx)(t.strong,{children:"2. The VERSION File"})}),"\n",(0,o.jsxs)(t.p,{children:["The VERSION file is created during the ",(0,o.jsx)(t.code,{children:"om --init"})," process. It ensures that the OM belongs to the correct cluster and identifies the layout version of the data to prevent software version mismatches."]}),"\n",(0,o.jsx)(t.p,{children:"Key fields include:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"nodeType"}),": Set to OM."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"clusterID"}),": The unique ID of the Ozone cluster."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"omUuid"}),": The unique identifier for this specific OM instance."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"layoutVersion"}),": The software-specific data layout version."]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"3-security-metadata",children:(0,o.jsx)(t.strong,{children:"3. Security Metadata"})}),"\n",(0,o.jsxs)(t.p,{children:["Located under ",(0,o.jsx)(t.code,{children:"ozone.metadata.dirs"}),", the security sub-directory contains the identity of the OM."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"keys/"}),": Contains private.pem and public.pem."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"certs/"}),": Contains the OM\u2019s certificate (signed by the SCM) and the SCM CA certificate. These are required for secure communication (mTLS) within the cluster."]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"4-ratis-logs",children:(0,o.jsx)(t.strong,{children:"4. Ratis Logs"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"ratis/"})," directory is critical for HA clusters. It stores the transaction logs that must be replicated across the OM quorum."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Logs"}),': Represent "inflight" transactions that haven\'t been fully compacted into the state machine.']}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Snapshots"}),": These are Ratis snapshots (not bucket snapshots). They allow a new or lagging OM node to recover its state quickly without replaying the entire history of logs."]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"5-dbcheckpoints",children:(0,o.jsxs)(t.strong,{children:["5. ",(0,o.jsx)(t.code,{children:"db.checkpoints"})]})}),"\n",(0,o.jsxs)(t.p,{children:["The db.checkpoints directory serves as a dedicated storage area for temporary, read-only snapshots of the active OM RocksDB. These checkpoints are primarily utilized by management and observability tools, such as Ozone Recon, to perform out-of-band analysis without impacting the performance of the live namespace. Unlike the user-facing bucket snapshots that reside within the ",(0,o.jsx)(t.code,{children:"om.db"})," hierarchy, these checkpoints are typically short-lived and represent a full point-in-time state of the entire metadata store. They enable the system to safely export the database state to other services for tasks like reporting, auditing, or cluster-wide health monitoring."]}),"\n",(0,o.jsx)(t.h3,{id:"recommended-storage-configuration-mapping",children:"Recommended Storage Configuration Mapping"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Path Description"}),(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Configuration Key"}),(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Storage Type Recommendation"}),(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Purpose"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"OM Metadata Database"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"ozone.om.db.dirs"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"NVMe (strongly recommended)"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"Stores the OM RocksDB database containing volumes, buckets, keys, and namespace state. This is the most latency-sensitive component in Ozone. Poor IOPS directly impacts client operation latency (PUT/DELETE/LIST)."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"OM Ratis Logs"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"ozone.om.ratis.storage.dir"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"NVMe or very fast SSD"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"Holds the Raft write-ahead log (WAL) for OM consensus. Every metadata mutation must be fsynced before commit. Slow disks increase write latency across the entire cluster because clients wait for quorum commit."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"General Ozone Metadata / Security Material"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.code,{children:"ozone.metadata.dirs"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:(0,o.jsx)(t.strong,{children:"SSD preferred (HDD acceptable for small clusters)"})}),(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"Base directory used by multiple Ozone services for certificates, keys, SCM/OM local metadata, and service state. Not on the critical write path like RocksDB or Ratis, but must be reliable and persistent."})]})]})]}),"\n",(0,o.jsx)(t.h2,{id:"layout-implementation-for-different-environments",children:(0,o.jsx)(t.strong,{children:"Layout Implementation for Different Environments"})}),"\n",(0,o.jsx)(t.h3,{id:"developmenttest-environments",children:(0,o.jsx)(t.strong,{children:"Development/Test Environments"})}),"\n",(0,o.jsxs)(t.p,{children:['For simplicity, a single "All-in-One" location can be used by setting ',(0,o.jsx)(t.code,{children:"ozone.metadata.dir"}),". All services (OM, SCM, DN) will store their metadata in sub-folders under this single path."]}),"\n",(0,o.jsx)(t.h3,{id:"production-environments",children:(0,o.jsx)(t.strong,{children:"Production Environments"})}),"\n",(0,o.jsxs)(t.p,{children:["It is strictly recommended to separate these directories. The ",(0,o.jsx)(t.code,{children:"om.db"})," and Ratis logs should reside on high-IOPS storage (SSDs/NVMe) to minimize latency for namespace operations, while security certificates can remain on standard persistent storage."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);