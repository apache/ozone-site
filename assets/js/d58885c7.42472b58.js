"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[6441],{49144:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"administrator-guide/configuration/high-availability/om-ha","title":"Ozone Manager High Availability","description":"Ozone Manager (OM) High Availability ensures that there is no single point of failure for the metadata-manager node responsible for key space management. In HA mode, the internal state is replicated via RAFT (with Apache Ratis) across multiple Ozone Manager instances.","source":"@site/docs/05-administrator-guide/02-configuration/06-high-availability/02-om-ha.md","sourceDirName":"05-administrator-guide/02-configuration/06-high-availability","slug":"/administrator-guide/configuration/high-availability/om-ha","permalink":"/docs/administrator-guide/configuration/high-availability/om-ha","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/02-configuration/06-high-availability/02-om-ha.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"OM HA Configuration"},"sidebar":"defaultSidebar","previous":{"title":"SCM HA Configuration","permalink":"/docs/administrator-guide/configuration/high-availability/scm-ha"},"next":{"title":"Operations","permalink":"/docs/administrator-guide/operations/"}}');var o=i(86070),s=i(62392);const r={sidebar_label:"OM HA Configuration"},t="Ozone Manager High Availability",l={},d=[{value:"Configuration",id:"configuration",level:2},{value:"OM Bootstrap",id:"om-bootstrap",level:2},{value:"OM Leader Transfer",id:"om-leader-transfer",level:2},{value:"Usage",id:"usage",level:3},{value:"Example",id:"example",level:3},{value:"OM Service Roles Listing",id:"om-service-roles-listing",level:2},{value:"Usage",id:"usage-1",level:3},{value:"Example",id:"example-1",level:3},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"ozone-manager-high-availability",children:"Ozone Manager High Availability"})}),"\n",(0,o.jsx)(n.p,{children:"Ozone Manager (OM) High Availability ensures that there is no single point of failure for the metadata-manager node responsible for key space management. In HA mode, the internal state is replicated via RAFT (with Apache Ratis) across multiple Ozone Manager instances."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["For conceptual information about OM HA, see the ",(0,o.jsx)(n.a,{href:"/docs/core-concepts/high-availability/om-ha",children:"OM HA documentation"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["One Ozone configuration (",(0,o.jsx)(n.code,{children:"ozone-site.xml"}),") can support multiple Ozone HA cluster. To select between the available HA clusters a logical name is required for each of the clusters which can be resolved to the IP addresses (and domain names) of the Ozone Managers."]}),"\n",(0,o.jsxs)(n.p,{children:["This logical name is called ",(0,o.jsx)(n.code,{children:"serviceId"})," and can be configured in the ",(0,o.jsx)(n.code,{children:"ozone-site.xml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<property>\n   <name>ozone.om.service.ids</name>\n   <value>cluster1</value>\n</property>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For each of the defined ",(0,o.jsx)(n.code,{children:"serviceId"})," a logical configuration name should be defined for each of the servers."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<property>\n   <name>ozone.om.nodes.cluster1</name>\n   <value>om1,om2,om3</value>\n</property>\n"})}),"\n",(0,o.jsx)(n.p,{children:"The defined prefixes can be used to define the address of each of the OM services:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<property>\n   <name>ozone.om.address.cluster1.om1</name>\n   <value>host1</value>\n</property>\n<property>\n   <name>ozone.om.address.cluster1.om2</name>\n   <value>host2</value>\n</property>\n<property>\n   <name>ozone.om.address.cluster1.om3</name>\n   <value>host3</value>\n</property>\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"Updating the OM service ID after the cluster is set up is not supported and will cause the OM startup process to abort. This value should be considered immutable after initial deployment."})}),"\n",(0,o.jsxs)(n.p,{children:["The defined ",(0,o.jsx)(n.code,{children:"serviceId"})," can be used instead of a single OM host using client interfaces."]}),"\n",(0,o.jsxs)(n.p,{children:["For example with ",(0,o.jsx)(n.code,{children:"o3fs://"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"hdfs dfs -ls o3fs://bucket.volume.cluster1/prefix/\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Or with ",(0,o.jsx)(n.code,{children:"ofs://"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"hdfs dfs -ls ofs://cluster1/volume/bucket/prefix/\n"})}),"\n",(0,o.jsx)(n.h2,{id:"om-bootstrap",children:"OM Bootstrap"}),"\n",(0,o.jsx)(n.p,{children:"To convert a non-HA OM to be HA or to add new OM nodes to existing HA OM ring, new OM node(s) need to be bootstrapped."}),"\n",(0,o.jsx)(n.p,{children:"Before bootstrapping a new OM node, all the existing OM's on-disk configuration file (ozone-site.xml) must be updated with the configuration details of the new OM such as nodeId, address, port etc. Note that the existing OMs need not be restarted. They will reload the configuration from disk when they receive a bootstrap request from the bootstrapping node."}),"\n",(0,o.jsx)(n.p,{children:"To bootstrap an OM, the following command needs to be run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone om [global options (optional)] --bootstrap\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The bootstrap command will first verify that all the OMs have the updated configuration file and fail the command otherwise. This check can be skipped using the ",(0,o.jsx)(n.em,{children:"force"})," option. The ",(0,o.jsx)(n.em,{children:"force"})," option allows to continue with the bootstrap when one of the existing OMs is down or not responding."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone om [global options (optional)] --bootstrap --force\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Note that using the ",(0,o.jsx)(n.em,{children:"force"})," option during bootstrap could crash the OM process if it does not have updated configurations."]}),"\n",(0,o.jsx)(n.h2,{id:"om-leader-transfer",children:"OM Leader Transfer"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ozone admin om transfer"})," command allows you to manually transfer the leadership of the Ozone Manager (OM) Raft group to a specific OM node or to a randomly chosen follower."]}),"\n",(0,o.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om transfer -id <OM_SERVICE_ID> -n <NEW_LEADER_ID>\nozone admin om transfer -id <OM_SERVICE_ID> -r\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-id, --service-id"}),": Specifies the Ozone Manager Service ID."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-n, --newLeaderId, --new-leader-id"}),": The node ID of the OM to which leadership will be transferred (e.g., ",(0,o.jsx)(n.code,{children:"om1"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-r, --random"}),": Randomly chooses a follower to transfer leadership to."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,o.jsxs)(n.p,{children:["To transfer leadership to ",(0,o.jsx)(n.code,{children:"om2"})," in a cluster with service ID ",(0,o.jsx)(n.code,{children:"cluster1"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om transfer -id cluster1 -n om2\n"})}),"\n",(0,o.jsx)(n.p,{children:"To transfer leadership to a random follower:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om transfer -id cluster1 -r\n"})}),"\n",(0,o.jsx)(n.h2,{id:"om-service-roles-listing",children:"OM Service Roles Listing"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ozone admin om roles"})," command lists all Ozone Managers and their respective Raft server roles (leader, follower, or candidate)."]}),"\n",(0,o.jsx)(n.h3,{id:"usage-1",children:"Usage"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om roles [-id <OM_SERVICE_ID>] [--json | --table]\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-id, --service-id"}),": (Optional) Specifies the Ozone Manager Service ID."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--json"}),": (Optional) Formats the output as JSON."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--table"}),": (Optional) Formats the output as a table."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-1",children:"Example"}),"\n",(0,o.jsxs)(n.p,{children:["To list OM roles for ",(0,o.jsx)(n.code,{children:"cluster1"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om roles -id cluster1\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"om1 : LEADER (host1)\nom2 : FOLLOWER (host2)\nom3 : FOLLOWER (host3)\n"})}),"\n",(0,o.jsx)(n.p,{children:"To list OM roles as a table:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ozone admin om roles -id cluster1 --table\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example table output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"Ozone Manager Roles\n-------------------\nHost Name | Node ID | Role\n-------------------\nhost1     | om1     | LEADER\nhost2     | om2     | FOLLOWER\nhost3     | om3     | FOLLOWER\n-------------------\n"})}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/core-concepts/high-availability/om-ha",children:"Ozone Manager High Availability"})," - Conceptual overview"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/system-internals/components/ozone-manager/high-availability",children:"OM HA Implementation Details"})," - Technical implementation details including double buffer and automatic snapshot installation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"./scm-ha",children:"SCM HA Configuration"})," - Storage Container Manager High Availability configuration"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},62392:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var a=i(30758);const o={},s=a.createContext(o);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);