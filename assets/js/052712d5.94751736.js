"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[3459],{4886:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"user-guide/client-interfaces/o3","title":"Ozone Shell (ozone sh)","description":"Ozone shell is the primary interface to interact with Ozone from the command line. Behind the scenes it uses the Java API.","source":"@site/docs/04-user-guide/01-client-interfaces/01-o3.md","sourceDirName":"04-user-guide/01-client-interfaces","slug":"/user-guide/client-interfaces/o3","permalink":"/docs/user-guide/client-interfaces/o3","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/04-user-guide/01-client-interfaces/01-o3.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Ozone Shell"},"sidebar":"defaultSidebar","previous":{"title":"Client Interfaces","permalink":"/docs/user-guide/client-interfaces/"},"next":{"title":"ofs","permalink":"/docs/user-guide/client-interfaces/ofs"}}');var t=s(86070),i=s(62392);const l={sidebar_label:"Ozone Shell"},a="Ozone Shell (ozone sh)",c={},r=[{value:"General Command Format",id:"general-command-format",level:2},{value:"Volume operations",id:"volume-operations",level:2},{value:"Bucket operations",id:"bucket-operations",level:2},{value:"Key operations",id:"key-operations",level:2},{value:"Querying CLI Results",id:"querying-cli-results",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsxs)(n.h1,{id:"ozone-shell-ozone-sh",children:["Ozone Shell (",(0,t.jsx)(n.code,{children:"ozone sh"}),")"]})}),"\n",(0,t.jsxs)(n.p,{children:["Ozone shell is the primary interface to interact with Ozone from the command line. Behind the scenes it uses the ",(0,t.jsx)(n.a,{href:"/docs/user-guide/client-interfaces/java-client-api",children:"Java API"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["There are some functionality which couldn't be accessed without using ",(0,t.jsx)(n.code,{children:"ozone sh"})," commands. For example:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Creating volumes with quota"}),"\n",(0,t.jsx)(n.li,{children:"Managing internal ACLs"}),"\n",(0,t.jsx)(n.li,{children:"Creating buckets with encryption key"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"All of these are one-time, administration tasks. Applications can use Ozone without this CLI using other interface like Hadoop Compatible File System (o3fs or ofs) or S3 interface."}),"\n",(0,t.jsxs)(n.p,{children:["Ozone shell help can be invoked at ",(0,t.jsx)(n.em,{children:"object"})," level or at ",(0,t.jsx)(n.em,{children:"action"})," level."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ozone sh volume --help\n"})}),"\n",(0,t.jsx)(n.p,{children:"will show all possible actions for volumes."}),"\n",(0,t.jsx)(n.p,{children:"Or it can be invoked to explain a specific action like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ozone sh volume create --help\n"})}),"\n",(0,t.jsxs)(n.p,{children:["which will print the command line options of the ",(0,t.jsx)(n.code,{children:"create"})," command for volumes."]}),"\n",(0,t.jsx)(n.h2,{id:"general-command-format",children:"General Command Format"}),"\n",(0,t.jsx)(n.p,{children:"Ozone shell commands take the following form:"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"ozone sh object action url"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"ozone"})," script is used to invoke all Ozone sub-commands. The Ozone shell is\ninvoked via ",(0,t.jsx)(n.code,{children:"sh"})," command."]}),"\n",(0,t.jsx)(n.p,{children:"Object can be volume, bucket or key. Actions are various verbs like\ncreate, list, delete etc."}),"\n",(0,t.jsx)(n.p,{children:"Depending on the action, Ozone URL can point to a volume, bucket or key in the following format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"[schema][server:port]/volume/bucket/key\n"})}),"\n",(0,t.jsx)(n.p,{children:"Where,"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Schema"})," - This should be ",(0,t.jsx)(n.code,{children:"o3"})," which is the native RPC protocol to access\nOzone API. The usage of the schema is optional."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Server",":Port"]})," - This is the address of the Ozone Manager. If the port is\nomitted the default port from ",(0,t.jsx)(n.code,{children:"ozone-site.xml"})," will be used."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Please see volume commands, bucket commands, and key commands section for more\ndetail."}),"\n",(0,t.jsx)(n.h2,{id:"volume-operations",children:"Volume operations"}),"\n",(0,t.jsx)(n.p,{children:"Volume is the top level element of the hierarchy, managed only by administrators. Optionally, quota and the owner user can be specified."}),"\n",(0,t.jsx)(n.p,{children:"Example commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ozone sh volume create /vol1\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh volume info /vol1\n{\n  "metadata" : { },\n  "name" : "vol1",\n  "admin" : "hadoop",\n  "owner" : "hadoop",\n  "creationTime" : "2020-07-28T12:31:50.112Z",\n  "modificationTime" : "2020-07-28T12:31:50.112Z",\n  "acls" : [ {\n    "type" : "USER",\n    "name" : "hadoop",\n    "aclScope" : "ACCESS",\n    "aclList" : [ "ALL" ]\n  }, {\n    "type" : "GROUP",\n    "name" : "users",\n    "aclScope" : "ACCESS",\n    "aclList" : [ "ALL" ]\n  } ],\n  "quota" : 1152921504606846976\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh volume list /\n[ {\n  "metadata" : { },\n  "name" : "s3v",\n  "admin" : "hadoop",\n  "owner" : "hadoop",\n  "creationTime" : "2020-07-27T11:32:22.314Z",\n  "modificationTime" : "2020-07-27T11:32:22.314Z",\n  "acls" : [ {\n    "type" : "USER",\n    "name" : "hadoop",\n    "aclScope" : "ACCESS",\n    "aclList" : [ "ALL" ]\n  }, {\n    "type" : "GROUP",\n    "name" : "users",\n    "aclScope" : "ACCESS",\n    "aclList" : [ "ALL" ]\n  } ],\n  "quota" : 1152921504606846976\n}, {\n  ....\n} ]\n'})}),"\n",(0,t.jsx)(n.p,{children:"If the volume is empty, we can delete the volume using the command below."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ozone sh volume delete /vol1\nVolume vol1 is deleted\n"})}),"\n",(0,t.jsx)(n.p,{children:"If the volume contains any buckets or keys, we can delete the volume recursively. This will delete all keys and buckets within the volume, and then delete the volume itself.\nAfter running this command there is no way to recover deleted contents."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ozone sh volume delete -r /vol1\nThis command will delete volume recursively.\nThere is no recovery option after using this command, and no trash for FSO buckets.\nDelay is expected running this command.\nEnter 'yes' to proceed': yes\nVolume vol1 is deleted\n"})}),"\n",(0,t.jsx)(n.h2,{id:"bucket-operations",children:"Bucket operations"}),"\n",(0,t.jsx)(n.p,{children:"Bucket is the second level of the object hierarchy, and is similar to AWS S3 buckets. Users can create buckets in volumes, if they have the necessary permissions."}),"\n",(0,t.jsx)(n.p,{children:"Command examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ozone sh bucket create /vol1/bucket1\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh bucket info /vol1/bucket1\n{\n  "metadata" : { },\n  "volumeName" : "vol1",\n  "name" : "bucket1",\n  "storageType" : "DISK",\n  "versioning" : false,\n  "creationTime" : "2020-07-28T13:14:45.091Z",\n  "modificationTime" : "2020-07-28T13:14:45.091Z",\n  "encryptionKeyName" : null,\n  "sourceVolume" : null,\n  "sourceBucket" : null\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"If the bucket is empty we can delete the bucket using the command below."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ozone sh bucket delete /vol1/bucket1\nBucket bucket1 is deleted\n"})}),"\n",(0,t.jsx)(n.p,{children:"If the bucket contains any keys, we can delete the bucket recursively. This will delete all the keys within the bucket, and then the bucket itself.\nAfter running this command there is no way to recover deleted contents."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ozone sh bucket delete -r /vol1/bucket1\nThis command will delete bucket recursively.\nThere is no recovery option after using this command, and deleted keys won't move to trash.\nEnter 'yes' to proceed': yes\nBucket bucket1 is deleted\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/docs/administrator-guide/configuration/security/encryption/transparent-data-encryption",children:"Transparent Data Encryption"})," can be enabled at the bucket level."]}),"\n",(0,t.jsx)(n.h2,{id:"key-operations",children:"Key operations"}),"\n",(0,t.jsx)(n.p,{children:"Key is the object which can store the data."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ozone sh key put /vol1/bucket1/README.md README.md\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["In this case the standard ",(0,t.jsx)(n.code,{children:"ozone sh <object_type> <action> <url>"})," scheme may be a bit confusing at first, as it results in the syntax ",(0,t.jsx)(n.code,{children:"ozone sh key put <destination> <source>"})," instead of the arguably more natural order of ",(0,t.jsx)(n.code,{children:"<source> <destination>"}),"."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh key info /vol1/bucket1/README.md\n{\n  "volumeName" : "vol1",\n  "bucketName" : "bucket1",\n  "name" : "README.md",\n  "dataSize" : 3841,\n  "creationTime" : "2020-07-28T13:17:20.749Z",\n  "modificationTime" : "2020-07-28T13:17:21.979Z",\n  "replicationType" : "RATIS",\n  "replicationFactor" : 1,\n  "ozoneKeyLocations" : [ {\n    "containerID" : 1,\n    "localID" : 104591670688743424,\n    "length" : 3841,\n    "offset" : 0\n  } ],\n  "metadata" : { },\n  "fileEncryptionInfo" : null\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ozone sh key get /vol1/bucket1/README.md /tmp/\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ozone sh key delete /vol1/bucket1/key1\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If the key is in an ",(0,t.jsx)(n.a,{href:"/docs/system-internals/features/filesystem-optimization",children:"FSO"})," bucket it will be moved to the trash when deleted. Below is the trash location:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"/<volume>/<bucket>/.Trash/<user>\n"})}),"\n",(0,t.jsx)(n.p,{children:"If the key is in an OBS bucket it will be permanently deleted."}),"\n",(0,t.jsx)(n.h2,{id:"querying-cli-results",children:"Querying CLI Results"}),"\n",(0,t.jsxs)(n.p,{children:["Ozone CLI returns JSON responses. ",(0,t.jsx)(n.a,{href:"https://stedolan.github.io/jq/manual/",children:"jq"})," is a command line JSON processor that can be used to filter CLI output for desired information."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"List FSO buckets that are not links."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh bucket list /s3v | jq \'.[] | select(.link==false and .bucketLayout=="FILE_SYSTEM_OPTIMIZED")\'\n{\n  "metadata": {},\n  "volumeName": "s3v",\n  "name": "fso-bucket",\n  "storageType": "DISK",\n  "versioning": false,\n  "usedBytes": 0,\n  "usedNamespace": 0,\n  "creationTime": "2023-02-01T05:18:46.974Z",\n  "modificationTime": "2023-02-01T05:18:46.974Z",\n  "quotaInBytes": -1,\n  "quotaInNamespace": -1,\n  "bucketLayout": "FILE_SYSTEM_OPTIMIZED",\n  "owner": "om",\n  "link": false\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"List EC buckets with their replication config."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'$ ozone sh bucket list /vol1 | jq -r \'.[] | select(.replicationConfig.replicationType == "EC") | {"name": .name, "replicationConfig": .replicationConfig}\'\n{\n  "name": "ec5",\n  "replicationConfig": {\n    "data": 3,\n    "parity": 2,\n    "ecChunkSize": 1048576,\n    "codec": "RS",\n    "replicationType": "EC",\n    "requiredNodes": 5\n  }\n}\n{\n  "name": "ec9",\n  "replicationConfig": {\n    "data": 6,\n    "parity": 3,\n    "ecChunkSize": 1048576,\n    "codec": "RS",\n    "replicationType": "EC",\n    "requiredNodes": 9\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"List names of encrypted buckets and their encryption key names in tab-separated-value format."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ozone sh bucket list /vol1 | jq -r '.[] | select(.encryptionKeyName != null) | [.name, .encryptionKeyName] | @tsv'\nec5     key1\nencrypted-bucket        key1\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},62392:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var o=s(30758);const t={},i=o.createContext(t);function l(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);