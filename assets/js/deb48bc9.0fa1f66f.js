"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[6866],{62392:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(30758);const o={},i=t.createContext(o);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},76552:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"user-guide/client-interfaces/python","title":"Accessing Apache Ozone from Python","description":"Apache Ozone project itself does not provide Python client libraries.","source":"@site/docs/04-user-guide/01-client-interfaces/07-python.md","sourceDirName":"04-user-guide/01-client-interfaces","slug":"/user-guide/client-interfaces/python","permalink":"/docs/user-guide/client-interfaces/python","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/04-user-guide/01-client-interfaces/07-python.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_label":"Accessing Apache Ozone from Python"},"sidebar":"defaultSidebar","previous":{"title":"Java Client API","permalink":"/docs/user-guide/client-interfaces/java-client-api"},"next":{"title":"CSI Protocol","permalink":"/docs/user-guide/client-interfaces/csi-protocol"}}');var o=s(86070),i=s(62392);const r={sidebar_label:"Accessing Apache Ozone from Python"},a="Accessing Apache Ozone from Python",l={},c=[{value:"Setup and Prerequisites",id:"setup-and-prerequisites",level:2},{value:"Method 1: Access Ozone via PyArrow and libhdfs",id:"method-1-access-ozone-via-pyarrow-and-libhdfs",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Code Example",id:"code-example",level:3},{value:"Method 2: Access Ozone via Boto3 and S3 Gateway",id:"method-2-access-ozone-via-boto3-and-s3-gateway",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Code Example",id:"code-example-1",level:3},{value:"Method 3: Access Ozone via HttpFS REST API",id:"method-3-access-ozone-via-httpfs-rest-api",level:2},{value:"Configuration",id:"configuration-2",level:3},{value:"Code Example (requests)",id:"code-example-requests",level:3},{value:"Code Example (webhdfs)",id:"code-example-webhdfs",level:3},{value:"Troubleshooting Tips",id:"troubleshooting-tips",level:2},{value:"References and Further Resources",id:"references-and-further-resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"accessing-apache-ozone-from-python",children:"Accessing Apache Ozone from Python"})}),"\n",(0,o.jsx)(n.p,{children:"Apache Ozone project itself does not provide Python client libraries.\nHowever, several third-party open source libraries can be used to build applications to access an Ozone cluster via\ndifferent interfaces: ofs file system, Ozone HttpFS REST API and Ozone S3."}),"\n",(0,o.jsx)(n.p,{children:"This document outlines these approaches, providing concise setup instructions and validated code examples."}),"\n",(0,o.jsx)(n.h2,{id:"setup-and-prerequisites",children:"Setup and Prerequisites"}),"\n",(0,o.jsx)(n.p,{children:"Before starting, ensure the following:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Python installed (3.x recommended)"}),"\n",(0,o.jsx)(n.li,{children:"Apache Ozone configured and accessible"}),"\n",(0,o.jsxs)(n.li,{children:["For PyArrow with libhdfs:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["PyArrow library (",(0,o.jsx)(n.code,{children:"pip install pyarrow"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Hadoop native libraries configured and Ozone classpath specified (see below for details)"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["For S3 access:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Boto3 (",(0,o.jsx)(n.code,{children:"pip install boto3"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Ozone S3 Gateway endpoint and bucket names"}),"\n",(0,o.jsx)(n.li,{children:"Access credentials (AWS-like key and secret)"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["For HttpFS access:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Requests (",(0,o.jsx)(n.code,{children:"pip install requests"}),") or fsspec (",(0,o.jsx)(n.code,{children:"pip install fsspec"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"method-1-access-ozone-via-pyarrow-and-libhdfs",children:"Method 1: Access Ozone via PyArrow and libhdfs"}),"\n",(0,o.jsxs)(n.p,{children:["This approach leverages PyArrow's HadoopFileSystem API, which requires ",(0,o.jsx)(n.em,{children:"libhdfs.so"})," native library.\nThe ",(0,o.jsx)(n.em,{children:"libhdfs.so"})," is not packaged within PyArrow and you must download it separately from Hadoop."]}),"\n",(0,o.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Ensure Ozone configuration files (core-site.xml and ",(0,o.jsx)(n.code,{children:"ozone-site.xml"}),") are available and ",(0,o.jsx)(n.code,{children:"OZONE_CONF_DIR"})," is set.\nAlso ensure ",(0,o.jsx)(n.code,{children:"ARROW_LIBHDFS_DIR"})," and ",(0,o.jsx)(n.code,{children:"CLASSPATH"})," are set properly."]}),"\n",(0,o.jsx)(n.p,{children:"For example,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"export ARROW_LIBHDFS_DIR=hadoop-3.4.0/lib/native/\nexport CLASSPATH=$(ozone classpath ozone-tools)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"code-example",children:"Code Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import pyarrow.fs as pafs\n\n# Connect to Ozone using HadoopFileSystem\n# "default" tells PyArrow to use the fs.defaultFS property from core-site.xml\nfs = pafs.HadoopFileSystem("default")\n\n# Create a directory inside the bucket\nfs.create_dir("volume/bucket/aaa")\n\n# Write data to a file\npath = "volume/bucket/file1"\nwith fs.open_output_stream(path) as stream:\n  stream.write(b\'data\')\n'})}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsx)(n.p,{children:"Configure fs.defaultFS in the core-site.xml to point to the Ozone cluster. For example,"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"<configuration>\n  <property>\n    <name>fs.defaultFS</name>\n    <value>ofs://om:9862</value>\n    <description>Ozone Manager endpoint</description>\n  </property>\n</configuration>\n"})})]}),"\n",(0,o.jsxs)(n.p,{children:["Try it yourself! Check out ",(0,o.jsx)(n.a,{href:"https://ozone.apache.org/docs/edge/recipe/pyarrowtutorial.html",children:"PyArrow Tutorial"})," for a quick start using Ozone's Docker image."]}),"\n",(0,o.jsx)(n.h2,{id:"method-2-access-ozone-via-boto3-and-s3-gateway",children:"Method 2: Access Ozone via Boto3 and S3 Gateway"}),"\n",(0,o.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Identify your Ozone S3 Gateway endpoint (e.g., ",(0,o.jsx)(n.code,{children:"http://s3g:9878"}),")."]}),"\n",(0,o.jsx)(n.li,{children:"Use AWS-compatible credentials (from Ozone)."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"code-example-1",children:"Code Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import boto3\n\n# Create a local file to upload\nwith open(\"localfile.txt\", \"w\") as f:\n  f.write(\"Hello from Ozone via Boto3!\\n\")\n\n# Configure Boto3 client\ns3 = boto3.client(\n  's3',\n  endpoint_url='http://s3g:9878',\n  aws_access_key_id='ozone-access-key',\n  aws_secret_access_key='ozone-secret-key'\n)\n\n# List buckets\nresponse = s3.list_buckets()\nprint(\"Buckets:\", response['Buckets'])\n\n# Upload the file\ns3.upload_file('localfile.txt', 'bucket', 'file.txt')\nprint(\"Uploaded 'localfile.txt' to 'bucket/file.txt'\")\n\n# Download the file back\ns3.download_file('bucket', 'file.txt', 'downloaded.txt')\nprint(\"Downloaded 'file.txt' as 'downloaded.txt'\")\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Replace endpoint URL, credentials, and bucket names with your setup."})}),"\n",(0,o.jsxs)(n.p,{children:["Try it yourself! Check out ",(0,o.jsx)(n.a,{href:"https://ozone.apache.org/docs/edge/recipe/boto3tutorial.html",children:"Boto3 Tutorial"})," for a quick start using Ozone's Docker image."]}),"\n",(0,o.jsx)(n.h2,{id:"method-3-access-ozone-via-httpfs-rest-api",children:"Method 3: Access Ozone via HttpFS REST API"}),"\n",(0,o.jsx)(n.p,{children:"First, install requests Python module:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"pip install requests\n"})}),"\n",(0,o.jsx)(n.h3,{id:"configuration-2",children:"Configuration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use Ozone\u2019s HttpFS endpoint (e.g., ",(0,o.jsx)(n.code,{children:"http://httpfs:14000"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"code-example-requests",children:"Code Example (requests)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/python\nimport requests\n\n# Ozone HTTPFS endpoint and file path\nhost = "http://httpfs:14000"\nvolume = "vol1"\nbucket = "bucket1"\nfilename = "hello.txt"\npath = f"/webhdfs/v1/{volume}/{bucket}/{filename}"\nuser = "ozone"  # can be any value in simple auth mode\n\n# Step 1: Initiate file creation (responds with 307 redirect)\nparams_create = {\n  "op": "CREATE",\n  "overwrite": "true",\n  "user.name": user\n}\n\nprint("Creating file...")\nresp_create = requests.put(host + path, params=params_create, allow_redirects=False)\n\nif resp_create.status_code != 307:\n  print(f"Unexpected response: {resp_create.status_code}")\n  print(resp_create.text)\n  exit(1)\n\nredirect_url = resp_create.headers[\'Location\']\nprint(f"Redirected to: {redirect_url}")\n\n# Step 2: Write data to the redirected location with correct headers\nheaders = {"Content-Type": "application/octet-stream"}\ncontent = b"Hello from Ozone HTTPFS!\\n"\n\nresp_upload = requests.put(redirect_url, data=content, headers=headers)\nif resp_upload.status_code != 201:\n  print(f"Upload failed: {resp_upload.status_code}")\n  print(resp_upload.text)\n  exit(1)\nprint("File created successfully.")\n\n# Step 3: Read the file back\nparams_open = {\n  "op": "OPEN",\n  "user.name": user\n}\n\nprint("Reading file...")\nresp_read = requests.get(host + path, params=params_open, allow_redirects=True)\nif resp_read.ok:\n  print("File contents:")\n  print(resp_read.text)\nelse:\n  print(f"Read failed: {resp_read.status_code}")\n  print(resp_read.text)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Try it yourself! Check out ",(0,o.jsx)(n.a,{href:"https://ozone.apache.org/docs/edge/recipe/pythonrequestsozonehttpfs.html",children:"Access Ozone using HttpFS REST API Tutorial"})," for a quick start using Ozone's Docker image."]}),"\n",(0,o.jsx)(n.h3,{id:"code-example-webhdfs",children:"Code Example (webhdfs)"}),"\n",(0,o.jsx)(n.p,{children:"First, install fsspec Python module:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"pip install fsspec\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from fsspec.implementations.webhdfs import WebHDFS\n\nfs = WebHDFS(host='httpfs', port=14000, user='ozone')\n\n# Read a file from /vol1/bucket1/hello.txt\nfile_path = \"/vol1/bucket1/hello.txt\"\n\nwith fs.open(file_path, mode='rb') as f:\n  content = f.read()\n  print(\"File contents:\")\n  print(content.decode('utf-8'))\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Replace host, port, and path as per your setup."})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting-tips",children:"Troubleshooting Tips"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Authentication Errors"}),": Verify credentials and Kerberos tokens (if used)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Connection Issues"}),": Check endpoint URLs, ports, and firewall rules."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"FileSystem Errors"}),": Ensure correct Ozone configuration and appropriate permissions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Missing Dependencies"}),": Install required Python packages (",(0,o.jsx)(n.code,{children:"pip install pyarrow boto3 requests fsspec"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"references-and-further-resources",children:"References and Further Resources"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://ozone.apache.org/docs/",children:"Apache Ozone Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://arrow.apache.org/docs/python/",children:"PyArrow Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/index.html",children:"Boto3 Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://filesystem-spec.readthedocs.io/en/latest/api.html#fsspec.implementations.webhdfs.WebHDFS",children:"fsspec WebHDFS Python API"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);