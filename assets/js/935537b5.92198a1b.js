"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[4308],{53703:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"administrator-guide/operations/disk-replacement/recon","title":"Replacing Recon Disks","description":"Audience: Cluster Administrators","source":"@site/docs/05-administrator-guide/03-operations/04-disk-replacement/04-recon.md","sourceDirName":"05-administrator-guide/03-operations/04-disk-replacement","slug":"/administrator-guide/operations/disk-replacement/recon","permalink":"/docs/administrator-guide/operations/disk-replacement/recon","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/03-operations/04-disk-replacement/04-recon.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_label":"Recon"},"sidebar":"defaultSidebar","previous":{"title":"Datanodes","permalink":"/docs/administrator-guide/operations/disk-replacement/datanodes"},"next":{"title":"Data Balancing","permalink":"/docs/administrator-guide/operations/data-balancing/"}}');var o=s(86070),r=s(62392);const t={sidebar_label:"Recon"},a="Replacing Recon Disks",d={},l=[{value:"1. Overview",id:"1-overview",level:2},{value:"Recon Database Directories",id:"recon-database-directories",level:3},{value:"2. Pre-flight Checks",id:"2-pre-flight-checks",level:2},{value:"3. Procedure for Replacing a Recon Disk",id:"3-procedure-for-replacing-a-recon-disk",level:2},{value:"4. Additional Considerations",id:"4-additional-considerations",level:2},{value:"4.1 No Data Loss Risk",id:"41-no-data-loss-risk",level:3},{value:"4.2 Performance Impact During Rebuild",id:"42-performance-impact-during-rebuild",level:3},{value:"4.3 SCM Snapshot Configuration",id:"43-scm-snapshot-configuration",level:3},{value:"4.4 Disk Monitoring",id:"44-disk-monitoring",level:3}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"replacing-recon-disks",children:"Replacing Recon Disks"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Audience:"})," Cluster Administrators"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Prerequisites:"})," Familiarity with Ozone services and Linux system administration."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Purpose:"}),"\nThis guide provides the straightforward procedure for replacing a failed disk on an Ozone Recon node."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Impact of Recon Disk Failure:"}),"\nA failure of the Recon disk will cause the Recon service to stop functioning. However, because Recon is not in the critical path for data I/O, this failure has ",(0,o.jsx)(n.strong,{children:"no impact on the core operations of your Ozone cluster"}),". Client reads and writes will continue normally. All data on the Recon disk can be fully rebuilt from OM and SCM."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Unlike critical services like OM or SCM, a Recon disk failure does ",(0,o.jsx)(n.strong,{children:"not impact core cluster operations"}),". Client reads and writes continue normally because Recon is not in the data I/O path. All data stored on the Recon disk can be fully rebuilt from the active OM and SCM services, making disk replacement a straightforward, low-risk procedure that can be performed without cluster downtime."]})}),"\n",(0,o.jsx)(n.p,{children:"When a Recon disk fails, the service will stop functioning, but upon restart with empty directories, Recon automatically detects the missing databases and initiates a complete rebuild by downloading fresh snapshots from the OM leader and syncing with SCM. This automatic recovery process ensures that all Recon databases\u2014including the OM snapshot database, SCM snapshot database (if enabled), and Recon's own aggregated analysis databases\u2014are fully reconstructed without manual intervention."}),"\n",(0,o.jsx)(n.h3,{id:"recon-database-directories",children:"Recon Database Directories"}),"\n",(0,o.jsx)(n.p,{children:"Recon uses several database directories that may be affected by disk failure:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"ozone.recon.db.dir"})}),": Stores Recon's primary RocksDB database, which contains aggregated data and analysis results (ContainerKey and ContainerKeyCount tables). This directory also typically contains the SQL database (default Derby) used for storing GlobalStats, FileCountBySize, ReconTaskStatus, ContainerHistory, and UnhealthyContainers tables."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"ozone.recon.om.db.dir"})}),": Stores the copy of the OM database snapshot that Recon uses as its source of truth for the namespace."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.code,{children:"ozone.recon.scm.db.dirs"})}),": Stores the copy of the SCM database snapshot (if SCM snapshot is enabled via ",(0,o.jsx)(n.code,{children:"ozone.recon.scm.snapshot.enabled"}),"). This contains information about Datanodes, pipelines, and containers."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"If any of these directories are on the failed disk, they will need to be restored to the replacement disk."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-pre-flight-checks",children:"2. Pre-flight Checks"}),"\n",(0,o.jsx)(n.p,{children:"Before starting, the administrator should:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Identify the Failed Disk:"})," Use system tools (",(0,o.jsx)(n.code,{children:"dmesg"}),", ",(0,o.jsx)(n.code,{children:"smartctl"}),", etc.) to confirm which disk has failed and its mount point."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Identify Recon Directories:"})," Check your ",(0,o.jsx)(n.code,{children:"ozone-site.xml"})," to confirm which Recon directories are on the failed disk. The primary properties are:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ozone.recon.db.dir"}),": Stores Recon's primary RocksDB database, which contains aggregated data and analysis results."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ozone.recon.om.db.dir"}),": Stores the copy of the OM database snapshot that Recon uses as its source of truth for the namespace."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ozone.recon.scm.db.dirs"}),": Stores the copy of the SCM database snapshot (if SCM snapshot is enabled)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ozone.recon.sql.db.jdbc.url"}),": The JDBC URL for the SQL database (defaults to ",(0,o.jsx)(n.code,{children:"jdbc:derby:${ozone.recon.db.dir}/ozone_recon_derby.db"})," if not explicitly configured)."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Prepare the Replacement Disk:"})," Physically install a new, healthy disk. Format it and mount it at the same path as the failed disk. Ensure it has the correct ownership and permissions for the user that runs the Recon process. The default permissions for Recon metadata directories are ",(0,o.jsx)(n.strong,{children:"750"})," (configurable via ",(0,o.jsx)(n.code,{children:"ozone.recon.db.dirs.permissions"}),")."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"3-procedure-for-replacing-a-recon-disk",children:"3. Procedure for Replacing a Recon Disk"}),"\n",(0,o.jsx)(n.p,{children:"This is a low-risk recovery procedure that can be performed without any downtime for your main Ozone cluster."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"STOP THE Recon SERVICE:"})," On the Recon node, stop the Recon daemon. The rest of your Ozone cluster remains fully operational."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Replace and Configure Disk:"})," Physically replace the hardware. Mount the new, empty disk at the path(s) defined in ",(0,o.jsx)(n.code,{children:"ozone.recon.db.dir"}),", ",(0,o.jsx)(n.code,{children:"ozone.recon.om.db.dir"}),", and ",(0,o.jsx)(n.code,{children:"ozone.recon.scm.db.dirs"})," (if configured). Ensure the directories exist and have the correct ownership and permissions for the user that runs the Recon process."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"RE-START THE Recon SERVICE:"})," Simply start the Recon daemon again."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"MONITOR THE AUTOMATIC REBUILD PROCESS:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Upon starting with empty directories, Recon will automatically begin to rebuild its state."}),"\n",(0,o.jsxs)(n.li,{children:["Check the Recon log files (",(0,o.jsx)(n.code,{children:".log"})," and ",(0,o.jsx)(n.code,{children:".out"}),"). You will see messages indicating that it is connecting to the active OM and SCM."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"OM Snapshot Download:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Recon will detect that its OM database is empty (by checking the sequence number, which will be 0 or negative)."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"When the sequence number is less than or equal to 0, Recon automatically triggers a full snapshot download from the OM leader."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"This is the most time-consuming part of the process. Recon will download the snapshot as a tar file, extract it, and begin processing it to populate its own namespace database."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"You will see log messages such as:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Seq number of Recon's OM DB : 0\nFetching full snapshot from Ozone Manager\nObtaining full snapshot from Ozone Manager\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["The snapshot download happens via HTTP from the OM leader, and the extracted snapshot is stored in the ",(0,o.jsx)(n.code,{children:"ozone.recon.om.db.dir"})," directory."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"SCM Sync:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Recon will also connect to the SCM to sync information about Datanodes, pipelines, and containers."}),"\n",(0,o.jsxs)(n.li,{children:["If SCM snapshot is enabled (",(0,o.jsx)(n.code,{children:"ozone.recon.scm.snapshot.enabled=true"}),", which is the default), Recon will initialize or download the SCM database snapshot."]}),"\n",(0,o.jsx)(n.li,{children:"If SCM snapshot is disabled, Recon will initialize pipeline information directly from SCM via RPC calls."}),"\n",(0,o.jsx)(n.li,{children:"The SCM sync happens periodically (default interval: 24 hours) and also during initial startup."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Recon Database Rebuild:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Once the OM snapshot is downloaded and processed, Recon's task framework will automatically process the metadata to rebuild:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["ContainerKey and ContainerKeyCount tables (stored in RocksDB at ",(0,o.jsx)(n.code,{children:"ozone.recon.db.dir"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"GlobalStats, FileCountBySize, and other SQL tables (stored in the SQL database)"}),"\n",(0,o.jsx)(n.li,{children:"Namespace summary information"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"This processing happens asynchronously and may take additional time depending on the size of your cluster's metadata."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"VERIFY:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The initial data ingest and processing can take a significant amount of time, depending on the size of your cluster's metadata."}),"\n",(0,o.jsx)(n.li,{children:"During this period, the Recon Web UI may be accessible but show incomplete or loading data."}),"\n",(0,o.jsxs)(n.li,{children:["Monitor the Recon logs for completion messages. Look for:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Successful snapshot download and installation"}),"\n",(0,o.jsx)(n.li,{children:"Task completion messages for various Recon tasks (NSSummaryTask, ContainerKeyMapperTask, etc.)"}),"\n",(0,o.jsx)(n.li,{children:"Sequence number updates indicating sync progress"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Once the processing is complete, navigate the Recon UI to verify that the dashboard correctly displays cluster health, container information, and allows you to explore the namespace."}),"\n",(0,o.jsx)(n.li,{children:"You can also check the Recon metrics endpoint to verify that sync operations have completed successfully."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-additional-considerations",children:"4. Additional Considerations"}),"\n",(0,o.jsx)(n.h3,{id:"41-no-data-loss-risk",children:"4.1 No Data Loss Risk"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This procedure involves no risk of data loss for your actual stored objects."}),"\n",(0,o.jsx)(n.li,{children:"All data on the Recon disk is secondary and can be rebuilt."}),"\n",(0,o.jsx)(n.li,{children:"The Recon service is designed to automatically recover from empty or missing databases by fetching fresh snapshots from OM and SCM."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"42-performance-impact-during-rebuild",children:"4.2 Performance Impact During Rebuild"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The initial OM DB snapshot download and processing can be resource-intensive (CPU, network, disk I/O) on both the Recon node and the OM leader."}),"\n",(0,o.jsx)(n.li,{children:"If your cluster is under very heavy load, consider performing this during off-peak hours to minimize any potential performance impact on the OM."}),"\n",(0,o.jsxs)(n.li,{children:["The default initial delay before the first sync is 1 minute (configurable via ",(0,o.jsx)(n.code,{children:"ozone.recon.om.snapshot.task.initial.delay"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"43-scm-snapshot-configuration",children:"4.3 SCM Snapshot Configuration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["By default, SCM snapshot is enabled (",(0,o.jsx)(n.code,{children:"ozone.recon.scm.snapshot.enabled=true"}),")."]}),"\n",(0,o.jsx)(n.li,{children:"If you have disabled SCM snapshots, Recon will still sync container and pipeline information from SCM, but it will do so via RPC calls rather than downloading a database snapshot."}),"\n",(0,o.jsx)(n.li,{children:"The recovery procedure remains the same in both cases."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"44-disk-monitoring",children:"4.4 Disk Monitoring"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"As with all services, actively monitoring disk health is a good practice to proactively manage hardware failures and avoid unexpected interruptions to the Recon service."}),"\n",(0,o.jsx)(n.li,{children:"Consider setting up monitoring alerts for disk space usage and disk health metrics."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},62392:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(30758);const o={},r=i.createContext(o);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);