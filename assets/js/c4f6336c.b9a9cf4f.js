"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[4933],{62392:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>a});var t=n(30758);const r={},i=t.createContext(r);function c(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:s},e.children)}},69886:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"user-guide/client-interfaces/s3/securing-s3","title":"Securing S3","description":"To access an S3 bucket, users need AWS access key ID and AWS secret. Both of","source":"@site/docs/04-user-guide/01-client-interfaces/03-s3/02-securing-s3.md","sourceDirName":"04-user-guide/01-client-interfaces/03-s3","slug":"/user-guide/client-interfaces/s3/securing-s3","permalink":"/docs/user-guide/client-interfaces/s3/securing-s3","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/04-user-guide/01-client-interfaces/03-s3/02-securing-s3.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Securing S3"},"sidebar":"defaultSidebar","previous":{"title":"Overview","permalink":"/docs/user-guide/client-interfaces/s3/s3-api"},"next":{"title":"s3a","permalink":"/docs/user-guide/client-interfaces/s3a"}}');var r=n(86070),i=n(62392);const c={sidebar_label:"Securing S3"},a="Securing S3",o={},l=[{value:"Obtain Secrets",id:"obtain-secrets",level:2},{value:"Using the command line",id:"using-the-command-line",level:3},{value:"Using the REST API",id:"using-the-rest-api",level:3},{value:"Revoking Secrets via REST API",id:"revoking-secrets-via-rest-api",level:2},{value:"Endpoint Details",id:"endpoint-details",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Example 1: Revoke Secret for the Current User",id:"example-1-revoke-secret-for-the-current-user",level:3},{value:"Example 2: Revoke Secret by Username",id:"example-2-revoke-secret-by-username",level:3},{value:"Response",id:"response",level:3},{value:"Testing and Verification",id:"testing-and-verification",level:3}];function d(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"securing-s3",children:"Securing S3"})}),"\n",(0,r.jsx)(s.p,{children:"To access an S3 bucket, users need AWS access key ID and AWS secret. Both of\nthese are generated by going to AWS website. When you use Ozone's S3\nprotocol, you need the same AWS access key and secret."}),"\n",(0,r.jsxs)(s.p,{children:["Under Ozone, the clients can download the access key directly from Ozone.\nThe user needs to ",(0,r.jsx)(s.code,{children:"kinit"})," first and once they have authenticated via Kerberos\nthey can download the S3 access key ID and AWS secret. Just like AWS S3,\nboth of these are secrets that need to be protected by the client since it\ngives full access to the S3 buckets."]}),"\n",(0,r.jsx)(s.h2,{id:"obtain-secrets",children:"Obtain Secrets"}),"\n",(0,r.jsx)(s.p,{children:"S3 clients can get the secret access ID and user secret from OzoneManager."}),"\n",(0,r.jsx)(s.h3,{id:"using-the-command-line",children:"Using the command line"}),"\n",(0,r.jsx)(s.p,{children:"For a regular user to get their own secret:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ozone s3 getsecret\n"})}),"\n",(0,r.jsxs)(s.p,{children:["An Ozone administrator can get a secret for a specific user by using the ",(0,r.jsx)(s.code,{children:"-u"})," flag:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ozone s3 getsecret -u <username>\n"})}),"\n",(0,r.jsx)(s.h3,{id:"using-the-rest-api",children:"Using the REST API"}),"\n",(0,r.jsxs)(s.p,{children:["A user can get their own secret by making a ",(0,r.jsx)(s.code,{children:"PUT"})," request to the ",(0,r.jsx)(s.code,{children:"/secret"})," endpoint:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl -X PUT --negotiate -u : https://localhost:9879/secret\n"})}),"\n",(0,r.jsx)(s.p,{children:"An Ozone administrator can get a secret for a specific user by appending the username to the path:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl -X PUT --negotiate -u : https://localhost:9879/secret/<username>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This command will talk to Ozone, validate the user via Kerberos and generate\nthe AWS credentials. The values will be printed out on the screen. You can\nset these values up in your ",(0,r.jsx)(s.em,{children:".aws"})," file for automatic access while working\nagainst Ozone S3 buckets."]}),"\n",(0,r.jsx)(s.admonition,{type:"caution",children:(0,r.jsx)(s.p,{children:"Please note: These S3 credentials are like your Kerberos passwords\nthat give complete access to your buckets."})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Now you can proceed to setup these secrets in aws configs:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"aws configure set default.s3.signature_version s3v4\naws configure set aws_access_key_id ${accessId}\naws configure set aws_secret_access_key ${secret}\naws configure set region us-west-1\n"})}),"\n",(0,r.jsx)(s.p,{children:"Please refer to AWS S3 documentation on how to use S3 via command line or via\nS3 API."}),"\n",(0,r.jsx)(s.h2,{id:"revoking-secrets-via-rest-api",children:"Revoking Secrets via REST API"}),"\n",(0,r.jsxs)(s.p,{children:["To invalidate/revoke the secret, use ",(0,r.jsx)(s.code,{children:"ozone s3 revokesecret"})," command.\nAlternatively, you can use the REST API endpoint to revoke the secret.\nOzone now provides a REST API endpoint that allows administrators to revoke S3 access secrets. This operation invalidates a secret, ensuring it can no longer be used for authentication."]}),"\n",(0,r.jsx)(s.h3,{id:"endpoint-details",children:"Endpoint Details"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"URL:"})," ",(0,r.jsx)(s.code,{children:"http://localhost:9879/secret"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"HTTP Method:"})," ",(0,r.jsx)(s.code,{children:"DELETE"})]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(s.p,{children:"The API leverages SPNEGO (Kerberos) authentication. The following curl options are used:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"--negotiate"})," enables SPNEGO."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"-u :"})," uses the current Kerberos ticket (an empty username is provided)."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"example-1-revoke-secret-for-the-current-user",children:"Example 1: Revoke Secret for the Current User"}),"\n",(0,r.jsx)(s.p,{children:"This command revokes the secret for the currently authenticated user:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl -X DELETE --negotiate -u : -v http://localhost:9879/secret\n"})}),"\n",(0,r.jsx)(s.h3,{id:"example-2-revoke-secret-by-username",children:"Example 2: Revoke Secret by Username"}),"\n",(0,r.jsxs)(s.p,{children:["This command revokes the secret for a specific user by appending the username as a query parameter. Replace ",(0,r.jsx)(s.code,{children:"testuser"})," with the desired username:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'curl -X DELETE --negotiate -u : -v "http://localhost:9879/secret?username=testuser"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"response",children:"Response"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Success:"})," Returns HTTP ",(0,r.jsx)(s.code,{children:"200 OK"})," along with a confirmation message in JSON format."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Failure:"})," Returns an appropriate HTTP error status and message if there are issues (e.g., authentication failures)."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"testing-and-verification",children:"Testing and Verification"}),"\n",(0,r.jsxs)(s.p,{children:["For a working example of these operations, refer to the ",(0,r.jsx)(s.a,{href:"https://raw.githubusercontent.com/apache/ozone/refs/heads/master/hadoop-ozone/dist/src/main/smoketest/s3/secretrevoke.robot",children:"Secret Revoke Robot Test"}),". This test demonstrates both the default secret revocation and the revocation by username."]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Ensure your Kerberos authentication is correctly configured, as secret revocation is a privileged operation."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);