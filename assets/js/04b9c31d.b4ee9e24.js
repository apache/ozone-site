"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[1793],{62392:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(30758);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},74386:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"quick-start/installation/kubernetes","title":"Try Ozone With Kubernetes","description":"Ozone is designed to work well under Kubernetes. This document provides a guide for deploying and experimenting with Ozone on K8s, using Helm Chart, MiniKube or a self-hosted Kubernetes cluster.","source":"@site/docs/02-quick-start/01-installation/02-kubernetes.md","sourceDirName":"02-quick-start/01-installation","slug":"/quick-start/installation/kubernetes","permalink":"/docs/quick-start/installation/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/02-quick-start/01-installation/02-kubernetes.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Kubernetes"},"sidebar":"defaultSidebar","previous":{"title":"Docker","permalink":"/docs/quick-start/installation/docker"},"next":{"title":"Bare Metal","permalink":"/docs/quick-start/installation/bare-metal"}}');var r=s(86070),i=s(62392);const o={sidebar_label:"Kubernetes"},l="Try Ozone With Kubernetes",c={},a=[{value:"Helm Chart",id:"helm-chart",level:2},{value:"Minikube",id:"minikube",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Deploy the Services",id:"deploy-the-services",level:3},{value:"Access the services",id:"access-the-services",level:3},{value:"Hosted Kubernetes Cluster",id:"hosted-kubernetes-cluster",level:2},{value:"Requirements",id:"requirements-1",level:3},{value:"Deploy to Kubernetes",id:"deploy-to-kubernetes",level:3},{value:"Access the services",id:"access-the-services-1",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"try-ozone-with-kubernetes",children:"Try Ozone With Kubernetes"})}),"\n",(0,r.jsx)(n.p,{children:"Ozone is designed to work well under Kubernetes. This document provides a guide for deploying and experimenting with Ozone on K8s, using Helm Chart, MiniKube or a self-hosted Kubernetes cluster."}),"\n",(0,r.jsx)(n.h2,{id:"helm-chart",children:"Helm Chart"}),"\n",(0,r.jsxs)(n.p,{children:["For a streamlined deployment of Apache Ozone on Kubernetes, consider using the ",(0,r.jsx)(n.a,{href:"https://apache.github.io/ozone-helm-charts/",children:"Apache Ozone Helm Chart"}),". This Helm Chart simplifies the installation and management of an Ozone cluster by packaging best practices into a set of configurable Kubernetes resources."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Add the Ozone Helm Repository"})}),"\n",(0,r.jsx)(n.p,{children:"First, add the Apache Ozone Helm repository and update your local Helm repo cache:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"helm repo add ozone-helm https://apache.github.io/ozone-helm-charts/\nhelm repo update\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Install the Chart"}),"\n",(0,r.jsx)(n.p,{children:"Install the Ozone Helm Chart using the following command. This command deploys a default Ozone cluster:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"helm install my-ozone-cluster ozone-helm/ozone\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Customize Your Deployment"}),"\n",(0,r.jsx)(n.p,{children:"To customize the configuration, create or modify a values.yaml file with your desired settings and install the chart as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"helm install my-ozone-cluster -f values.yaml ozone-helm/ozone\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For more detailed documentation and advanced configuration options, please refer to the ",(0,r.jsx)(n.a,{href:"https://apache.github.io/ozone-helm-charts/",children:"Apache Ozone Helm Chart"})," documentation."]}),"\n",(0,r.jsx)(n.h2,{id:"minikube",children:"Minikube"}),"\n",(0,r.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Working minikube setup"}),"\n",(0,r.jsx)(n.li,{children:"kubectl"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"deploy-the-services",children:"Deploy the Services"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"kubernetes/examples"})," directory of the Ozone distribution contains Kubernetes deployment resource files for multiple use cases. By default the Kubernetes resource files are configured to use the ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/apache/ozone",children:"apache/ozone"})," image from Docker Hub."]}),"\n",(0,r.jsx)(n.p,{children:"To deploy it to minikube, use the minikube configuration set:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd kubernetes/examples/minikube\nkubectl apply -k .\n"})}),"\n",(0,r.jsx)(n.p,{children:"And you can check the results with"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pod\nkubectl exec scm-0 -- ozone version\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["the ",(0,r.jsx)(n.code,{children:"kubernetes/examples/minikube"})," resource set is optimized for minikube usage:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You can have multiple Datanodes even if you have only one host (in a real production cluster usually you need one Datanode per physical host)"}),"\n",(0,r.jsx)(n.li,{children:"The services are published with node port"}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"access-the-services",children:"Access the services"}),"\n",(0,r.jsx)(n.p,{children:"Now you can access any of the services. For each web endpoint an additional NodeType service is defined in the minikube k8s resource set. NodeType services are available via a generated port on any of the host nodes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get svc\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\ndatanode     ClusterIP   None            <none>        <none>           27s\nkubernetes   ClusterIP   10.96.0.1       <none>        443/TCP          118m\nom           ClusterIP   None            <none>        9874/TCP         27s\nom-public    NodePort    10.108.48.148   <none>        9874:32649/TCP   27s\ns3g          ClusterIP   None            <none>        9878/TCP         27s\ns3g-public   NodePort    10.97.133.137   <none>        9878:31880/TCP   27s\nscm          ClusterIP   None            <none>        9876/TCP         27s\nscm-public   NodePort    10.105.231.28   <none>        9876:32171/TCP   27s\n"})}),"\n",(0,r.jsx)(n.p,{children:"Minikube provides a convenience command to access any of the NodePort services:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"minikube service s3g-public\nOpening kubernetes service default/s3g-public in default browser...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hosted-kubernetes-cluster",children:"Hosted Kubernetes Cluster"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," The Kubernetes examples and scripts here have been tested with Kubernetes 1.34.2 (k3s v1.34.2+k3s1)."]}),"\n",(0,r.jsx)(n.h3,{id:"requirements-1",children:"Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Working Kubernetes cluster (LoadBalancer, PersistentVolume are not required)"}),"\n",(0,r.jsx)(n.li,{children:"kubectl"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"deploy-to-kubernetes",children:"Deploy to Kubernetes"}),"\n",(0,r.jsxs)(n.p,{children:["As ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/apache/ozone",children:"apache/ozone"})," images are available from Docker Hub, the deployment process is very similar to Minikube deployment. The only big difference is that we have dedicated set of k8s files for hosted clusters (for example we can use one Datanode per host)"]}),"\n",(0,r.jsx)(n.p,{children:"To deploy to a hosted cluster, use the Ozone subdirectory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd kubernetes/examples/ozone\nkubectl apply -k .\n"})}),"\n",(0,r.jsx)(n.p,{children:"And you can check the results with"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pod\nkubectl exec scm-0 -- ozone version\n"})}),"\n",(0,r.jsx)(n.h3,{id:"access-the-services-1",children:"Access the services"}),"\n",(0,r.jsx)(n.p,{children:"Now you can access any of the services. By default the services are not published but you can access them with port-forward rules."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward s3g-0 9878:9878\nkubectl port-forward scm-0 9876:9876\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);