"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[9451],{62392:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>r});var t=a(30758);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},69519:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"system-internals/components/datanode/rocksdb-schema","title":"Datanode Container Schema v3","description":"In Ozone, user data are separated into blocks and stored in HDDS Containers. Containers are the fundamental replication unit of Ozone/HDDS. Each Container has its metadata and data. Data are saved as files on disk. Metadata is saved in RocksDB.","source":"@site/docs/07-system-internals/01-components/03-datanode/02-rocksdb-schema.md","sourceDirName":"07-system-internals/01-components/03-datanode","slug":"/system-internals/components/datanode/rocksdb-schema","permalink":"/docs/system-internals/components/datanode/rocksdb-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/07-system-internals/01-components/03-datanode/02-rocksdb-schema.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Datanode Container Schema v3"},"sidebar":"defaultSidebar","previous":{"title":"Disk Layout","permalink":"/docs/system-internals/components/datanode/disk-layout"},"next":{"title":"In-Memory Storage","permalink":"/docs/system-internals/components/datanode/in-memory-storage"}}');var s=a(86070),o=a(62392);const i={sidebar_label:"Datanode Container Schema v3"},r="Datanode Container Schema v3",d={},c=[{value:"Configuration",id:"configuration",level:2},{value:"Backward Compatibility",id:"backward-compatibility",level:2},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"datanode-container-schema-v3",children:"Datanode Container Schema v3"})}),"\n",(0,s.jsx)(n.p,{children:"In Ozone, user data are separated into blocks and stored in HDDS Containers. Containers are the fundamental replication unit of Ozone/HDDS. Each Container has its metadata and data. Data are saved as files on disk. Metadata is saved in RocksDB."}),"\n",(0,s.jsx)(n.p,{children:"Earlier, there was one RocksDB for each Container on Datanode. With user data continuously growing, there will be hundreds of thousands of RocksDB instances on one Datanode. It's a big challenge to manage this amount of RocksDB instances in one JVM."}),"\n",(0,s.jsx)(n.p,{children:"Unlike the previous approach, Container Schema v3 uses only one RocksDB for each data volume, holding all metadata of Containers in this RocksDB."}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"This is mainly a Datanode feature, which doesn't require much configuration. By default, it is enabled."}),"\n",(0,s.jsx)(n.p,{children:'Here is a configuration which disables this feature if the "one RocksDB for each container" mode is more preferred. Please be noted that once the feature is enabled, it\'s strongly suggested not to disable it later.'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<property>\n   <name>hdds.datanode.container.schema.v3.enabled</name>\n   <value>false</value>\n   <description>Disable or enable this feature.</description>\n</property>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Without any specific configuration, the single RocksDB will be created under the data volume configured in ",(0,s.jsx)(n.code,{children:"hdds.datanode.dir"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"For some advanced cluster admins who have the high performance requirement, they can leverage quick storages to save RocksDB. In this case, configure these two properties:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<property>\n   <name>hdds.datanode.container.db.dir</name>\n   <value/>\n   <description>This setting is optional. Specify where the per-disk RocksDB instances will be stored.</description>\n</property>\n\n<property>\n   <name>hdds.datanode.failed.db.volumes.tolerated</name>\n   <value>-1</value>\n   <description>The number of db volumes that are allowed to fail before a Datanode stops offering service.\n   Default -1 means unlimited, but we should have at least one good volume left.</description>\n</property>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"backward-compatibility",children:"Backward Compatibility"}),"\n",(0,s.jsx)(n.p,{children:"Existing containers each has one RocksDB for them will be still accessible after this feature is enabled. All container data will co-exist in an existing Ozone cluster."}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Design doc: ",(0,s.jsx)(n.a,{href:"https://ozone.apache.org/docs/edge/design/dn-merge-rocksdb.html",children:"HDDS-3630 Merge Container RocksDB in DN"})]}),"\n",(0,s.jsxs)(n.li,{children:["Jira: ",(0,s.jsx)(n.a,{href:"https://issues.apache.org/jira/browse/HDDS-3630",children:"HDDS-3630"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);