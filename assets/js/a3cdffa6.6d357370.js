"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[8379],{62392:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(30758);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}},85765:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"administrator-guide/configuration/performance/multi-raft","title":"Multi-Raft","description":"Multi-Raft in Datanodes","source":"@site/versioned_docs/version-2.1.0/05-administrator-guide/02-configuration/04-performance/03-multi-raft.md","sourceDirName":"05-administrator-guide/02-configuration/04-performance","slug":"/administrator-guide/configuration/performance/multi-raft","permalink":"/docs/administrator-guide/configuration/performance/multi-raft","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/master/versioned_docs/version-2.1.0/05-administrator-guide/02-configuration/04-performance/03-multi-raft.md","tags":[],"version":"2.1.0","sidebarPosition":3,"frontMatter":{"sidebar_label":"Multi-Raft"},"sidebar":"defaultSidebar","previous":{"title":"Topology","permalink":"/docs/administrator-guide/configuration/performance/topology"},"next":{"title":"RocksDB In Apache Ozone","permalink":"/docs/administrator-guide/configuration/performance/rocksdb"}}');var r=i(86070),s=i(62392);const a={sidebar_label:"Multi-Raft"},o="Multi-Raft",d={},l=[{value:"Multi-Raft in Datanodes",id:"multi-raft-in-datanodes",level:2},{value:"Background",id:"background",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Configuration",id:"configuration",level:2},{value:"How to Use",id:"how-to-use",level:2},{value:"Operational Tips",id:"operational-tips",level:2},{value:"Advanced Ratis Configuration",id:"advanced-ratis-configuration",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"multi-raft",children:"Multi-Raft"})}),"\n",(0,r.jsx)(n.h2,{id:"multi-raft-in-datanodes",children:"Multi-Raft in Datanodes"}),"\n",(0,r.jsx)(n.p,{children:"Multi-Raft support allows a Datanode to participate\nmultiple Ratis replication groups (pipelines) at the same time\nfor improving write throughput and ensuring better utilization\nof disk and network resources.\nThis is particularly useful when Datanodes have multiple disks\nor the network has a very high bandwidth."}),"\n",(0,r.jsx)(n.h3,{id:"background",children:"Background"}),"\n",(0,r.jsx)(n.p,{children:"The early Ozone versions supported only one Raft pipeline per Datanode.\nThis limited its concurrent write handling capacity for replicated data\nand led to under-utilization of resources.\nThe use of Multi-Raft tremendously improved the resource utilization."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ozone 0.5.0 or later"}),"\n",(0,r.jsx)(n.li,{children:"Replication type: Ratis"}),"\n",(0,r.jsxs)(n.li,{children:["Multiple metadata directories on each Datanode\n(via ",(0,r.jsx)(n.code,{children:"hdds.container.ratis.datanode.storage.dir"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Adequate CPU, memory, and network bandwidth"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsx)(n.p,{children:"SCM can now create overlapping pipelines:\neach Datanode can join multiple Raft groups\nup to a configurable limit.\nThis boosts concurrency and avoids idle nodes and idle disks.\nRaft logs are stored separately on different metadata directories\nin order to reduce disk contention.\nRatis handles concurrent logs per node."}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hdds.container.ratis.datanode.storage.dir"})," (no default)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A list of metadata directory paths."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ozone.scm.datanode.pipeline.limit"})," (default: 2)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The maximum number of pipelines per Datanode can be engaged in.\nThe value 0 means that the pipeline limit per Datanode will be determined\nby the number of metadata disks reported per Datanode;\nsee the next property."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ozone.scm.pipeline.per.metadata.disk"})," (default: 2)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The maximum number of pipelines for a Datanode is determined\nby the number of disks in that Datanode.\nThis property is effective only when the previous property is set to 0.\nThe value of this property must be greater than 0."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-to-use",children:"How to Use"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure Datanode metadata directories:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<property>\n  <name>hdds.container.ratis.datanode.storage.dir</name>\n  <value>/disk1/ratis,/disk2/ratis,/disk3/ratis,/disk4/ratis</value>\n</property>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set pipeline limits in ",(0,r.jsx)(n.code,{children:"ozone-site.xml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<property>\n  <name>ozone.scm.datanode.pipeline.limit</name>\n  <value>0</value>\n</property>\n<property>\n  <name>ozone.scm.pipeline.per.metadata.disk</name>\n  <value>2</value>\n</property>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Restart SCM and Datanodes."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Validate with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ozone admin pipeline list\nozone admin datanode list\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"operational-tips",children:"Operational Tips"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Monitor with ",(0,r.jsx)(n.code,{children:"ozone admin"})," CLI and the Recon UI."]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure pipeline count matches expectations.\nFor optimal I/O isolation,\nconfigure ",(0,r.jsx)(n.code,{children:"hdds.container.ratis.datanode.storage.dir"}),"\nwith paths on multiple distinct physical disks.\nThe Ratis pipelines will be distributed accordingly.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Be cautious with very high pipeline counts due to memory/CPU overhead."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"advanced-ratis-configuration",children:"Advanced Ratis Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Any Ratis configuration properties can be set by prepending a corresponding prefix.\nThe following table shows the prefixes in each Ozone component."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Ozone Components"}),(0,r.jsx)(n.th,{children:"Configuration Prefixes"}),(0,r.jsxs)(n.th,{children:["Examples: To set ",(0,r.jsx)(n.code,{children:"raft.server.write.byte-limit"})]})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Ozone Manager (OM)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ozone.om.ha."})}),(0,r.jsxs)(n.td,{children:["Use ",(0,r.jsx)(n.code,{children:"ozone.om.ha.raft.server.write.byte-limit"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Storage Container Manager (SCM)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ozone.scm.ha."})}),(0,r.jsxs)(n.td,{children:["Use ",(0,r.jsx)(n.code,{children:"ozone.scm.ha.raft.server.write.byte-limit"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Datanode"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"hdds.ratis."})}),(0,r.jsxs)(n.td,{children:["Use ",(0,r.jsx)(n.code,{children:"hdds.ratis.raft.server.write.byte-limit"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Ozone Client"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"hdds.ratis."})}),(0,r.jsxs)(n.td,{children:["Use ",(0,r.jsx)(n.code,{children:"hdds.ratis.raft.server.write.byte-limit"})]})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["See also ",(0,r.jsx)(n.a,{href:"https://github.com/apache/ratis/blob/ratis-3.2.1/ratis-docs/src/site/markdown/configurations.md",children:"Apache Ratis configuration\ndocumentation"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Global configuration: cannot set per-node limits"}),"\n",(0,r.jsx)(n.li,{children:"Requires restart after changing storage dirs"}),"\n",(0,r.jsx)(n.li,{children:"No effect on Erasure-Coding (EC) pipelines"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Design doc: ",(0,r.jsx)(n.a,{href:"https://ozone.apache.org/docs/edge/design/multiraft.html",children:"HDDS-1564 Ozone multi-raft support"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);