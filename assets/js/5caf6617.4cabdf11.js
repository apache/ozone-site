"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[4626],{21702:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/OzoneManager-4d310b421f2dddc728e6d613be8d49f2.png"},23245:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/OzoneManager-WritePath-42ea66efe76c49fd5250f338d653fec7.png"},62392:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(30758);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}},69100:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/OzoneManager-ReadPath-21af8267b6511eb134b7d1936dd88421.png"},73001:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"core-concepts/architecture/ozone-manager","title":"Ozone Manager","description":"Ozone Manager","source":"@site/docs/03-core-concepts/01-architecture/02-ozone-manager.md","sourceDirName":"03-core-concepts/01-architecture","slug":"/core-concepts/architecture/ozone-manager","permalink":"/docs/core-concepts/architecture/ozone-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/03-core-concepts/01-architecture/02-ozone-manager.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Ozone Manager"},"sidebar":"defaultSidebar","previous":{"title":"Overview","permalink":"/docs/core-concepts/architecture/overview"},"next":{"title":"Ozone S3 Gateway","permalink":"/docs/core-concepts/architecture/s3-gateway"}}');var i=t(86070),r=t(62392);const s={sidebar_label:"Ozone Manager"},o="Ozone Manager",l={},d=[{value:"Ozone Manager Metadata",id:"ozone-manager-metadata",level:2},{value:"Ozone Manager and Storage Container Manager",id:"ozone-manager-and-storage-container-manager",level:2},{value:"Key Write",id:"key-write",level:3},{value:"Key Reads",id:"key-reads",level:3},{value:"Main Components of the Ozone Manager",id:"main-components-of-the-ozone-manager",level:2},{value:"Network Services Provided by Ozone Manager",id:"network-services-provided-by-ozone-manager",level:3},{value:"Persisted State",id:"persisted-state",level:3},{value:"Notable Configurations",id:"notable-configurations",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ozone-manager",children:"Ozone Manager"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Ozone Manager",src:t(21702).A+"",width:"379",height:"294"})}),"\n",(0,i.jsx)(n.p,{children:"Ozone Manager (OM) is the namespace manager for Ozone."}),"\n",(0,i.jsx)(n.p,{children:"This means that when you want to write some data, you ask Ozone Manager for a block and Ozone Manager gives you a block and remembers that information. When you want to read that file back, you need to find the address of the block and the Ozone Manager returns it to you."}),"\n",(0,i.jsx)(n.p,{children:"Ozone Manager also allows users to organize keys under a volume and bucket. Volumes and buckets are part of the namespace and managed by Ozone Manager."}),"\n",(0,i.jsx)(n.p,{children:"Each Ozone volume is the root of an independent namespace under OM. This is very different from HDFS which provides a single rooted file system."}),"\n",(0,i.jsx)(n.p,{children:"Ozone's namespace is a collection of volumes or is a forest instead of a single rooted tree as in HDFS. This property makes it easy to deploy multiple OMs for scaling(pending future development)."}),"\n",(0,i.jsx)(n.h2,{id:"ozone-manager-metadata",children:"Ozone Manager Metadata"}),"\n",(0,i.jsx)(n.p,{children:"OM maintains a list of volumes, buckets, and keys. For each user, it maintains a list of volumes. For each volume, the list of buckets and for each bucket the list of keys."}),"\n",(0,i.jsxs)(n.p,{children:["Ozone Manager will use ",(0,i.jsx)(n.a,{href:"https://ratis.apache.org/",children:"Apache Ratis"})," (A Raft protocol implementation) to replicate Ozone Manager state.  This will ensure High Availability for Ozone Manager."]}),"\n",(0,i.jsx)(n.h2,{id:"ozone-manager-and-storage-container-manager",children:"Ozone Manager and Storage Container Manager"}),"\n",(0,i.jsx)(n.p,{children:"The relationship between Ozone Manager and Storage Container Manager (SCM) is best understood if we trace what happens during a key write and key read."}),"\n",(0,i.jsx)(n.h3,{id:"key-write",children:"Key Write"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Ozone Manager Write Path",src:t(23245).A+"",width:"909",height:"441"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To write a key to Ozone, a client tells Ozone Manager that it would like to write a key into a bucket that lives inside a specific volume. Once Ozone Manager determines that you are allowed to write a key to the specified bucket, OM needs to allocate a block for the client to write data."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To allocate a block, Ozone Manager sends a request to Storage Container Manager (SCM);  SCM is the manager of data nodes. SCM picks three data nodes into which client can write data. SCM allocates the block and returns the block ID to Ozone Manager."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ozone Manager records this block information in its metadata and returns the block and a  block token (a security permission to write data to the block) to the client."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The client uses the block token to prove that it is allowed to write data to the block and writes data to the data node."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Once the write is complete on the data node, the client will update the block information on Ozone Manager."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-reads",children:"Key Reads"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Ozone Manager Read Path",src:t(69100).A+"",width:"623",height:"324"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Key reads are simpler, the client requests the block list from the Ozone Manager"}),"\n",(0,i.jsx)(n.li,{children:"Ozone Manager will return the block list and block tokens which allows the client to read the data from data nodes."}),"\n",(0,i.jsx)(n.li,{children:"Client connects to the data node and presents the block token and reads the data from the data node."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"main-components-of-the-ozone-manager",children:"Main Components of the Ozone Manager"}),"\n",(0,i.jsx)(n.p,{children:"For a detailed view of Ozone Manager this section gives a quick overview about the provided network services and the stored persisted data."}),"\n",(0,i.jsx)(n.h3,{id:"network-services-provided-by-ozone-manager",children:"Network Services Provided by Ozone Manager"}),"\n",(0,i.jsx)(n.p,{children:"Ozone provides a network service for the client and for administration commands. The main service calls:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Key, Bucket, Volume / CRUD"}),"\n",(0,i.jsxs)(n.li,{children:["Multipart upload (Initiate, Complete\u2026)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Supports upload of huge files in multiple steps"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["FS related calls (optimized for hierarchical queries instead of a flat ObjectStore namespace)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"GetFileStatus, CreateDirectory, CreateFile, LookupFile"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["ACL related","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Managing ACLs if ",(0,i.jsx)(n.a,{href:"/docs/core-concepts/security/acls/native-acls",children:"Native ACLs"})," are used instead of ",(0,i.jsx)(n.a,{href:"/docs/core-concepts/security/acls/ranger-acls",children:"Ranger ACLs"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Delegation token (Get / Renew / Cancel)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For security"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Admin APIs","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Get S3 secret"}),"\n",(0,i.jsx)(n.li,{children:"ServiceList (used for service discovery)"}),"\n",(0,i.jsx)(n.li,{children:"DBUpdates (used by Recon downloads snapshots)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"persisted-state",children:"Persisted State"}),"\n",(0,i.jsx)(n.p,{children:"The following data is persisted in Ozone Manager side in a specific RocksDB directory:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Volume / Bucket / Key tables","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This is the main responsibility of OM"}),"\n",(0,i.jsx)(n.li,{children:"Key metadata contains the block id (which includes container id) to find the data"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["OpenKey table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"for keys which are created, but not yet committed"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Delegation token table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"for security"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["PrefixInfo table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"specific index table to store directory level ACL and to provide better performance for hierarchical queries"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["S3 secret table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For S3 secret management"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Multipart info table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Inflight uploads should be tracked"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Deleted table","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"To track the blocks which should be deleted from the Datanodes"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"notable-configurations",children:"Notable Configurations"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Key"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ozone.om.address"})}),(0,i.jsx)(n.td,{children:"0.0.0.0:9862"}),(0,i.jsx)(n.td,{children:"RPC address of the OM. Required by the client."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ozone.om.http-address"})}),(0,i.jsx)(n.td,{children:"0.0.0.0:9874"}),(0,i.jsx)(n.td,{children:"Default port of the HTTP server."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ozone.metadata.dirs"})}),(0,i.jsx)(n.td,{children:"none"}),(0,i.jsx)(n.td,{children:"Directory to store persisted data (RocksDB)."})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);