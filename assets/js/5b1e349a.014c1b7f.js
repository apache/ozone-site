"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[8675],{54568:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"administrator-guide/configuration/security/kerberos","title":"Configuring Kerberos","description":"Ozone depends on Kerberos to make the clusters secure. Historically, HDFS has supported running in an isolated secure networks where it is possible to deploy without securing the cluster.","source":"@site/docs/05-administrator-guide/02-configuration/03-security/02-kerberos.md","sourceDirName":"05-administrator-guide/02-configuration/03-security","slug":"/administrator-guide/configuration/security/kerberos","permalink":"/docs/administrator-guide/configuration/security/kerberos","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/02-configuration/03-security/02-kerberos.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Kerberos"},"sidebar":"defaultSidebar","previous":{"title":"Administrators","permalink":"/docs/administrator-guide/configuration/security/administrators"},"next":{"title":"Apache Ranger","permalink":"/docs/administrator-guide/configuration/security/ranger"}}');var n=s(86070),i=s(62392);const o={sidebar_label:"Kerberos"},a="Configuring Kerberos",d={},c=[{value:"Tokens",id:"tokens",level:2},{value:"Delegation Token",id:"delegation-token",level:3},{value:"Block Token",id:"block-token",level:3},{value:"S3AuthInfo",id:"s3authinfo",level:3},{value:"Storage Container Manager",id:"storage-container-manager",level:2},{value:"Ozone Manager",id:"ozone-manager",level:2},{value:"S3 Gateway",id:"s3-gateway",level:2},{value:"Securing Datanodes",id:"securing-datanodes",level:2},{value:"How a Datanode becomes secure",id:"how-a-datanode-becomes-secure",level:3},{value:"Certificate Approval via Kerberos",id:"certificate-approval-via-kerberos",level:4},{value:"Manual Approval",id:"manual-approval",level:4},{value:"Automatic Approval",id:"automatic-approval",level:4}];function l(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"configuring-kerberos",children:"Configuring Kerberos"})}),"\n",(0,n.jsxs)(r.p,{children:["Ozone depends on ",(0,n.jsx)(r.a,{href:"https://web.mit.edu/kerberos/",children:"Kerberos"})," to make the clusters secure. Historically, HDFS has supported running in an isolated secure networks where it is possible to deploy without securing the cluster."]}),"\n",(0,n.jsxs)(r.p,{children:["This release of Ozone follows that model, but soon will move to ",(0,n.jsx)(r.em,{children:"secure by default."})," Today to enable security in Ozone cluster, we need to set the configuration ",(0,n.jsx)(r.code,{children:"ozone.security.enabled"})," to ",(0,n.jsx)(r.code,{children:"true"})," and ",(0,n.jsx)(r.code,{children:"hadoop.security.authentication"})," to ",(0,n.jsx)(r.code,{children:"kerberos"}),"."]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Value"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.security.enabled"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"true"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hadoop.security.authentication"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"kerberos"})})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"tokens",children:"Tokens"}),"\n",(0,n.jsx)(r.p,{children:"Ozone uses a notion of tokens to avoid overburdening the Kerberos server. When you serve thousands of requests per second, involving Kerberos might not work well. Hence once an authentication is done, Ozone issues delegation tokens and block tokens to the clients. These tokens allow applications to do specified operations against the cluster, as if they have kerberos tickets with them. Ozone supports following kinds of tokens."}),"\n",(0,n.jsx)(r.h3,{id:"delegation-token",children:"Delegation Token"}),"\n",(0,n.jsx)(r.p,{children:"Delegation tokens allow an application to impersonate a users kerberos credentials. This token is based on verification of kerberos identity and is issued by the Ozone Manager. Delegation tokens are enabled by default when security is enabled."}),"\n",(0,n.jsx)(r.h3,{id:"block-token",children:"Block Token"}),"\n",(0,n.jsx)(r.p,{children:"Block tokens allow a client to read or write a block. This is needed so that Datanodes know that the user/client has permission to read or make modifications to the block."}),"\n",(0,n.jsx)(r.h3,{id:"s3authinfo",children:"S3AuthInfo"}),"\n",(0,n.jsx)(r.p,{children:"S3 uses a very different shared secret security scheme. Ozone supports the AWS Signature Version 4 protocol, and from the end users perspective Ozone's S3 feels exactly like AWS S3."}),"\n",(0,n.jsx)(r.p,{children:"The S3 credential tokens are called S3 auth info in the code. These tokens are also enabled by default when security is enabled."}),"\n",(0,n.jsxs)(r.p,{children:["Each of the service daemons that make up Ozone needs a Kerberos service principal name and a corresponding ",(0,n.jsx)(r.a,{href:"https://web.mit.edu/kerberos/krb5-latest/doc/basic/keytab_def.html",children:"kerberos key tab"})," file."]}),"\n",(0,n.jsxs)(r.p,{children:["All these settings should be made in ",(0,n.jsx)(r.code,{children:"ozone-site.xml"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"storage-container-manager",children:"Storage Container Manager"}),"\n",(0,n.jsx)(r.p,{children:"SCM requires two Kerberos principals, and the corresponding key tab files for both of these principals."}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.scm.kerberos.principal"})}),(0,n.jsxs)(r.td,{children:["The SCM service principal. e.g. ",(0,n.jsx)(r.code,{children:"scm/_HOST@REALM.COM"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.scm.kerberos.keytab.file"})}),(0,n.jsx)(r.td,{children:"The keytab file used by SCM daemon to login as its service principal."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.scm.http.auth.kerberos.principal"})}),(0,n.jsx)(r.td,{children:"SCM HTTP server service principal if SPNEGO is enabled for SCM HTTP server."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.scm.http.auth.kerberos.keytab"})}),(0,n.jsx)(r.td,{children:"The keytab file used by SCM HTTP server to login as its service principal if SPNEGO is enabled for SCM HTTP server."})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"ozone-manager",children:"Ozone Manager"}),"\n",(0,n.jsx)(r.p,{children:"Like SCM, OM also requires two Kerberos principals, and the corresponding key tab files for both of these principals."}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.om.kerberos.principal"})}),(0,n.jsxs)(r.td,{children:["The OzoneManager service principal. e.g. ",(0,n.jsx)(r.code,{children:"om/_HOST@REALM.COM"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.om.kerberos.keytab.file"})}),(0,n.jsx)(r.td,{children:"The keytab file used by OM daemon to login as its service principal."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.om.http.auth.kerberos.principal"})}),(0,n.jsx)(r.td,{children:"Ozone Manager HTTP server service principal if SPNEGO is enabled for OM HTTP server."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.om.http.auth.kerberos.keytab"})}),(0,n.jsx)(r.td,{children:"The keytab file used by OM HTTP server to login as its service principal if SPNEGO is enabled for OM HTTP server."})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"s3-gateway",children:"S3 Gateway"}),"\n",(0,n.jsxs)(r.p,{children:["S3 Gateway requires one service principal and here the configuration values needed in the ",(0,n.jsx)(r.code,{children:"ozone-site.xml"}),"."]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.s3g.kerberos.principal"})}),(0,n.jsxs)(r.td,{children:["S3 Gateway principal. e.g. ",(0,n.jsx)(r.code,{children:"s3g/_HOST@REALM"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.s3g.kerberos.keytab.file"})}),(0,n.jsxs)(r.td,{children:["The keytab file used by S3 Gateway. e.g. ",(0,n.jsx)(r.code,{children:"/etc/security/keytabs/s3g.keytab"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.s3g.http.auth.kerberos.principal"})}),(0,n.jsxs)(r.td,{children:["S3 Gateway principal if SPNEGO is enabled for S3 Gateway HTTP server. e.g. ",(0,n.jsx)(r.code,{children:"HTTP/_HOST@EXAMPLE.COM"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ozone.s3g.http.auth.kerberos.keytab"})}),(0,n.jsx)(r.td,{children:"The keytab file used by S3 Gateway if SPNEGO is enabled for S3 Gateway HTTP server."})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"securing-datanodes",children:"Securing Datanodes"}),"\n",(0,n.jsx)(r.p,{children:"Datanodes under Hadoop is traditionally secured by creating a Keytab file on the Datanodes. With Ozone, we have moved away to using Datanode certificates. That is, Kerberos on Datanodes is not needed in case of a secure Ozone cluster."}),"\n",(0,n.jsxs)(r.p,{children:["However, we support the legacy Kerberos based Authentication to make it easy for the current set of users. The HDFS configuration keys are the following that is setup in ",(0,n.jsx)(r.code,{children:"hdfs-site.xml"}),"."]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"dfs.datanode.kerberos.principal"})}),(0,n.jsxs)(r.td,{children:["The Datanode service principal. e.g. ",(0,n.jsx)(r.code,{children:"dn/_HOST@REALM.COM"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"dfs.datanode.kerberos.keytab.file"})}),(0,n.jsx)(r.td,{children:"The keytab file used by Datanode daemon to login as its service principal."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.datanode.http.auth.kerberos.principal"})}),(0,n.jsx)(r.td,{children:"Datanode HTTP server service principal."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hdds.datanode.http.auth.kerberos.keytab"})}),(0,n.jsx)(r.td,{children:"The keytab file used by Datanode HTTP server to login as its service principal."})]})]})]}),"\n",(0,n.jsx)(r.h3,{id:"how-a-datanode-becomes-secure",children:"How a Datanode becomes secure"}),"\n",(0,n.jsx)(r.p,{children:"Under Ozone, when a Datanode boots up and discovers SCM's address, the first thing that Datanode does is to create a private key and send a certificate request to the SCM."}),"\n",(0,n.jsx)(r.h4,{id:"certificate-approval-via-kerberos",children:"Certificate Approval via Kerberos"}),"\n",(0,n.jsx)(r.p,{children:"SCM has a built-in CA, and SCM has to approve this request. If the Datanode already has a Kerberos key tab, then SCM will trust Kerberos credentials and issue a certificate automatically."}),"\n",(0,n.jsx)(r.h4,{id:"manual-approval",children:"Manual Approval"}),"\n",(0,n.jsx)(r.p,{children:"If these are brand new Datanodes and Kerberos key tabs are not present at the Datanodes, then this request for the Datanodes identity certificate is queued up for approval from the administrator (This is work in progress, not committed in Ozone yet). In other words, the chain of trust is established by the administrator of the cluster."}),"\n",(0,n.jsx)(r.h4,{id:"automatic-approval",children:"Automatic Approval"}),"\n",(0,n.jsx)(r.p,{children:"If you running under an container orchestrator like Kubernetes, we rely on Kubernetes to create a one-time token that will be given to Datanode during boot time to prove the identity of the Datanode container (This is also work in progress.)"}),"\n",(0,n.jsx)(r.p,{children:"Once a certificate is issued, a Datanode is secure and Ozone Manager can issue block tokens. If there is no Datanode certificates or the SCM's root certificate is not present in the Datanode, then Datanode will register itself and download the SCM's root certificate as well get the certificates for itself."})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},62392:(e,r,s)=>{s.d(r,{R:()=>o,x:()=>a});var t=s(30758);const n={},i=t.createContext(n);function o(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);