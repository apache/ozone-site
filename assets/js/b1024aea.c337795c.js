"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[1293],{45974:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"administrator-guide/operations/observability/cli","title":"CLI","description":"ozone insight","source":"@site/docs/05-administrator-guide/03-operations/09-observability/01-cli.md","sourceDirName":"05-administrator-guide/03-operations/09-observability","slug":"/administrator-guide/operations/observability/cli","permalink":"/docs/administrator-guide/operations/observability/cli","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/03-operations/09-observability/01-cli.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"CLI"},"sidebar":"defaultSidebar","previous":{"title":"Observability","permalink":"/docs/administrator-guide/operations/observability/"},"next":{"title":"Recon","permalink":"/docs/administrator-guide/operations/observability/recon/"}}');var i=o(86070),r=o(62392);const s={sidebar_label:"CLI"},a="CLI",c={},l=[{value:"ozone insight",id:"ozone-insight",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Metrics",id:"metrics",level:3},{value:"Logs",id:"logs",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cli",children:"CLI"})}),"\n",(0,i.jsx)(n.h2,{id:"ozone-insight",children:"ozone insight"}),"\n",(0,i.jsx)(n.p,{children:"Ozone insight is a swiss-army-knife tool for checking the current state of Ozone cluster. It can show logging, metrics and configuration for a particular component."}),"\n",(0,i.jsxs)(n.p,{children:["To check the available components use ",(0,i.jsx)(n.code,{children:"ozone insight list"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"> ozone insight list\n\nAvailable insight points:\n\n  scm.node-manager                     SCM Datanode management related information.\n  scm.replica-manager                  SCM closed container replication manager\n  scm.event-queue                      Information about the internal async event delivery\n  scm.protocol.block-location          SCM Block location protocol endpoint\n  scm.protocol.container-location      SCM Container location protocol endpoint\n  scm.protocol.security                SCM Block location protocol endpoint\n  om.key-manager                       OM Key Manager\n  om.protocol.client                   Ozone Manager RPC endpoint\n  datanode.pipeline                    More information about one ratis datanode ring.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ozone insight config"})," can show configuration related to a specific component (supported only for selected components)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"> ozone insight config scm.replica-manager\n\nConfiguration for `scm.replica-manager` (SCM closed container replication manager)\n\n>>> hdds.scm.replication.thread.interval\n       default: 300s\n       current: 300s\n\nThere is a replication monitor thread running inside SCM which takes care of replicating the containers in the cluster. This property is used to configure the interval in which that thread runs.\n\n\n>>> hdds.scm.replication.event.timeout\n       default: 30m\n       current: 30m\n\nTimeout for the container replication/deletion commands sent  to datanodes. After this timeout the command will be retried.\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ozone insight metrics"})," can show metrics related to a specific component (supported only for selected components)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"> ozone insight metrics scm.protocol.block-location\nMetrics for `scm.protocol.block-location` (SCM Block location protocol endpoint)\n\nRPC connections\n\n  Open connections: 0\n  Dropped connections: 0\n  Received bytes: 1267\n  Sent bytes: 2420\n\n\nRPC queue\n\n  RPC average queue time: 0.0\n  RPC call queue length: 0\n\n\nRPC performance\n\n  RPC processing time average: 0.0\n  Number of slow calls: 0\n\n\nMessage type counters\n\n  Number of AllocateScmBlock: ???\n  Number of DeleteScmKeyBlocks: ???\n  Number of GetScmInfo: ???\n  Number of SortDatanodes: ???\n"})}),"\n",(0,i.jsx)(n.h3,{id:"logs",children:"Logs"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ozone insight logs"})," can connect to the required service and show the DEBUG/TRACE log related to one specific component. For example to display RPC message:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"> ozone insight logs om.protocol.client\n\n[OM] 2020-07-28 12:31:49,988 [DEBUG|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher] OzoneProtocol ServiceList request is received\n[OM] 2020-07-28 12:31:50,095 [DEBUG|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher] OzoneProtocol CreateVolume request is received\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"-v"})," flag the content of the protobuf message can also be displayed (TRACE level log):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'> ozone insight logs -v om.protocol.client\n\n[OM] 2020-07-28 12:33:28,463 [TRACE|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher] [service=OzoneProtocol] [type=CreateVolume] request is received:\ncmdType: CreateVolume\ntraceID: ""\nclientId: "client-A31DF5C6ECF2"\ncreateVolumeRequest {\n  volumeInfo {\n    adminName: "hadoop"\n    ownerName: "hadoop"\n    volume: "vol1"\n    quotaInBytes: 1152921504606846976\n    volumeAcls {\n      type: USER\n      name: "hadoop"\n      rights: "200"\n      aclScope: ACCESS\n    }\n    volumeAcls {\n      type: GROUP\n      name: "users"\n      rights: "200"\n      aclScope: ACCESS\n    }\n    creationTime: 1595939608460\n    objectID: 0\n    updateID: 0\n    modificationTime: 0\n  }\n}\n\n[OM] 2020-07-28 12:33:28,474 [TRACE|org.apache.hadoop.ozone.protocolPB.OzoneManagerProtocolServerSideTranslatorPB|OzoneProtocolMessageDispatcher] [service=OzoneProtocol] [type=CreateVolume] request is processed. Response:\ncmdType: CreateVolume\ntraceID: ""\nsuccess: false\nmessage: "Volume already exists"\nstatus: VOLUME_ALREADY_EXISTS\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Under the hood ",(0,i.jsx)(n.code,{children:"ozone insight"})," uses HTTP endpoints to retrieve the required information (",(0,i.jsx)(n.code,{children:"/conf"}),", ",(0,i.jsx)(n.code,{children:"/prom"})," and ",(0,i.jsx)(n.code,{children:"/logLevel"})," endpoints). It's not yet supported in secure environment."]})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},62392:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var t=o(30758);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);