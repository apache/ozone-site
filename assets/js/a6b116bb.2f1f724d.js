"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[7488],{15494:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"administrator-guide/operations/data-balancing/container-balancer","title":"Container Balancer","description":"Overview","source":"@site/docs/05-administrator-guide/03-operations/05-data-balancing/01-container-balancer.md","sourceDirName":"05-administrator-guide/03-operations/05-data-balancing","slug":"/administrator-guide/operations/data-balancing/container-balancer","permalink":"/docs/administrator-guide/operations/data-balancing/container-balancer","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/05-administrator-guide/03-operations/05-data-balancing/01-container-balancer.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Balancing Data Among Datanodes"},"sidebar":"defaultSidebar","previous":{"title":"Data Balancing","permalink":"/docs/administrator-guide/operations/data-balancing/"},"next":{"title":"Balancing Data within Datanode","permalink":"/docs/administrator-guide/operations/data-balancing/disk-balancer"}}');var i=t(86070),r=t(62392);const s={sidebar_label:"Balancing Data Among Datanodes"},d="Container Balancer",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Command Line Usage",id:"command-line-usage",level:2},{value:"Start",id:"start",level:3},{value:"Status",id:"status",level:3},{value:"Stop",id:"stop",level:3},{value:"Configuration",id:"configuration",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"container-balancer",children:"Container Balancer"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Container Balancer is a tool in Apache Ozone that balances data containers across the cluster.\nIts primary goal is to ensure an even distribution of data based on disk space usage on Datanodes.\nThis helps to prevent some Datanodes from becoming full while others remain underutilized."}),"\n",(0,i.jsxs)(n.p,{children:["The balancer operates by moving ",(0,i.jsx)(n.code,{children:"CLOSED"})," container replicas, which means it doesn't interfere with active I/O operations.\nIt is designed to work with both regular and Erasure Coded (EC) containers.\nTo maintain cluster stability, the Container Balancer's startup is delayed after a Storage Container Manager (SCM) failover."]}),"\n",(0,i.jsx)(n.h2,{id:"command-line-usage",children:"Command Line Usage"}),"\n",(0,i.jsxs)(n.p,{children:["The Container Balancer is managed through the ",(0,i.jsx)(n.code,{children:"ozone admin containerbalancer"})," command."]}),"\n",(0,i.jsx)(n.h3,{id:"start",children:"Start"}),"\n",(0,i.jsx)(n.p,{children:"To start the Container Balancer with default settings:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone admin containerbalancer start\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also start the balancer with specific options:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone admin containerbalancer start [options]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Options:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-t"}),", ",(0,i.jsx)(n.code,{children:"--threshold"})]}),(0,i.jsx)(n.td,{children:"The percentage deviation from the average utilization of the cluster after which a Datanode will be rebalanced. Default is 10%."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-i"}),", ",(0,i.jsx)(n.code,{children:"--iterations"})]}),(0,i.jsx)(n.td,{children:"The maximum number of consecutive iterations the balancer will run for. Default is 10. Use -1 for infinite iterations."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-d"}),", ",(0,i.jsx)(n.code,{children:"--maxDatanodesPercentageToInvolvePerIteration"})]}),(0,i.jsx)(n.td,{children:"The maximum percentage of healthy, in-service Datanodes that can be involved in balancing in one iteration. Default is 20%."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-s"}),", ",(0,i.jsx)(n.code,{children:"--maxSizeToMovePerIterationInGB"})]}),(0,i.jsx)(n.td,{children:"The maximum size of data in GB to be moved in one iteration. Default is 500GB."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-e"}),", ",(0,i.jsx)(n.code,{children:"--maxSizeEnteringTargetInGB"})]}),(0,i.jsx)(n.td,{children:"The maximum size in GB that can enter a target Datanode in one iteration. Default is 26GB."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"-l"}),", ",(0,i.jsx)(n.code,{children:"--maxSizeLeavingSourceInGB"})]}),(0,i.jsx)(n.td,{children:"The maximum size in GB that can leave a source Datanode in one iteration. Default is 26GB."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--balancing-iteration-interval-minutes"})}),(0,i.jsx)(n.td,{children:"The interval in minutes between each iteration of the Container Balancer. Default is 70 minutes."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--move-timeout-minutes"})}),(0,i.jsx)(n.td,{children:"The time in minutes to allow a single container to move from source to target. Default is 65 minutes."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--move-replication-timeout-minutes"})}),(0,i.jsx)(n.td,{children:"The time in minutes to allow a single container's replication from source to target as part of a container move. Default is 50 minutes."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--move-network-topology-enable"})}),(0,i.jsx)(n.td,{children:"Whether to consider network topology when selecting a target for a source. Default is false."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--include-datanodes"})}),(0,i.jsx)(n.td,{children:"A comma-separated list of Datanode hostnames or IP addresses to be included in balancing."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--exclude-datanodes"})}),(0,i.jsx)(n.td,{children:"A comma-separated list of Datanode hostnames or IP addresses to be excluded from balancing."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"status",children:"Status"}),"\n",(0,i.jsx)(n.p,{children:"To check the status of the Container Balancer:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone admin containerbalancer status\n"})}),"\n",(0,i.jsx)(n.p,{children:"To get a more detailed status, including the history of iterations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone admin containerbalancer status -v --history\n"})}),"\n",(0,i.jsx)(n.h3,{id:"stop",children:"Stop"}),"\n",(0,i.jsx)(n.p,{children:"To stop the Container Balancer:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ozone admin containerbalancer stop\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The Container Balancer can also be configured through the ",(0,i.jsx)(n.code,{children:"ozone-site.xml"})," file."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Default Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.utilization.threshold"})}),(0,i.jsx)(n.td,{children:"A cluster is considered balanced if for each Datanode, the utilization of the Datanode differs from the utilization of the cluster no more than this threshold."}),(0,i.jsx)(n.td,{children:"10%"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.datanodes.involved.max.percentage.per.iteration"})}),(0,i.jsx)(n.td,{children:"Maximum percentage of healthy, in-service Datanodes that can be involved in balancing in one iteration."}),(0,i.jsx)(n.td,{children:"20%"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.size.moved.max.per.iteration"})}),(0,i.jsx)(n.td,{children:"The maximum size of data that will be moved by Container Balancer in one iteration."}),(0,i.jsx)(n.td,{children:"500GB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.size.entering.target.max"})}),(0,i.jsx)(n.td,{children:"The maximum size that can enter a target Datanode in each iteration."}),(0,i.jsx)(n.td,{children:"26GB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.size.leaving.source.max"})}),(0,i.jsx)(n.td,{children:"The maximum size that can leave a source Datanode in each iteration."}),(0,i.jsx)(n.td,{children:"26GB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.iterations"})}),(0,i.jsx)(n.td,{children:"The number of iterations that Container Balancer will run for."}),(0,i.jsx)(n.td,{children:"10"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.exclude.containers"})}),(0,i.jsx)(n.td,{children:"A comma-separated list of container IDs to exclude from balancing."}),(0,i.jsx)(n.td,{children:'""'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.move.timeout"})}),(0,i.jsx)(n.td,{children:"The amount of time to allow a single container to move from source to target."}),(0,i.jsx)(n.td,{children:"65m"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.move.replication.timeout"})}),(0,i.jsx)(n.td,{children:"The amount of time to allow a single container's replication from source to target as part of a container move."}),(0,i.jsx)(n.td,{children:"50m"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.balancing.iteration.interval"})}),(0,i.jsx)(n.td,{children:"The interval period between each iteration of Container Balancer."}),(0,i.jsx)(n.td,{children:"70m"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.include.datanodes"})}),(0,i.jsx)(n.td,{children:"A comma-separated list of Datanode hostnames or IP addresses. Only the Datanodes specified in this list are balanced."}),(0,i.jsx)(n.td,{children:'""'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.exclude.datanodes"})}),(0,i.jsx)(n.td,{children:"A comma-separated list of Datanode hostnames or IP addresses. The Datanodes specified in this list are excluded from balancing."}),(0,i.jsx)(n.td,{children:'""'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.move.networkTopology.enable"})}),(0,i.jsx)(n.td,{children:"Whether to take network topology into account when selecting a target for a source."}),(0,i.jsx)(n.td,{children:"false"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hdds.container.balancer.trigger.du.before.move.enable"})}),(0,i.jsxs)(n.td,{children:["Whether to send a command to all healthy and in-service data nodes to run ",(0,i.jsx)(n.code,{children:"du"})," immediately before starting a balance iteration."]}),(0,i.jsx)(n.td,{children:"false"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},62392:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>d});var a=t(30758);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);