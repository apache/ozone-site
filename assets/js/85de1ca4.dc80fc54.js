"use strict";(self.webpackChunkdoc_site=self.webpackChunkdoc_site||[]).push([[9812],{2392:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>d});var o=i(758);const r={},s=o.createContext(r);function t(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(s.Provider,{value:n},e.children)}},3293:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"developer-guide/build/docker-images","title":"docker-images","description":"This page provides an overview of the Docker images maintained by the Apache Ozone community for developing and testing Ozone.  It also describes the workflow to be followed when making changes to one of these images.","source":"@site/docs/08-developer-guide/01-build/03-docker-images.md","sourceDirName":"08-developer-guide/01-build","slug":"/developer-guide/build/docker-images","permalink":"/docs/developer-guide/build/docker-images","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ozone-site/tree/HDDS-9225-website-v2/docs/08-developer-guide/01-build/03-docker-images.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"Docker Images"},"sidebar":"defaultSidebar","previous":{"title":"Intellij","permalink":"/docs/developer-guide/build/intellij"},"next":{"title":"Run","permalink":"/docs/developer-guide/run/"}}');var r=i(6070),s=i(2392);const t={sidebar_label:"Docker Images"},d="Building Ozone Docker Images",l={},a=[{value:"ozone-runner",id:"ozone-runner",level:2},{value:"Building",id:"building",level:3},{value:"Tagging",id:"tagging",level:3},{value:"ozone",id:"ozone",level:2},{value:"Building",id:"building-1",level:3},{value:"Tagging",id:"tagging-1",level:3},{value:"ozone-testkrb5",id:"ozone-testkrb5",level:2},{value:"Building",id:"building-2",level:3},{value:"Tagging",id:"tagging-2",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"building-ozone-docker-images",children:"Building Ozone Docker Images"})}),"\n",(0,r.jsx)(n.p,{children:"This page provides an overview of the Docker images maintained by the Apache Ozone community for developing and testing Ozone.  It also describes the workflow to be followed when making changes to one of these images."}),"\n",(0,r.jsx)(n.h2,{id:"ozone-runner",children:"ozone-runner"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker-runner",children:"ozone-runner"})," is the base image with tools for running and testing Ozone, but does not include any Ozone artifacts."]}),"\n",(0,r.jsxs)(n.p,{children:["Developers and CI workflows rely on it heavily to run/test custom Ozone builds (using the local build via bind-mount).  It also serves as the base image for ",(0,r.jsx)(n.code,{children:"apache/ozone"})," (see next section)."]}),"\n",(0,r.jsxs)(n.p,{children:["Published to ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/apache/ozone-runner",children:"Docker Hub"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker-runner/pkgs/container/ozone-runner",children:"GitHub"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Development happens on branch ",(0,r.jsx)(n.code,{children:"master"}),", relevant changes are cherry-picked to branch ",(0,r.jsx)(n.code,{children:"jdk11"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"building",children:"Building"}),"\n",(0,r.jsxs)(n.p,{children:["The image can be built simply by running the helper script ",(0,r.jsx)(n.code,{children:"build.sh"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./build.sh\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tagging",children:"Tagging"}),"\n",(0,r.jsxs)(n.p,{children:["Images are tagged by date, and come in two flavors: ",(0,r.jsx)(n.code,{children:"jdk21"})," (for Ozone 2.0+) and ",(0,r.jsx)(n.code,{children:"jdk11"})," (for Ozone 1.x)."]}),"\n",(0,r.jsx)(n.p,{children:"Publishing Docker tags:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a Git tag for the commit following the existing pattern (",(0,r.jsx)(n.code,{children:"<date>-<n>-<flavor>"}),", where ",(0,r.jsx)(n.code,{children:"<n>"})," starts at 1, and is incremented if multiple images need to be published the same day)."]}),"\n",(0,r.jsxs)(n.li,{children:["Push the Git tag to the origin repo (",(0,r.jsx)(n.code,{children:"apache/ozone-docker-testkrb5"}),").  This will trigger a workflow run to apply the tag to the Docker image."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ozone",children:"ozone"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker",children:"ozone"})," is built on top of ",(0,r.jsx)(n.code,{children:"ozone-runner"}),", adding the binaries built for official Ozone releases."]}),"\n",(0,r.jsx)(n.p,{children:"These are used for testing compatibility of various Ozone versions, and upgrade from one version to another.  May also be useful for running quick experiments with specific version of Ozone, without the need to download or rebuild it."}),"\n",(0,r.jsxs)(n.p,{children:["Published to ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/apache/ozone",children:"Docker Hub"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker/pkgs/container/ozone",children:"GitHub"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Development branch: ",(0,r.jsx)(n.code,{children:"latest"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"building-1",children:"Building"}),"\n",(0,r.jsxs)(n.p,{children:["The image can be built simply by running the helper script ",(0,r.jsx)(n.code,{children:"build.sh"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./build.sh\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This will create a single-platform image for your architecture.  Build automation in GitHub Actions creates multi-platform image for ",(0,r.jsx)(n.code,{children:"amd64"})," and ",(0,r.jsx)(n.code,{children:"arm64"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"It can be customized via environment variables defined at build time."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# the URL to download Ozone from; allows using custom tarball or local mirror\nOZONE_URL\n\n# version of Ozone to include in the image; ignored if URL is also specified\nOZONE_VERSION\n\n# the base image name in repo/image format\nOZONE_RUNNER_IMAGE\n\n# the base image version to use\nOZONE_RUNNER_VERSION\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tagging-1",children:"Tagging"}),"\n",(0,r.jsxs)(n.p,{children:["Images are tagged by Ozone version numbers and optional flavor.  Flavor ",(0,r.jsx)(n.code,{children:"-rocky"})," was introduced when ",(0,r.jsx)(n.code,{children:"ozone-runner"})," was changed from CentOS to Rocky Linux due to CentOS end-of-life, to avoid breaking things for existing users.  Future images will be published only with Rocky Linux, with and without flavor suffix."]}),"\n",(0,r.jsxs)(n.p,{children:["Image tags are derived from branch names: push to the branch ",(0,r.jsx)(n.code,{children:"ozone-<tag>"})," gets published with ",(0,r.jsx)(n.code,{children:"<tag>"})," (e.g. ",(0,r.jsx)(n.code,{children:"ozone-1.4.1 -> 1.4.1"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"Publishing Docker tags:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Update the version-specific branch:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The latest release version can usually be updated by fast-forwarding the branch: ",(0,r.jsx)(n.code,{children:"git merge --ff-only origin/latest"}),".  This allows CI workflow to tag the existing image from ",(0,r.jsx)(n.code,{children:"latest"})," branch, instead of building completely new image."]}),"\n",(0,r.jsx)(n.li,{children:"For other versions branch can be updated by cherry-picking one or more commits."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Push the branch to the origin repo (",(0,r.jsx)(n.code,{children:"apache/ozone-docker"}),").  This will trigger a workflow run to publish the image."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ozone-testkrb5",children:"ozone-testkrb5"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker-testkrb5",children:"ozone-testkrb5"})," is used as KDC in tests where Kerberos is enabled."]}),"\n",(0,r.jsxs)(n.p,{children:["Published only to ",(0,r.jsx)(n.a,{href:"https://github.com/apache/ozone-docker-testkrb5/pkgs/container/ozone-testkrb5",children:"GitHub"}),", because it is completely insecure, and should be used only for testing."]}),"\n",(0,r.jsxs)(n.p,{children:["Development branch: ",(0,r.jsx)(n.code,{children:"master"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"building-2",children:"Building"}),"\n",(0,r.jsxs)(n.p,{children:["The image can be built simply by running the helper script ",(0,r.jsx)(n.code,{children:"build.sh"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./build.sh\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tagging-2",children:"Tagging"}),"\n",(0,r.jsx)(n.p,{children:"Images are tagged by date."}),"\n",(0,r.jsx)(n.p,{children:"Publishing Docker tags:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a Git tag for the commit following existing pattern (",(0,r.jsx)(n.code,{children:"<date>-<n>"}),", where ",(0,r.jsx)(n.code,{children:"<n>"})," starts at 1, and is incremented if multiple images need to be published the same day)."]}),"\n",(0,r.jsxs)(n.li,{children:["Push the Git tag to the origin repo (",(0,r.jsx)(n.code,{children:"apache/ozone-docker-testkrb5"}),").  This will trigger a workflow run to apply the tag to the Docker image."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);