<svg width="1400" height="800" xmlns="http://www.w3.org/2000/svg" font-family="JetBrains Mono, monospace" font-size="12">
    <!-- Background -->
    <rect width="1400" height="800" fill="#f7fcf0" />
    
    <!-- Title -->
    <text x="700" y="50" font-family="JetBrains Mono, monospace" font-size="22" text-anchor="middle" fill="#357500" font-weight="bold">Apache Ozone Component Interactions</text>

    <defs>
        <!-- Arrowhead marker definition -->
        <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#255200" />
        </marker>
    </defs>

    <style>
        .user-icon { stroke: #255200; stroke-width: 2; fill: none; }
        .interface-box { fill: #d1e4bc; stroke: #3a8100; stroke-width: 2; rx: 8; ry: 8; }
        .interface-text { fill: #255200; text-anchor: middle; font-weight: bold; }
        /* Updated enclosing box style */
        .enclosing-box { fill: none; stroke: #2d6300; stroke-width: 1.5; stroke-dasharray: 6 4; rx: 10; ry: 10; }
        .client-box { fill: #96d26e; stroke: #3a8100; stroke-width: 2.5; rx: 8; ry: 8; }
        /* Updated client text style */
        .client-text { fill: #255200; text-anchor: middle; font-weight: bold; }
        .arrow-line { stroke: #255200; stroke-width: 1.5; marker-end: url(#arrow); }
        /* Ozone Manager style - Updated color */
        .manager-box { fill: #4c8c2b; stroke: #306900; stroke-width: 2.5; rx: 8; ry: 8; }
        .manager-text { fill: #ffffff; text-anchor: middle; font-weight: bold; }
        /* SCM style - New color */
        .scm-box { fill: #3a7a1a; stroke: #306900; stroke-width: 2.5; rx: 8; ry: 8; }
        /* Datanode style - New color */
        .datanode-box { fill: #5fa638; stroke: #3a8100; stroke-width: 2; rx: 8; ry: 8; }
        /* Protocol Gateways style */
        .gateway-box { fill: #e0edd2; stroke: #357500; stroke-width: 2; rx: 15; ry: 15; }
    </style>

    <!-- Data Enclosing Box (moved down 100px) -->
    <rect x="245" y="480" width="770" height="300" rx="15" ry="15" stroke="#357500" stroke-width="2" fill="#e0edd2"/>
    <text x="630" y="500" font-family="JetBrains Mono, monospace" font-size="18" text-anchor="middle" fill="#357500" font-weight="bold">Data</text>

    <!-- User Stick Figure (moved down 25px) -->
    <g transform="translate(50, 220)">
        <circle cx="0" cy="-20" r="10" class="user-icon" fill="#64ab35"/>
        <line x1="0" y1="-10" x2="0" y2="10" class="user-icon"/>
        <line x1="-15" y1="0" x2="15" y2="0" class="user-icon"/>
        <line x1="0" y1="10" x2="-10" y2="30" class="user-icon"/>
        <line x1="0" y1="10" x2="10" y2="30" class="user-icon"/>
        <text x="0" y="45" text-anchor="middle" font-size="16" fill="#255200" font-weight="bold" font-family="JetBrains Mono, monospace">User</text>
    </g>

    <!-- NEW: Protocol Gateways box -->
    <rect x="140" y="80" width="310" height="150" class="gateway-box"/>
    <text x="295" y="105" font-family="JetBrains Mono, monospace" font-size="18" text-anchor="middle" fill="#357500" font-weight="bold">Protocol Gateways</text>

    <!-- Protocol Gateway Elements -->
    <g id="protocol-gateways">
        <rect x="150" y="120" width="120" height="30" class="interface-box"/>
        <text x="210" y="140" class="interface-text" font-size="16" font-family="JetBrains Mono, monospace">S3 Gateway</text>

        <rect x="150" y="160" width="120" height="30" class="interface-box"/>
        <text x="210" y="180" class="interface-text" font-size="16" font-family="JetBrains Mono, monospace">HttpFS</text>

        <!-- Ozone Client Library in Protocol Gateways -->
        <rect x="320" y="120" width="120" height="90" class="client-box"/>
        <text x="380" y="150" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Ozone</text>
        <text x="380" y="170" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Client</text>
        <text x="380" y="190" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Library</text>
    </g>

    <!-- Client Application Box (moved down) - height reduced -->
    <rect x="140" y="250" width="310" height="170" rx="15" ry="15" stroke="#357500" stroke-width="2" fill="#e0edd2"/>
    <text x="295" y="275" font-family="JetBrains Mono, monospace" font-size="18" text-anchor="middle" fill="#357500" font-weight="bold">Client Application</text>

    <!-- Interface/Application Boxes (remaining ones moved down) -->
    <g id="interfaces">
        <rect x="150" y="290" width="120" height="30" class="interface-box"/>
        <text x="210" y="310" class="interface-text" font-size="16" font-family="JetBrains Mono, monospace">Hive</text>

        <rect x="150" y="330" width="120" height="30" class="interface-box"/>
        <text x="210" y="350" class="interface-text" font-size="16" font-family="JetBrains Mono, monospace">Spark</text>

        <rect x="150" y="370" width="120" height="30" class="interface-box"/>
        <text x="210" y="390" class="interface-text" font-size="16" font-family="JetBrains Mono, monospace">Iceberg</text>
    </g>

    <!-- Ozone Client Library Box (in Client Applications section) - reduced height -->
    <rect x="320" y="290" width="120" height="110" class="client-box"/>
    <text x="380" y="330" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Ozone</text>
    <text x="380" y="350" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Client</text>
    <text x="380" y="370" class="client-text" font-size="16" font-family="JetBrains Mono, monospace">Library</text>

    <!-- Metadata Enclosing Box (moved right) -->
    <rect x="640" y="170" width="650" height="220" rx="15" ry="15" stroke="#357500" stroke-width="2" fill="#e0edd2"/>
    <text x="965" y="190" font-family="JetBrains Mono, monospace" font-size="18" text-anchor="middle" fill="#357500" font-weight="bold">Metadata</text>
    
    <!-- OM Ratis Components -->
    <rect x="650" y="195" width="290" height="180" fill="#d1e4bc" stroke="#2d6300" stroke-width="1.5" rx="10" ry="10"/>
    <text x="795" y="215" text-anchor="middle" font-weight="bold" font-size="16" fill="#306900" font-family="JetBrains Mono, monospace">Ratis (Raft)</text>
    
    <!-- Leader Manager Box -->
    <rect x="660" y="230" width="270" height="50" class="manager-box"/>
    <text x="795" y="260" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">OM (Leader)</text>
    
    <!-- Follower Boxes Row -->
    <g id="om-followers-row">
        <!-- Follower 1 Manager Box -->
        <rect x="660" y="290" width="130" height="50" class="manager-box" fill-opacity="0.85"/>
        <text x="725" y="320" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">OM (Follower)</text>
        
        <!-- Follower 2 Manager Box -->
        <rect x="800" y="290" width="130" height="50" class="manager-box" fill-opacity="0.85"/>
        <text x="865" y="320" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">OM (Follower)</text>
    </g>
    
    <!-- Storage Container Manager Boxes - Ratis(Raft)  -->
    <g id="storage-container-managers">
        <!-- Enclosing box for SCM Ratis group -->
        <rect x="990" y="195" width="290" height="180" fill="#d1e4bc" stroke="#2d6300" stroke-width="1.5" rx="10" ry="10"/>
        <text x="1135" y="215" text-anchor="middle" font-weight="bold" font-size="16" fill="#306900" font-family="JetBrains Mono, monospace">Ratis (Raft)</text>
        
        <!-- Leader Storage Container Manager Box -->
        <rect x="1000" y="230" width="270" height="50" class="scm-box"/>
        <text x="1135" y="260" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">SCM (Leader)</text>
        
        <!-- Follower Boxes Row -->
        <g id="scm-followers-row">
            <!-- Follower 1 Storage Container Manager Box -->
            <rect x="1000" y="290" width="130" height="50" class="scm-box" fill-opacity="0.85"/>
            <text x="1065" y="320" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">SCM (Follower)</text>
            
            <!-- Follower 2 Storage Container Manager Box -->
            <rect x="1140" y="290" width="130" height="50" class="scm-box" fill-opacity="0.85"/>
            <text x="1205" y="320" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">SCM (Follower)</text>
        </g>
    </g>

    <!-- Datanode Boxes: 3x5 Grid (moved down) -->
    <!-- Row 1 -->
    <rect x="265" y="520" width="130" height="60" class="datanode-box"/>
    <text x="330" y="555" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="415" y="520" width="130" height="60" class="datanode-box"/>
    <text x="480" y="555" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="565" y="520" width="130" height="60" class="datanode-box"/>
    <text x="630" y="555" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="715" y="520" width="130" height="60" class="datanode-box"/>
    <text x="780" y="555" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="865" y="520" width="130" height="60" class="datanode-box"/>
    <text x="930" y="555" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <!-- Row 2 -->
    <rect x="265" y="600" width="130" height="60" class="datanode-box"/>
    <text x="330" y="635" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="415" y="600" width="130" height="60" class="datanode-box"/>
    <text x="480" y="635" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="565" y="600" width="130" height="60" class="datanode-box"/>
    <text x="630" y="635" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="715" y="600" width="130" height="60" class="datanode-box"/>
    <text x="780" y="635" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="865" y="600" width="130" height="60" class="datanode-box"/>
    <text x="930" y="635" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <!-- Row 3 -->
    <rect x="265" y="680" width="130" height="60" class="datanode-box"/>
    <text x="330" y="715" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="415" y="680" width="130" height="60" class="datanode-box"/>
    <text x="480" y="715" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="565" y="680" width="130" height="60" class="datanode-box"/>
    <text x="630" y="715" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="715" y="680" width="130" height="60" class="datanode-box"/>
    <text x="780" y="715" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <rect x="865" y="680" width="130" height="60" class="datanode-box"/>
    <text x="930" y="715" class="manager-text" font-size="14" font-family="JetBrains Mono, monospace">Datanode</text>
    
    <!-- Arrows -->
    <!-- User to Protocol Gateways and Client Application - two clean horizontal lines -->
    <path d="M 80 200 L 140 155" class="arrow-line"/>  <!-- User -> Protocol Gateways (upper arrow) -->
    <path d="M 80 240 L 140 325" class="arrow-line"/>  <!-- User -> Client Application (lower arrow) -->

    <!-- Inside Protocol Gateway box - horizontal lines -->
    <line x1="270" y1="135" x2="320" y2="135" class="arrow-line"/>  <!-- S3 GW -> Client Library -->
    <line x1="270" y1="175" x2="320" y2="175" class="arrow-line"/> <!-- HttpFS -> Client Library -->

    <!-- Inside Client Application - horizontal lines -->
    <line x1="270" y1="305" x2="320" y2="305" class="arrow-line"/> <!-- Hive -> Client -->
    <line x1="270" y1="345" x2="320" y2="345" class="arrow-line"/> <!-- Spark -> Client -->
    <line x1="270" y1="385" x2="320" y2="385" class="arrow-line"/> <!-- Iceberg -> Client -->

    <!-- Protocol Gateways -> Metadata (adjusted for new position) -->
    <path d="M 440 150 L 540 150 L 540 255 L 660 255" 
          stroke="#255200" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Client Application -> Metadata (adjusted for new position and smaller box) -->
    <path d="M 440 330 L 540 330 L 540 255 L 660 255"
          stroke="#255200" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
    <text x="550" y="250" font-size="12" font-family="JetBrains Mono, monospace" fill="#255200" font-weight="bold">Metadata</text>
    <text x="550" y="270" font-size="12" font-family="JetBrains Mono, monospace" fill="#255200" font-weight="bold">Operations</text>

    <!-- Curved Arrow from Data to SCM Leader - adjusted for new position -->
    <path d="M 1015 530 L 1300 530 L 1300 255 L 1270 255"
          stroke="#255200" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrow)"/>
    <text x="1050" y="520" font-size="12" font-family="JetBrains Mono, monospace" fill="#255200" font-weight="bold">Heartbeats and Reports</text>
    
    <!-- Vertical Arrow from Client to Data - straight line (adjusted for smaller client box) -->
    <path d="M 380 400 L 380 480" stroke="#255200" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <text x="390" y="460" font-size="12" font-family="JetBrains Mono, monospace" fill="#255200" font-weight="bold">I/O Operations</text>
    
    <!-- Vertical Arrow from Protocol Gateway to Data - right side of box directly down -->
    <path d="M 440 165 L 500 165 L 500 480" 
          stroke="#255200" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Replication arrows from Leader to Followers - straight lines -->
    <path d="M 795 280 L 725 290" stroke="#306900" stroke-width="1.5" marker-end="url(#arrow)"/>
    <path d="M 795 280 L 865 290" stroke="#306900" stroke-width="1.5" marker-end="url(#arrow)"/>
    
    <!-- Replication arrows from SCM Leader to Followers - straight lines -->
    <path d="M 1135 280 L 1065 290" stroke="#306900" stroke-width="1.5" marker-end="url(#arrow)"/>
    <path d="M 1135 280 L 1205 290" stroke="#306900" stroke-width="1.5" marker-end="url(#arrow)"/>
    
    <!-- Communication arrow between Ozone Manager and Storage Container Manager - adjusted for new position -->
    <path d="M 930 255 L 1000 255" stroke="#255200" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
</svg>