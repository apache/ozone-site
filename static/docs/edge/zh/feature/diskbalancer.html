

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache Ozone Documentation">

    <title>Documentation for Apache Ozone</title>

    
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    
    <link href="../../css/ozonedoc.css" rel="stylesheet">

    
    
    <link href="../../swagger-resources/swagger-ui.css" rel="stylesheet">

    
    <script>
      var _paq = window._paq = window._paq || [];
      

       
      _paq.push(['disableCookies']);
      

      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '34']);
        var d=document, g=d.createElement('script'),
s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    

  </head>


<body>

  
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="../../zh/index.html" class="navbar-left ozone-logo">
        <img src="../../ozone-logo-small.png"/>
      </a>
      <a class="navbar-brand hidden-xs" href="../../zh/index.html">
        Apache Ozone/HDDS Documentation
      </a>
      <a class="navbar-brand visible-xs-inline" href="#">Apache Ozone</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/apache/ozone">Source</a></li>
        <li><a href="https://ozone.apache.org">Apache Ozone</a></li>
        <li><a href="https://apache.org">ASF</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      
<div class="col-sm-2 col-md-2 sidebar" id="sidebar">
  <ul class="nav nav-sidebar">
    
    
        
            <li class="">
                
                   <a href="../../zh/index.html">
                

                    
                    <span>概述</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/start/index.html">
                    
                    <span>快速入门</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/start/productiondeployment.html">生产环境部署</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/concept/index.html">
                    
                    <span>概念</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/concept/overview.html">概览</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/ozonemanager.html">Ozone Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/storagecontainermanager.html">Storage Container Manager</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/datanodes.html">数据节点</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/containers.html">Containers</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/concept/recon.html">Recon</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/feature/index.html">
                    
                    <span>特性</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/feature/decommission.html">Decommissioning</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/erasurecoding.html">纠删码</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/om-ha.html">高可用 OM</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/scm-ha.html">高可用 SCM</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/dn-merge-rocksdb.html">在DataNode上合并Container的RocksDB</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/prefixfso.html">基于前缀的文件系统优化</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/topology.html">拓扑感知能力</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/quota.html">Ozone 中的配额</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/recon.html">Recon 服务器</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/feature/reconfigurability.html">动态加载配置</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/security/index.html">
                    
                    <span>安全</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/security/secureozone.html">安全化 Ozone</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securingtde.html">透明数据加密</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/gdpr.html">Ozone 中的 GDPR</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securingdatanodes.html">安全化 Datanode</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securingozonehttp.html">安全化 HTTP</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securings3.html">安全化 S3</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securityacls.html">Ozone 访问控制列表</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/security/securitywithranger.html">Apache Ranger</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../zh/interface/index.html">
                    
                    <span>客户端接口</span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/interface/cli.html">命令行接口</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                
                   <a href="../../zh/tools/index.html">
                

                    
                    <span>工具</span>
                </a>
            </li>
        
    
        
            <li class="">
                
                   <a href="../../zh/recipe/index.html">
                

                    
                    <span>使用配方</span>
                </a>
            </li>
        
    
        
            <li class="">
                <a href="../../">
                    
                    <span></span>
                </a>
                <ul class="nav">
                    
                        <li class="active">
                           
                           <a href="../../zh/feature/diskbalancer.html">磁盘均衡器</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
        
            <li class="">
                <a href="../../">
                    
                    <span></span>
                </a>
                <ul class="nav">
                    
                        <li class="">
                           
                           <a href="../../zh/interface/javaapi.html">Java API</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/ofs.html">Ofs (兼容 Hadoop 的文件系统)</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/o3fs.html">Ozone 文件系统</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/csi.html">CSI 协议</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/s3.html">S3 协议接口</a>
                           
                        </li>
                    
                        <li class="">
                           
                           <a href="../../zh/interface/reconapi.html">Recon API</a>
                           
                        </li>
                    
                </ul>
            </li>
        
    
    <li><a href="../../design.html"><span><b>Design docs</b></span></a></li>
    <li class="visible-xs"><a href="#">References</a>
    <ul class="nav">
        <li><a href="https://github.com/apache/ozone"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Source</a></li>
        <li><a href="https://ozone.apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Apache Ozone</a></li>
        <li><a href="https://apache.org"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> ASF</a></li>
    </ul></li>
  </ul>

</div>

      <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-2 main-content">



        <div class="col-md-9">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="../../zh/index.html">Home</a></li>
                  <li class="breadcrumb-item" aria-current="page"><a href="../../zh/feature/index.html">特性</a></li>
                  <li class="breadcrumb-item active" aria-current="page">磁盘均衡器</li>
                </ol>
              </nav>

          

<div class="pull-right">
    
    
    
    <a href="../../feature/diskbalancer.html"><span class="label label-success">English</span></a>
    
    
    
    
</div>


          <div class="col-md-9">
            <h1>磁盘均衡器</h1>

            <!---
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<h2 id="概述">概述</h2>
<p><strong>Apache Ozone</strong> 能够有效地将所有容器均匀分布在每个 Datanode 的多个磁盘上。这种初始分布确保了 I/O 负载从一开始就保持平衡。然而，
在集群的整个运行生命周期中，以下原因可能会导致磁盘负载不平衡：</p>
<ul>
<li><strong>添加新磁盘</strong>以扩展数据节点存储空间。</li>
<li><strong>用新磁盘</strong>替换损坏的旧磁盘**。</li>
<li>大量<strong>块</strong>或<strong>副本删除</strong>。</li>
</ul>
<p>磁盘利用率不均衡会造成性能瓶颈，因为<strong>过度利用的磁盘</strong>会成为<strong>热点</strong>，限制 Datanode 的整体吞吐量。因此，我们引入了这项新功能<strong>磁盘平衡器</strong>
，以确保 Datanode 内各个磁盘的数据均匀分布。</p>
<p>如果磁盘的<code>VolumeDataDensity</code>超过可配置的“阈值”，则该磁盘被视为需要进行平衡。DiskBalancer 可以通过<strong>CLI 命令</strong>手动触发。</p>
<p>

<img src="diskBalancer.png" alt='Disk Even'  class="img-responsive" /></p>
<h2 id="功能标志">功能标志</h2>
<p>磁盘平衡器功能已通过功能标志引入。默认情况下，此功能处于禁用状态。</p>
<p>可以通过在“ozone-site.xml”配置文件中将以下属性设置为“true”来<strong>启用</strong>该功能：
<code>hdds.datanode.disk.balancer.enabled = false</code></p>
<h3 id="身份验证和授权">身份验证和授权</h3>
<p>DiskBalancer 命令通过 RPC 直接与数据节点通信，因此需要进行正确的身份验证和授权配置。</p>
<h4 id="身份验证配置">身份验证配置</h4>
<p>在启用了 Kerberos 的安全集群中，必须在 <code>ozone-site.xml</code> 文件中配置数据节点的 Kerberos 主体以进行 RPC 身份验证：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;name&gt;</span>hdds.datanode.kerberos.principal<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;value&gt;</span>dn/_HOST@REALM.TLD<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;description&gt;</span>
</span></span><span style="display:flex;"><span>  The Datanode service principal. This is typically set to
</span></span><span style="display:flex;"><span>  dn/_HOST@REALM.TLD. Each Datanode will substitute _HOST with its
</span></span><span style="display:flex;"><span>  own fully qualified hostname at startup. The _HOST placeholder
</span></span><span style="display:flex;"><span>  allows using the same configuration setting on all Datanodes.
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p><strong>注意</strong>：如果没有此配置，DiskBalancer 命令在安全集群中将因身份验证错误而失败。 客户端使用此主体在建立 RPC 连接时验证数据节点的身份。</p>
<h4 id="授权配置">授权配置</h4>
<p>每个数据节点都使用 <code>OzoneAdmins</code> 根据 <code>ozone.administrators</code> 配置执行授权检查：</p>
<ul>
<li>
<p><strong>管理员操作</strong>（启动、停止、更新）：要求用户位于 <code>ozone.administrators</code> 成员列表中，或属于 <code>ozone.administrators.groups</code> 中的某个组。</p>
</li>
<li>
<p><strong>只读操作</strong>（状态、报告）：不需要管理员权限 - 任何已认证的用户都可以查询状态和报告。</p>
</li>
</ul>
<h4 id="默认行为">默认行为</h4>
<p>默认情况下，如果未配置 <code>ozone.administrators</code>，则只有启动数据节点服务的用户才能启动、停止或更新 DiskBalancer。</p>
<p>这意味着在典型的部署中，如果数据节点以用户 <code>dn</code> 的身份运行，则只有该用户拥有 DiskBalancer 操作的 管理员权限。</p>
<h4 id="为其他用户启用身份验证">为其他用户启用身份验证</h4>
<p>要允许其他用户执行 DiskBalancer 管理操作（启动、停止、更新），请在 <code>ozone-site.xml</code> 文件中配置 <code>ozone.administrators</code> 属性：</p>
<p><strong>Example 1: Single user</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>ozone.administrators<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>scm<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p><strong>Example 2: Multiple users</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>ozone.administrators<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>scm,hdfs<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p><strong>Example 3: Using groups</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>ozone.administrators.groups<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;value&gt;</span>ozone-admins,cluster-operators<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p><strong>注意</strong>：<code>ozone-admins</code> 和 <code>cluster-operators</code> 是示例组名称。请将其替换为您环境中的实际组名称。 更新 <code>ozone.administrators</code> 配置后，
请重启数据节点服务以使更改生效。</p>
<h2 id="命令行用法">命令行用法</h2>
<p>DiskBalancer 通过 <code>ozone admin datanode diskbalancer</code> 命令进行管理。</p>
<p>**注意：**此命令在主帮助信息（<code>ozone admin datanode --help</code>）中隐藏。这是因为该功能目前处于实验阶段，默认禁用。隐藏该命令可防止意外使用，
并为普通用户提供清晰的帮助输出。但是，对于希望启用和使用该功能的用户，该命令仍然完全可用。</p>
<h3 id="命令语法">命令语法</h3>
<p><strong>启动 DiskBalancer：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin datanode diskbalancer start <span style="color:#f92672">[</span>&lt;datanode-address&gt; ...<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>OPTIONS<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--in-service-datanodes<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>停止 DiskBalancer：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin datanode diskbalancer stop <span style="color:#f92672">[</span>&lt;datanode-address&gt; ...<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--in-service-datanodes<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>更新配置：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin datanode diskbalancer update <span style="color:#f92672">[</span>&lt;datanode-address&gt; ...<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>OPTIONS<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--in-service-datanodes<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>获取状态：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin datanode diskbalancer status <span style="color:#f92672">[</span>&lt;datanode-address&gt; ...<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--in-service-datanodes<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--json<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>获取报告：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ozone admin datanode diskbalancer report <span style="color:#f92672">[</span>&lt;datanode-address&gt; ...<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--in-service-datanodes<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--json<span style="color:#f92672">]</span>
</span></span></code></pre></div><h3 id="命令选项">命令选项</h3>
<table>
  <thead>
      <tr>
          <th>Option</th>
          <th>Description</th>
          <th>Example</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>&lt;datanode-address&gt;</code></td>
          <td>一个或多个数据节点地址作为位置参数。地址可以是：<br>- 主机名（例如，<code>DN-1</code>）- 使用默认的 CLIENT_RPC 端口 (19864)<br>- 带端口的主机名（例如，<code>DN-1:19864</code>）<br>- IP 地址（例如，<code>192.168.1.10</code>）<br>- 带端口的 IP 地址（例如，<code>192.168.1.10:19864</code>）<br>- 标准输入 (<code>-</code>) - 从标准输入读取数据节点地址，每行一个</td>
          <td><code>DN-1</code><br><code>DN-1:19864</code><br><code>192.168.1.10</code><br><code>-</code></td>
      </tr>
      <tr>
          <td><code>--in-service-datanodes</code></td>
          <td>它向 SCM 查询所有 IN_SERVICE 数据节点，并在所有这些数据节点上执行该命令。</td>
          <td><code>--in-service-datanodes</code></td>
      </tr>
      <tr>
          <td><code>--json</code></td>
          <td>输出格式设置为JSON。</td>
          <td><code>--json</code></td>
      </tr>
      <tr>
          <td><code>-t/--threshold-percentage</code></td>
          <td>磁盘使用率阈值百分比（默认值：10.0）。与 <code>start</code> 和 <code>update</code> 命令一起使用。</td>
          <td><code>-t 5</code><br><code>--threshold-percentage 5.0</code></td>
      </tr>
      <tr>
          <td><code>-b/--bandwidth-in-mb</code></td>
          <td>最大磁盘带宽，单位为 MB/s（默认值：10）。与 <code>start</code> 和 <code>update</code> 命令一起使用。</td>
          <td><code>-b 20</code><br><code>--bandwidth-in-mb 50</code></td>
      </tr>
      <tr>
          <td><code>-p/--parallel-thread</code></td>
          <td>并行线程数（默认值：1）。与 <code>start</code> 和 <code>update</code> 命令一起使用。</td>
          <td><code>-p 5</code><br><code>--parallel-thread 10</code></td>
      </tr>
      <tr>
          <td><code>-s/--stop-after-disk-even</code></td>
          <td>磁盘平衡完成后自动停止（默认值：false）。与 <code>start</code> 和 <code>update</code> 命令一起使用。</td>
          <td><code>-s false</code><br><code>--stop-after-disk-even true</code></td>
      </tr>
  </tbody>
</table>
<h3 id="示例">示例</h3>
<p><strong>启动 DiskBalancer：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 在多个数据节点上启动 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer start DN-1 DN-2 DN-3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在所有运行中的数据节点上启动 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer start --in-service-datanodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用配置参数启动 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer start DN-1 -t <span style="color:#ae81ff">5</span> -b <span style="color:#ae81ff">20</span> -p <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从标准输入读取数据节点地址</span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;DN-1\nDN-2&#34;</span> | ozone admin datanode diskbalancer start -
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 JSON 输出启动 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer start DN-1 --json
</span></span></code></pre></div><p><strong>停止 DiskBalancer：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 在多个数据节点上停止 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer stop DN-1 DN-2 DN-3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在所有运行中的数据节点上停止 DiskBalancer</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer stop --in-service-datanodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 停止 DiskBalancer 并输出 JSON 信息</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer stop DN-1 --json
</span></span></code></pre></div><p><strong>更新配置：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 更新多个参数</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer update DN-1 -t <span style="color:#ae81ff">5</span> -b <span style="color:#ae81ff">50</span> -p <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新所有 IN_SERVICE 数据节点</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer update --in-service-datanodes -t <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新并输出 JSON 格式</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer update DN-1 -b <span style="color:#ae81ff">50</span> --json
</span></span></code></pre></div><p><strong>获取状态：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 从多个数据节点获取状态</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer status DN-1 DN-2 DN-3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从所有处于服务状态的数据节点获取状态</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer status --in-service-datanodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 JSON 格式获取状态</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer status --in-service-datanodes --json
</span></span></code></pre></div><p><strong>获取报告：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 从多个数据节点获取报告</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer report DN-1 DN-2 DN-3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从所有处于服务状态的数据节点获取报告</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer report --in-service-datanodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 JSON 格式获取报告</span>
</span></span><span style="display:flex;"><span>ozone admin datanode diskbalancer report --in-service-datanodes --json
</span></span></code></pre></div><h2 id="diskbalancer-configurations">DiskBalancer Configurations</h2>
<p>The DiskBalancer&rsquo;s behavior can be controlled using the following configuration properties in <code>ozone-site.xml</code>.</p>
<table>
  <thead>
      <tr>
          <th>Property</th>
          <th>Default Value</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>hdds.datanode.disk.balancer.enabled</code></td>
          <td><code>false</code></td>
          <td>如果为 false，则 Datanode 上的 DiskBalancer 服务将被禁用。将其配置为 true 可启用 DiskBalancer。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.volume.density.threshold.percent</code></td>
          <td><code>10.0</code></td>
          <td>百分比（0-100）。如果对于每个卷，其利用率与平均数据节点利用率之差不超过此阈值，则认为数据节点处于平衡状态。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.max.disk.throughputInMBPerSec</code></td>
          <td><code>10</code></td>
          <td>平衡器可用于移动数据的最大带宽（以 MB/s 为单位），以避免影响客户端 I/O。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.parallel.thread</code></td>
          <td><code>5</code></td>
          <td>用于并行移动容器的工作线程数。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.service.interval</code></td>
          <td><code>60s</code></td>
          <td>Datanode DiskBalancer 服务检查不平衡并更新其配置的时间间隔。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.stop.after.disk.even</code></td>
          <td><code>true</code></td>
          <td>如果为真，则一旦磁盘被视为平衡（即所有卷密度都在阈值内），DiskBalancer 将自动停止其平衡活动。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.volume.choosing.policy</code></td>
          <td><code>org.apache.hadoop.ozone.container.diskbalancer.policy.DefaultVolumeChoosingPolicy</code></td>
          <td>用于选择平衡的源卷和目标卷的策略类。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.container.choosing.policy</code></td>
          <td><code>org.apache.hadoop.ozone.container.diskbalancer.policy.DefaultContainerChoosingPolicy</code></td>
          <td>用于选择将哪些容器从源卷移动到目标卷的策略类。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.service.timeout</code></td>
          <td><code>300s</code></td>
          <td>Datanode DiskBalancer 服务操作超时。</td>
      </tr>
      <tr>
          <td><code>hdds.datanode.disk.balancer.should.run.default</code></td>
          <td><code>false</code></td>
          <td>如果平衡器无法读取其持久配置，则该值决定服务是否应默认运行。</td>
      </tr>
  </tbody>
</table>


          
          <a class="btn  btn-success btn-lg" href="../../zh/feature/om-ha.html">Next >></a>
          
          </div>

        </div>
      </div>
    </div>
  </div>
    <div class="push"></div>
  </div>

  

<footer class="footer">
  <div class="container">
    <span class="small text-muted">
      Version: 2.2.0-SNAPSHOT, Last Modified: December 31, 2025 <a class="hide-child link primary-color" href="https://github.com/apache/ozone/commit/fc16787c351dce867a1d094e5440a8bcaadd33c9">fc16787c35</a>
    </span>
  </div>
</footer>



<script src="../../js/jquery-3.5.1.min.js"></script>
<script src="../../js/ozonedoc.js"></script>
<script src="../../js/bootstrap.min.js"></script>


</body>

</html>